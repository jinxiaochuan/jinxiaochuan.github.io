{"title":"CDN","uid":"acb839066d366821abd556a15e4a7b04","slug":"cdn","date":"2022-02-08T19:56:46.000Z","updated":"2022-02-23T05:31:18.391Z","comments":true,"path":"api/articles/cdn.json","keywords":null,"cover":[],"content":"<h4 id=\"什么是-CDN？\"><a href=\"#什么是-CDN？\" class=\"headerlink\" title=\"什么是 CDN？\"></a>什么是 CDN？</h4><p>CDN 的全称是 Content Delivery Network，即内容分发网络。是指一种通过互联网互相连接的电脑网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户，来提供高性能、可扩展性及低成本的网络内容传递给用户。</p>\n<p>现实中我们都用过天猫超市，在上面买东西非常方便。天猫超市的模式是货品先入天猫超市（后文简称为”猫超”）的菜鸟仓，然后由猫超统一派送的。</p>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/8/5/16c5f7c722ca14fc~tplv-t2oaga2asx-watermark.awebp\" alt=\"cdn\"></p>\n<h4 id=\"CDN-的基本工作过程\"><a href=\"#CDN-的基本工作过程\" class=\"headerlink\" title=\"CDN 的基本工作过程\"></a>CDN 的基本工作过程</h4><h6 id=\"一图秒懂-CDN-原理（以访问网站某网页资源请求为例）\"><a href=\"#一图秒懂-CDN-原理（以访问网站某网页资源请求为例）\" class=\"headerlink\" title=\"一图秒懂 CDN 原理（以访问网站某网页资源请求为例）\"></a>一图秒懂 CDN 原理（以访问网站某网页资源请求为例）</h6><p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fcd8f20339064af1a4e3e4847e0a3d6a~tplv-k3u1fbpfcp-watermark.awebp\" alt=\"cdn\"></p>\n<h6 id=\"引入-CDN-之前\"><a href=\"#引入-CDN-之前\" class=\"headerlink\" title=\"引入 CDN 之前\"></a>引入 CDN 之前</h6><ul>\n<li>用户在自己的浏览器中输入要访问的网站域名</li>\n<li>浏览器向本地 DNS 服务器请求对该域名的解析</li>\n<li>本地 DNS 服务器中如果缓存有这个域名的解析结果，则直接响应用户的解析请求</li>\n<li>本地 DNS 服务器中如果没有关于这个域名的解析结果的缓存，则以迭代方式向整个 DNS 系统请求解析，获得应答后将结果反馈给浏览器</li>\n<li>浏览器得到域名解析结果，就是该域名相应的服务设备的 IP 地址</li>\n<li>浏览器获取 IP 地址之后，经过标准的 TCP 握手流程，建立 TCP 连接</li>\n<li>浏览器向服务器发起 HTTP 请求</li>\n<li>服务器将用户请求内容传送给浏览器</li>\n<li>经过标准的 TCP 挥手流程，断开 TCP 连接</li>\n</ul>\n<h6 id=\"引入-CDN-之后\"><a href=\"#引入-CDN-之后\" class=\"headerlink\" title=\"引入 CDN 之后\"></a>引入 CDN 之后</h6><ul>\n<li>当用户点击网站页面上的内容 URL，先经过本地 DNS 系统解析，如果本地 DNS 服务器没有相应域名的缓存，则本地 DNS 系统会将域名的解析权交给 <em>CNAME</em> 指向的 CDN 专用 DNS 服务器</li>\n<li>CDN 的 DNS 服务器将 CDN 的全局负载均衡设备 IP 地址返回给用户</li>\n<li>用户向 CDN 的全局负载均衡设备发起 URL 访问请求</li>\n<li>CDN 全局负载均衡设备根据用户 IP 地址，以及用户请求的 URL，选择一台用户所属区域的区域负载均衡设备，并将请求转发到此设备上</li>\n<li>基于以下这些条件的综合分析之后，区域负载均衡设备会选择一个最优的缓存服务器节点，并从缓存服务器节点处得到缓存服务器的 IP 地址，最终将得到的 IP 地址返回给全局负载均衡设备<ul>\n<li>根据用户 IP 地址，判断哪一个边缘节点距用户最近</li>\n<li>根据用户所请求的 URL 中携带的内容名称，判断哪一个边缘节点上有用户所需内容</li>\n<li>查询各个边缘节点当前的负载情况，判断哪一个边缘节点尚有服务能力</li>\n</ul>\n</li>\n<li>全局负载均衡设备把服务器的 IP 地址返回给用户</li>\n<li>用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地</li>\n</ul>\n<h4 id=\"CNAME-记录是什么？他存在的意义是什么？\"><a href=\"#CNAME-记录是什么？他存在的意义是什么？\" class=\"headerlink\" title=\"CNAME 记录是什么？他存在的意义是什么？\"></a>CNAME 记录是什么？他存在的意义是什么？</h4><p>记录就是把一个域名解析到一个 IP 地址（Address，特制数字 IP 地址），而 CNAME 记录就是把域名解析到另外一个域名。其功能是差不多，CNAME 将几个主机名指向一个别名，其实跟指向 IP 地址是一样的，因为这个别名也要做一个 A 记录的。但是使用 CNAME 记录可以很方便地变更 IP 地址。如果一台服务器有 100 个网站，他们都做了别名，该台服务器变更 IP 时，只需要变更别名的 A 记录就可以了。</p>\n<p>如果服务商给你一个 ip，假如哪天服务商想把 ip 地址换一个，很多人域名上对应的 ip 地址就要跟着变化，要让所有人都一起改完，完全没有办法做到的事情，换成 cname 就没事了，你用你的 cdn，他改他的 ip 地址。唯一的坏处就是，第一次 DNS 解析域名的时候会多解析一次。总结来看，好处远大于坏处。</p>\n<h6 id=\"什么是-CNAME-记录？\"><a href=\"#什么是-CNAME-记录？\" class=\"headerlink\" title=\"什么是 CNAME 记录？\"></a>什么是 CNAME 记录？</h6><p>CName 记录是 Canonical Name 的简称，通常称别名指向，CNAME 记录可用于将一个域名别名为另一个规范名称的域名系统（DNS）资源记录。　　网站是由一组由一组唯一标识的位置（称为 IP 地址）提供服务的；但是要访问这些站点（例如：晓得博客），我们通常会键入它们对应的域名，这些域名更容易记住。要找到正确的 IP 地址，您的浏览器将联系域名服务器（DNS），并在其数据库中查询 IP 地址。</p>\n<h6 id=\"CNAME-记录如何使用？\"><a href=\"#CNAME-记录如何使用？\" class=\"headerlink\" title=\"CNAME 记录如何使用？\"></a>CNAME 记录如何使用？</h6><p>例如，假设您有几个子域，例如<a href=\"http://www.mydomain.com,http//ftp.mydomain.com%EF%BC%8Chttp://mail.mydomain.com%E7%AD%89%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%82%A8%E5%B8%8C%E6%9C%9B%E8%BF%99%E4%BA%9B%E5%AD%90%E5%9F%9F%E6%8C%87%E5%90%91%E6%82%A8%E7%9A%84%E4%B8%BB%E5%9F%9F%E5%90%8Dhttp://mydomain.com%E3%80%82%E6%82%A8%E5%8F%AF%E4%BB%A5%E5%88%9B%E5%BB%BACNAME%E8%AE%B0%E5%BD%95%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E4%B8%BA%E6%AF%8F%E4%B8%AA%E5%AD%90%E5%9F%9F%E5%88%9B%E5%BB%BAA%E8%AE%B0%E5%BD%95%E5%B9%B6%E5%B0%86%E5%85%B6%E7%BB%91%E5%AE%9A%E5%88%B0%E6%82%A8%E5%9F%9F%E7%9A%84IP\">http://www.mydomain.com，http://ftp.mydomain.com，http://mail.mydomain.com等，并且您希望这些子域指向您的主域名http://mydomain.com。您可以创建CNAME记录，而不是为每个子域创建A记录并将其绑定到您域的IP</a>地址。<br>如下表所示，如果服务器的 IP 地址发生更改，则只需更新一个 A 记录，并且所有子域都会自动更新，因为所有 CNAMES 都指向带有 A 记录的主域：<br><img src=\"https://pic1.zhimg.com/v2-aab77a543b11a4a3ecf40ec226f1af4e_r.jpg?source=1940ef5c\" alt=\"cname\"><br><a href=\"http://mydomain.com指向服务器ip地址,并通过http//www.mydomain.com%E6%8C%87%E5%90%91%E7%9B%B8%E5%90%8C%E7%9A%84%E5%9C%B0%E5%9D%80http://mydomain.com%E3%80%82%E5%A6%82%E6%9E%9CIP%E5%9C%B0%E5%9D%80%E5%8F%91%E7%94%9F%E6%9B%B4%E6%94%B9%EF%BC%8C%E5%88%99%E5%8F%AA%E9%9C%80%E8%A6%81%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%9C%B0%E6%96%B9%E8%BF%9B%E8%A1%8C%E6%9B%B4%E6%96%B0%E5%8D%B3%E5%8F%AF%EF%BC%9A%E5%8F%AA%E9%9C%80%E4%B8%BA%E4%BF%AE%E6%94%B9A%E8%AE%B0%E5%BD%95http://mydomain.com%EF%BC%8C%E9%82%A3%E4%B9%88http://www.mydomain.com\">http://mydomain.com指向服务器IP地址，并通过http://www.mydomain.com指向相同的地址http://mydomain.com。如果IP地址发生更改，则只需要在一个地方进行更新即可：只需为修改A记录http://mydomain.com，那么http://www.mydomain.com</a>自动继承更改。<br>　　 CNAME 记录必须始终指向另一个域名，永远不要直接指向 IP 地址。如果您尝试将 CNAME 记录指向 IP 地址，DNSimple 的记录编辑器会警告您。CNAME 对其他记录必须是唯一的。CNAME 记录局限性<br>　　 CNAME 记录必须始终指向另一个域名，并且永远不要直接指向 IP 地址。<br>　　您不能为主域名（<a href=\"http://mydomain.com)本身创建cname记录,该记录必须是a/\">http://mydomain.com）本身创建CNAME记录，该记录必须是A</a>记录。<br>　　例如，您不能将<a href=\"http://mydomain.com映射到http//google.com%EF%BC%8C%E4%BD%86%E6%98%AF%E5%8F%AF%E4%BB%A5%E5%B0%86http://google.mydomain.com%E6%98%A0%E5%B0%84%E5%88%B0http://google.com\">http://mydomain.com映射到http://google.com，但是可以将http://google.mydomain.com映射到http://google.com</a>。<br>　　使用 CNAME 记录意味着有一个额外的请求发送到 DNS 服务器，这可能会导致几毫秒的延迟。<br>　　一个 CNAME 记录不能与另一个具有相同名称的记录共存。不能同时有 CNAME 和 TXT 记录<a href=\"http://www.example.com/\">http://www.example.com</a>。<br>　　一个 CNAME 可以指向另一个 CNAME，尽管出于性能原因通常不建议使用此配置。如果适用，CNAME 应该尽可能地指向目标名称，以避免不必要的性能开销。</p>\n<h4 id=\"如何解决-CDN-缓存\"><a href=\"#如何解决-CDN-缓存\" class=\"headerlink\" title=\"如何解决 CDN 缓存\"></a>如何解决 CDN 缓存</h4><ol>\n<li>资源 url 参数加时间戳<br>url 的参数加上时间戳，每次更新时时间戳也跟随更新，重新使 cdn 边缘节点同步源服务器最新数据。<br>调用 cdn 服务商提供的刷新缓存接口</li>\n</ol>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">http://www.cdn.com/static/images/test.png <span class=\"token comment\"># 没加时间戳</span>\nhttp://www.cdn.com/static/images/test.png?_t<span class=\"token operator\">=</span><span class=\"token number\">202012290910</span> <span class=\"token comment\"># 加了时间戳</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<ol start=\"2\">\n<li>调用 cdn 服务商提供的刷新缓存接口<br>CDN 边缘节点对开发者是透明的，相比于浏览器 Ctrl+F5 的强制刷新来使浏览器本地缓存失效，开发者可以通过 CDN 服务商提供的“刷新缓存”接口来达到清理 CDN 边缘节点缓存的目的。<br>这样开发者在更新数据后，可以使用“刷新缓存”功能来强制 CDN 节点上的数据缓存过期，保证客户端在访问时，拉取到最新的数据。</li>\n</ol>\n<h4 id=\"CDN-的应用场景\"><a href=\"#CDN-的应用场景\" class=\"headerlink\" title=\"CDN 的应用场景\"></a>CDN 的应用场景</h4><ol>\n<li>网站站点&#x2F;应用加速<br>站点或者应用中大量静态资源的加速分发，建议将站点内容进行动静分离，动态文件可以结合云服务器 ECS，静态资源如各类型图片、html、css、js 文件等，建议结合 对象存储 OSS 存储海量静态资源，可以有效加速内容加载速度，轻松搞定网站图片、短视频等内容分发</li>\n<li>视音频点播&#x2F;大文件下载分发加速<br>支持各类文件的下载、分发，支持在线点播加速业务，如 mp4、flv 视频文件或者平均单个文件大小在 20M 以上，主要的业务场景是视音频点播、大文件下载（如安装包下载）等，建议搭配对象存储 OSS 使用，可提升回源速度，节约近 2&#x2F;3 回源带宽成本。</li>\n<li>视频直播加速（内测中）<br>视频流媒体直播服务，支持媒资存储、切片转码、访问鉴权、内容分发加速一体化解决方案。结合弹性伸缩服务，及时调整服务器带宽，应对突发访问流量；结合媒体转码服务，享受高速稳定的并行转码，且任务规模无缝扩展。目前 CDN 直播加速已服务内部用户测试并优化，即将上线</li>\n<li>移动应用加速<br>移动 APP 更新文件（apk 文件）分发，移动 APP 内图片、页面、短视频、UGC 等内容的优化加速分发。提供 httpDNS 服务，避免 DNS 劫持并获得实时精确的 DNS 解析结果，有效缩短用户访问时间，提升用户体验。</li>\n</ol>\n<h4 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h4><p><a href=\"https://zhuanlan.zhihu.com/p/28940451\">也许是史上最全的一次 CDN 详解</a><br><a href=\"https://juejin.cn/post/6962904216503320589\">一图秒懂 CDN 原理</a></p>\n","text":"什么是 CDN？CDN 的全称是 Content Delivery Network，即内容分发网络。是指一种通过互联网互相连接的电脑网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户，来提供高性能、可扩展性及低成本的网络内容传递给...","link":"","photos":[],"count_time":{"symbolsCount":"3.7k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"Network","slug":"Network","count":2,"path":"api/tags/Network.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AF-CDN%EF%BC%9F\"><span class=\"toc-text\">什么是 CDN？</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#CDN-%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B\"><span class=\"toc-text\">CDN 的基本工作过程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E4%B8%80%E5%9B%BE%E7%A7%92%E6%87%82-CDN-%E5%8E%9F%E7%90%86%EF%BC%88%E4%BB%A5%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99%E6%9F%90%E7%BD%91%E9%A1%B5%E8%B5%84%E6%BA%90%E8%AF%B7%E6%B1%82%E4%B8%BA%E4%BE%8B%EF%BC%89\"><span class=\"toc-text\">一图秒懂 CDN 原理（以访问网站某网页资源请求为例）</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E5%BC%95%E5%85%A5-CDN-%E4%B9%8B%E5%89%8D\"><span class=\"toc-text\">引入 CDN 之前</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E5%BC%95%E5%85%A5-CDN-%E4%B9%8B%E5%90%8E\"><span class=\"toc-text\">引入 CDN 之后</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#CNAME-%E8%AE%B0%E5%BD%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E4%BB%96%E5%AD%98%E5%9C%A8%E7%9A%84%E6%84%8F%E4%B9%89%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F\"><span class=\"toc-text\">CNAME 记录是什么？他存在的意义是什么？</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AF-CNAME-%E8%AE%B0%E5%BD%95%EF%BC%9F\"><span class=\"toc-text\">什么是 CNAME 记录？</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#CNAME-%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%EF%BC%9F\"><span class=\"toc-text\">CNAME 记录如何使用？</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3-CDN-%E7%BC%93%E5%AD%98\"><span class=\"toc-text\">如何解决 CDN 缓存</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#CDN-%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">CDN 的应用场景</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83\"><span class=\"toc-text\">参考</span></a></li></ol>","author":{"name":"Matrix","slug":"blog-author","avatar":"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/8/2/16c515569d19fc87~tplv-t2oaga2asx-no-mark:500:500:500:500.awebp","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"HTTP2","uid":"51e9acccf01c1d764ee3a75bbf79b49b","slug":"http2","date":"2022-02-08T22:19:20.000Z","updated":"2022-02-23T05:31:18.391Z","comments":true,"path":"api/articles/http2.json","keywords":null,"cover":[],"text":"维基百科关于 HTTP&#x2F;2 的介绍，可以看下定义和发展历史: Wiki RFC 7540 定义了 HTTP&#x2F;2 的协议规范和细节，本文的细节主要来自此文档，建议先看一遍本文，再回过头来照着协议大致过一遍 RFC，如果想深入某些细节再仔细翻看 RFC RFC75...","link":"","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"Network","slug":"Network","count":2,"path":"api/tags/Network.json"}],"author":{"name":"Matrix","slug":"blog-author","avatar":"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/8/2/16c515569d19fc87~tplv-t2oaga2asx-no-mark:500:500:500:500.awebp","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{}}