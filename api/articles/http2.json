{"title":"HTTP2","uid":"51e9acccf01c1d764ee3a75bbf79b49b","slug":"http2","date":"2022-02-08T22:19:20.000Z","updated":"2022-02-08T14:39:06.384Z","comments":true,"path":"api/articles/http2.json","keywords":null,"cover":[],"content":"<p>维基百科关于 HTTP&#x2F;2 的介绍，可以看下定义和发展历史:</p>\n<p><a href=\"https://zh.wikipedia.org/wiki/HTTP/2\">Wiki</a></p>\n<p>RFC 7540 定义了 HTTP&#x2F;2 的协议规范和细节，本文的细节主要来自此文档，建议先看一遍本文，再回过头来照着协议大致过一遍 RFC，如果想深入某些细节再仔细翻看 RFC</p>\n<p><a href=\"https://httpwg.org/specs/rfc7540.html\">RFC7540</a></p>\n<h4 id=\"Why-use-it\"><a href=\"#Why-use-it\" class=\"headerlink\" title=\"Why use it ?\"></a>Why use it ?</h4><p>HTTP&#x2F;1.1 存在的问题:</p>\n<ol>\n<li>TCP 连接数限制<br>对于同一个域名，浏览器最多只能同时创建 6 - 8 个 TCP 连接 (不同浏览器不一样)。为了解决数量限制，出现了 域名分片 技术，其实就是资源分域，将资源放在不同域名下 (比如二级子域名下)，这样就可以针对不同域名创建连接并请求，以一种讨巧的方式突破限制，但是滥用此技术也会造成很多问题，比如每个 TCP 连接本身需要经过 DNS 查询、三步握手、慢启动等，还占用额外的 CPU 和内存，对于服务器来说过多连接也容易造成网络拥挤、交通阻塞等，对于移动端来说问题更明显，可以参考这篇文章: Why Domain Sharding is Bad News for Mobile Performance and Users。<br><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/31/1658dc4aba66d424~tplv-t2oaga2asx-watermark.awebp\" alt=\"http/1.1-1\"><br><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/31/1658dc4c0371bfda~tplv-t2oaga2asx-watermark.awebp\" alt=\"http/1.1-2\"><br>在图中可以看到新建了六个 TCP 连接，每次新建连接 DNS 解析需要时间(几 ms 到几百 ms 不等)、TCP 慢启动也需要时间、TLS 握手又要时间，而且后续请求都要等待队列调度</li>\n<li>线头阻塞 (Head Of Line Blocking) 问题<br>每个 TCP 连接同时只能处理一个请求 - 响应，浏览器按 FIFO 原则处理请求，如果上一个响应没返回，后续请求 - 响应都会受阻。为了解决此问题，出现了 管线化 - pipelining 技术，但是管线化存在诸多问题，比如第一个响应慢还是会阻塞后续响应、服务器为了按序返回相应需要缓存多个响应占用更多资源、浏览器中途断连重试服务器可能得重新处理多个请求、还有必须客户端 - 代理 - 服务器都支持管线化</li>\n<li>Header 内容多，而且每次请求 Header 不会变化太多，没有相应的压缩传输优化方案</li>\n<li>为了尽可能减少请求数，需要做合并文件、雪碧图、资源内联等优化工作，但是这无疑造成了单个请求内容变大延迟变高的问题，且内嵌的资源不能有效地使用缓存机制</li>\n<li>明文传输不安全</li>\n</ol>\n","text":"维基百科关于 HTTP&#x2F;2 的介绍，可以看下定义和发展历史: Wiki RFC 7540 定义了 HTTP&#x2F;2 的协议规范和细节，本文的细节主要来自此文档，建议先看一遍本文，再回过头来照着协议大致过一遍 RFC，如果想深入某些细节再仔细翻看 RFC RFC75...","link":"","photos":[],"count_time":{"symbolsCount":955,"symbolsTime":"1 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Why-use-it\"><span class=\"toc-text\">Why use it ?</span></a></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{}}