{"title":"Source Map","uid":"f8393fb18aa0424e4c73686abd0807ce","slug":"sourcemap","date":"2022-02-16T18:13:27.000Z","updated":"2022-02-16T12:53:55.947Z","comments":true,"path":"api/articles/sourcemap.json","keywords":null,"cover":[],"content":"<h4 id=\"为什么需要-Source-map？\"><a href=\"#为什么需要-Source-map？\" class=\"headerlink\" title=\"为什么需要 Source map？\"></a>为什么需要 Source map？</h4><p>这个要从源码转换讲起，JavaScript 脚本正变得越来越复杂。大部分源码（尤其是各种函数库和框架）都要经过转换，才能投入生产环境。</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>常见的源码转换，主要是以下三种情况：</p>\n<p>（1）压缩，减小体积。比如 jQuery 1.9 的源码，压缩前是 252KB，压缩后是 32KB。<br>（2）多个文件合并，减少 HTTP 请求数。<br>（3）其他语言编译成 JavaScript。最常见的例子就是 CoffeeScript。</p></blockquote>\n<p>这三种情况，都使得实际运行的代码不同于开发代码，除错（debug）变得困难重重。<br>通常，JavaScript 的解释器会告诉你，第几行第几列代码出错。但是，这对于转换后的代码毫无用处。举例来说，jQuery 1.9 压缩后只有 3 行，每行 3 万个字符，所有内部变量都改了名字。你看着报错信息，感到毫无头绪，根本不知道它所对应的原始位置。</p>\n<p>这就是 Source map 想要解决的问题。</p>\n<h4 id=\"什么是-Source-map？\"><a href=\"#什么是-Source-map？\" class=\"headerlink\" title=\"什么是 Source map？\"></a>什么是 Source map？</h4><p>简单说，Source map 就是一个信息文件，里面储存着位置信息。也就是说，转换后的代码的每一个位置，所对应的转换前的位置。</p>\n<p>有了它，出错的时候，除错工具将直接显示原始代码，而不是转换后的代码。这无疑给开发者带来了很大方便。</p>\n<p><img src=\"http://www.ruanyifeng.com/blogimg/asset/201301/bg2013012204.png\" alt=\"jQuery Source map\"></p>\n<h4 id=\"如何启用-Source-map？\"><a href=\"#如何启用-Source-map？\" class=\"headerlink\" title=\"如何启用 Source map？\"></a>如何启用 Source map？</h4><p>正如前文所提到的，只要在转换后的代码尾部，加上一行就可以了。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">　//@ <span class=\"token assign-left variable\">sourceMappingURL</span><span class=\"token operator\">=</span>/path/to/file.js.map<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>map 文件可以放在网络上，也可以放在本地文件系统。那这里就不得不提 <code>Webpack Devtool</code> 配置。</p>\n<h4 id=\"Source-map-字段解读\"><a href=\"#Source-map-字段解读\" class=\"headerlink\" title=\"Source map 字段解读\"></a>Source map 字段解读</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token string\">\"version\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token number\">3</span>,\n  <span class=\"token string\">\"file\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"main.js\"</span>,\n  <span class=\"token string\">\"sources\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"../src/main.js\"</span>\n  <span class=\"token punctuation\">]</span>,\n  <span class=\"token string\">\"sourcesContent\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"throw new Error('error 1');<span class=\"token entity\" title=\"\\n\">\\n</span>\"</span>\n  <span class=\"token punctuation\">]</span>,\n  <span class=\"token string\">\"names\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"Error\"</span>\n  <span class=\"token punctuation\">]</span>,\n  <span class=\"token string\">\"mappings\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\";;AAAA,MAAM,IAAIA,KAAJ,CAAU,SAAV,CAAN\"</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><code>version</code>： sourceMap 版本，目前的版本是 3。<br><code>file</code>：转换后的文件名。<br><code>sources</code>：转换前的文件。该项是一个数组，表示可能存在多个文件合并。<br><code>sourcesContent</code>：source 中文件对应的源代码，是个数组<br><code>names</code>：转换前的所有变量名和属性名。<br><code>mappings</code>：记录位置信息的字符串。</p>\n<blockquote>\n<p>关键就是 <code>map</code> 文件的 <code>mappings</code> 属性。这是一个很长的字符串，它分成三层</p>\n<ol>\n<li>第一层是行对应，以分号 <code>;</code> 表示，每个分号对应转换后源码的一行。所以，第一个分号前的内容，就对应源码的第一行，以此类推。</li>\n<li>第二层是位置对应，以逗号 <code>,</code>表示，每个逗号对应转换后源码的一个位置。所以，第一个逗号前的内容，就对应该行源码的第一个位置，以此类推。</li>\n<li>第三层是位置转换，以 <a href=\"https://en.wikipedia.org/wiki/Variable-length_quantity\">VLQ</a> 编码表示，代表该位置对应的转换前的源码位置。</li>\n</ol></blockquote>\n</blockquote>\n<h4 id=\"Webpack-Devtool-配置\"><a href=\"#Webpack-Devtool-配置\" class=\"headerlink\" title=\"Webpack Devtool 配置\"></a>Webpack Devtool 配置</h4><table>\n<thead>\n<tr>\n<th align=\"center\">模式</th>\n<th align=\"left\">解释</th>\n<th align=\"left\">缺点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><code>eval</code></td>\n<td align=\"left\">每个 module 会封装到 eval 里包裹起来执行，并且会在末尾追加注释 &#x2F;&#x2F;@ sourceURL</td>\n<td align=\"left\">映射到转换后的代码，而不是映射到原始代码</td>\n</tr>\n<tr>\n<td align=\"center\"><code>source-map</code></td>\n<td align=\"left\">整个 <code>source map</code> 作为一个单独的文件生成。它为 <code>bundle</code> 添加了一个引用注释，以便开发工具知道在哪里可以找到它</td>\n<td align=\"left\">不建议生产环境（应该将你的服务器配置为，不允许普通用户访问 <code>source map</code> 文件）</td>\n</tr>\n<tr>\n<td align=\"center\"><code>hidden-source-map</code></td>\n<td align=\"left\">与 <code>source-map</code> 相同，但不会为 <code>bundle</code> 添加引用注释</td>\n<td align=\"left\">不建议生产环境（不应将 <code>source map</code> 文件部署到 web 服务器。而是只将其用于错误报告工具）</td>\n</tr>\n<tr>\n<td align=\"center\"><code>nosources-source-map</code></td>\n<td align=\"left\">创建的 <code>source map</code> 不包含 <code>sourcesContent</code>(源代码内容)</td>\n<td align=\"left\">可将 <code>source map</code> 文件部署到 web 服务器，但仍然会暴露反编译后的文件名和结构，但它不会暴露原始代码</td>\n</tr>\n<tr>\n<td align=\"center\"><code>inline-source-map</code></td>\n<td align=\"left\"><code>source map</code> 转换为 <code>DataUrl</code> 后添加到 <code>bundle</code> 中</td>\n<td align=\"left\"><code>bundle</code> 体积巨增</td>\n</tr>\n<tr>\n<td align=\"center\"><code>cheap-source-map</code></td>\n<td align=\"left\">没有列映射(<code>column mapping</code>)的 <code>source map</code></td>\n<td align=\"left\">忽略 <code>loader source map</code></td>\n</tr>\n<tr>\n<td align=\"center\"><code>inline-cheap-source-map</code></td>\n<td align=\"left\">类似 <code>cheap-source-map</code>，但是 <code>source map</code> 转换为 <code>DataUrl</code> 后添加到 <code>bundle</code> 中</td>\n<td align=\"left\"><code>bundle</code> 体积增大</td>\n</tr>\n<tr>\n<td align=\"center\"><code>cheap-module-source-map</code></td>\n<td align=\"left\">没有列映射(<code>column mapping</code>)的 <code>source map</code>，将 <code>loader source map</code> 简化为每行一个映射(mapping)</td>\n<td align=\"left\">–</td>\n</tr>\n<tr>\n<td align=\"center\"><code>inline-cheap-module-source-map</code></td>\n<td align=\"left\">类似 <code>cheap-module-source-map</code>，但是 <code>source map</code> 转换为 <code>DataUrl</code> 添加到 <code>bundle</code> 中</td>\n<td align=\"left\">–</td>\n</tr>\n</tbody></table>\n<p><a href=\"https://webpack.docschina.org/configuration/devtool\">Webpack Devtool 配置</a>控制是否生成，以及如何生成 source map</p>\n<h4 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h4><p><a href=\"https://webpack.docschina.org/configuration/devtool\">Webpack 官方文档 - Devtool 配置</a><br><a href=\"https://zhuanlan.zhihu.com/p/135228801\">聊个 5 毛钱的 Source Map</a><br><a href=\"https://juejin.cn/post/6956047151843508232\">如何在正式环境无害的使用 sourceMap？</a><br><a href=\"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html\">JavaScript Source Map 详解</a></p>\n","feature":true,"text":"为什么需要 Source map？这个要从源码转换讲起，JavaScript 脚本正变得越来越复杂。大部分源码（尤其是各种函数库和框架）都要经过转换，才能投入生产环境。 常见的源码转换，主要是以下三种情况： （1）压缩，减小体积。比如 jQuery 1.9 的源码，压缩前是 25...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"Webpack","slug":"Webpack","count":1,"path":"api/tags/Webpack.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-Source-map%EF%BC%9F\"><span class=\"toc-text\">为什么需要 Source map？</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AF-Source-map%EF%BC%9F\"><span class=\"toc-text\">什么是 Source map？</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E5%90%AF%E7%94%A8-Source-map%EF%BC%9F\"><span class=\"toc-text\">如何启用 Source map？</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Source-map-%E5%AD%97%E6%AE%B5%E8%A7%A3%E8%AF%BB\"><span class=\"toc-text\">Source map 字段解读</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Webpack-Devtool-%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">Webpack Devtool 配置</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83\"><span class=\"toc-text\">参考</span></a></li></ol>","author":{"name":"Matrix","slug":"blog-author","avatar":"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/8/2/16c515569d19fc87~tplv-t2oaga2asx-no-mark:500:500:500:500.awebp","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"Chrome 80+","uid":"1be78549da2d3dbc703ef7208cb57948","slug":"chrome80","date":"2022-02-13T14:20:14.000Z","updated":"2022-02-16T12:53:55.947Z","comments":true,"path":"api/articles/chrome80.json","keywords":null,"cover":[],"text":"Chrome 80 策略更新Chrome 80 稳定版（版本号 v80.0.3987.87）已正式面向 Windows、macOS、Linux、Android 和 iOS 全平台推送 混合内容强制 HTTPS混合内容是指 https 页面下有非 https 资源时，浏览器的加载策...","link":"","photos":[],"count_time":{"symbolsCount":"5.7k","symbolsTime":"5 mins."},"categories":[],"tags":[],"author":{"name":"Matrix","slug":"blog-author","avatar":"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/8/2/16c515569d19fc87~tplv-t2oaga2asx-no-mark:500:500:500:500.awebp","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}