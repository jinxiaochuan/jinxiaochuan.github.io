[{"id":"2f91216609991253bb8453ebedd72331","title":"Webpack åˆå§‹åŒ–é˜¶æ®µ","content":"Webpack æ ¸å¿ƒä¹‹åˆå§‹åŒ–\n\n\n\n\n\n\n\n\nWebpack æ ¸å¿ƒåŠŸèƒ½å®˜æ–¹è§£é‡ŠAt its core, webpack is a static module bundler for modern JavaScript applications.å°†å„ç§ç±»å‹çš„èµ„æºï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€cssã€js ç­‰ï¼Œè½¬è¯‘ã€ç»„åˆã€æ‹¼æ¥ã€ç”Ÿæˆ JS æ ¼å¼çš„ bundler æ–‡ä»¶\n\nWebpack åˆå§‹åŒ–æ ¸å¿ƒä»£ç \n\n\n\n\n\n\n\n\nWebpack ç‰ˆæœ¬ä¸º v4.46.0\nconst webpack = (options, callback) => &#123;\n\tconst webpackOptionsValidationErrors = validateSchema(\n\t\twebpackOptionsSchema,\n\t\toptions\n\t);\n\tif (webpackOptionsValidationErrors.length) &#123;\n\t\tthrow new WebpackOptionsValidationError(webpackOptionsValidationErrors);\n\t&#125;\n\tlet compiler;\n\tif (Array.isArray(options)) &#123;\n\t\tcompiler = new MultiCompiler(\n\t\t\tArray.from(options).map(options => webpack(options))\n\t\t);\n\t&#125; else if (typeof options === \"object\") &#123;\n\t\toptions = new WebpackOptionsDefaulter().process(options);\n\n\t\tcompiler = new Compiler(options.context);\n\t\tcompiler.options = options;\n\t\tnew NodeEnvironmentPlugin(&#123;\n\t\t\tinfrastructureLogging: options.infrastructureLogging\n\t\t&#125;).apply(compiler);\n\t\tif (options.plugins &amp;&amp; Array.isArray(options.plugins)) &#123;\n\t\t\tfor (const plugin of options.plugins) &#123;\n\t\t\t\tif (typeof plugin === \"function\") &#123;\n\t\t\t\t\tplugin.call(compiler, compiler);\n\t\t\t\t&#125; else &#123;\n\t\t\t\t\tplugin.apply(compiler);\n\t\t\t\t&#125;\n\t\t\t&#125;\n\t\t&#125;\n\t\tcompiler.hooks.environment.call();\n\t\tcompiler.hooks.afterEnvironment.call();\n\t\tcompiler.options = new WebpackOptionsApply().process(options, compiler);\n\t&#125; else &#123;\n\t\tthrow new Error(\"Invalid argument: options\");\n\t&#125;\n\tif (callback) &#123;\n\t\tif (typeof callback !== \"function\") &#123;\n\t\t\tthrow new Error(\"Invalid argument: callback\");\n\t\t&#125;\n\t\tif (\n\t\t\toptions.watch === true ||\n\t\t\t(Array.isArray(options) &amp;&amp; options.some(o => o.watch))\n\t\t) &#123;\n\t\t\tconst watchOptions = Array.isArray(options)\n\t\t\t\t? options.map(o => o.watchOptions || &#123;&#125;)\n\t\t\t\t: options.watchOptions || &#123;&#125;;\n\t\t\treturn compiler.watch(watchOptions, callback);\n\t\t&#125;\n\t\tcompiler.run(callback);\n\t&#125;\n\treturn compiler;\n&#125;;\n\nåˆå§‹åŒ–å‚æ•°\n\n\n\n\n\n\n\n\n\nä» é…ç½®æ–‡ä»¶ã€ é…ç½®å¯¹è±¡ã€Shellå‚æ•° ä¸­è¯»å–ï¼Œä¸ é»˜è®¤é…ç½® ç»“åˆå¾—å‡ºæœ€ç»ˆçš„å‚æ•°\nå¯¹åº”çš„æ ¸å¿ƒä»£ç ä¸º options = new WebpackOptionsDefaulter().process(options) ä¸” class WebpackOptionsDefaulter extends OptionsDefaulter &#123;&#125;\næ ¹æ®ä¸åŒçš„åˆå¹¶è§„åˆ™è¿›è¡Œ options å’Œ é»˜è®¤é…ç½® çš„åˆå¹¶å¤„ç†\n\nclass OptionsDefaulter &#123;\n\tprocess(options) &#123;\n\t\toptions = Object.assign(&#123;&#125;, options);\n\t\tfor (let name in this.defaults) &#123;\n\t\t\tswitch (this.config[name]) &#123;\n\t\t\t\t/**\n\t\t\t\t * If &#123;@link ConfigType&#125; doesn't specified and current value is `undefined`, then default value will be assigned\n\t\t\t\t */\n\t\t\t\tcase undefined:\n\t\t\t\t\tif (getProperty(options, name) === undefined) &#123;\n\t\t\t\t\t\tsetProperty(options, name, this.defaults[name]);\n\t\t\t\t\t&#125;\n\t\t\t\t\tbreak;\n\t\t\t\t/**\n\t\t\t\t * Assign result of &#123;@link CallConfigHandler&#125;\n\t\t\t\t */\n\t\t\t\tcase \"call\":\n\t\t\t\t\tsetProperty(\n\t\t\t\t\t\toptions,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tthis.defaults[name].call(this, getProperty(options, name), options)\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t/**\n\t\t\t\t * Assign result of &#123;@link MakeConfigHandler&#125;, if current value is `undefined`\n\t\t\t\t */\n\t\t\t\tcase \"make\":\n\t\t\t\t\tif (getProperty(options, name) === undefined) &#123;\n\t\t\t\t\t\tsetProperty(options, name, this.defaults[name].call(this, options));\n\t\t\t\t\t&#125;\n\t\t\t\t\tbreak;\n\t\t\t\t/**\n\t\t\t\t * Adding &#123;@link AppendConfigValues&#125; at the end of the current array\n\t\t\t\t */\n\t\t\t\tcase \"append\": &#123;\n\t\t\t\t\tlet oldValue = getProperty(options, name);\n\t\t\t\t\tif (!Array.isArray(oldValue)) &#123;\n\t\t\t\t\t\toldValue = [];\n\t\t\t\t\t&#125;\n\t\t\t\t\toldValue.push(...this.defaults[name]);\n\t\t\t\t\tsetProperty(options, name, oldValue);\n\t\t\t\t\tbreak;\n\t\t\t\t&#125;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"OptionsDefaulter cannot process \" + this.config[name]\n\t\t\t\t\t);\n\t\t\t&#125;\n\t\t&#125;\n\t\treturn options;\n\t&#125;\n&#125;\n\nåˆ›å»ºç¼–è¯‘å™¨å¯¹è±¡\n\n\n\n\n\n\n\n\n\né€šè¿‡ä¸Šä¸€æ­¥å¾—åˆ°çš„ options.context å‚æ•°åˆ›å»º Compiler å¯¹è±¡\nå¯¹åº”çš„æ ¸å¿ƒä»£ç ä¸º compiler = new Compiler(options.context);\n\nåˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒ\n\n\n\n\n\n\n\n\n\nåŒ…æ‹¬æ³¨å…¥å†…ç½®æ’ä»¶ã€æ³¨å†Œå„ç§æ¨¡å—å·¥å‚ã€åˆå§‹åŒ– RuleSet é›†åˆã€åŠ è½½é…ç½®çš„æ’ä»¶ç­‰\nå¯¹åº”çš„æ ¸å¿ƒä»£ç ä¸º plugin.apply(compiler) å’Œ compiler.options = new WebpackOptionsApply().process(options, compiler);\n\nå¼€å§‹ç¼–è¯‘\n\n\n\n\n\n\n\n\n\næ‰§è¡Œ compiler å¯¹è±¡çš„ run æ–¹æ³•\nå¯¹åº”çš„æ ¸å¿ƒä»£ç ä¸º compiler.run(callback);\n\nrun(callback) &#123;\n  if (this.running) return callback(new ConcurrentCompilationError());\n\n  const finalCallback = (err, stats) => &#123;\n    this.running = false;\n\n    if (err) &#123;\n      this.hooks.failed.call(err);\n    &#125;\n\n    if (callback !== undefined) return callback(err, stats);\n  &#125;;\n\n  const startTime = Date.now();\n\n  this.running = true;\n\n  const onCompiled = (err, compilation) => &#123;\n    if (err) return finalCallback(err);\n\n    if (this.hooks.shouldEmit.call(compilation) === false) &#123;\n      const stats = new Stats(compilation);\n      stats.startTime = startTime;\n      stats.endTime = Date.now();\n      this.hooks.done.callAsync(stats, err => &#123;\n        if (err) return finalCallback(err);\n        return finalCallback(null, stats);\n      &#125;);\n      return;\n    &#125;\n\n    this.emitAssets(compilation, err => &#123;\n      if (err) return finalCallback(err);\n\n      if (compilation.hooks.needAdditionalPass.call()) &#123;\n        compilation.needAdditionalPass = true;\n\n        const stats = new Stats(compilation);\n        stats.startTime = startTime;\n        stats.endTime = Date.now();\n        this.hooks.done.callAsync(stats, err => &#123;\n          if (err) return finalCallback(err);\n\n          this.hooks.additionalPass.callAsync(err => &#123;\n            if (err) return finalCallback(err);\n            this.compile(onCompiled);\n          &#125;);\n        &#125;);\n        return;\n      &#125;\n\n      this.emitRecords(err => &#123;\n        if (err) return finalCallback(err);\n\n        const stats = new Stats(compilation);\n        stats.startTime = startTime;\n        stats.endTime = Date.now();\n        this.hooks.done.callAsync(stats, err => &#123;\n          if (err) return finalCallback(err);\n          return finalCallback(null, stats);\n        &#125;);\n      &#125;);\n    &#125;);\n  &#125;;\n\n  this.hooks.beforeRun.callAsync(this, err => &#123;\n    if (err) return finalCallback(err);\n\n    this.hooks.run.callAsync(this, err => &#123;\n      if (err) return finalCallback(err);\n\n      this.readRecords(err => &#123;\n        if (err) return finalCallback(err);\n\n        this.compile(onCompiled);\n      &#125;);\n    &#125;);\n  &#125;);\n&#125;\n\n\n\n\n\n\n\n\n\n\nthis.compile(onCompiled) æ˜¯æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹å¯åŠ¨çš„å…¥å£ä¸€ä¸ª compilation å¯¹è±¡è¡¨ç°äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ã€ä»¥åŠè¢«è·Ÿè¸ªä¾èµ–çš„çŠ¶æ€ä¿¡æ¯ï¼Œä»£è¡¨äº†ä¸€æ¬¡èµ„æºçš„æ„å»ºã€‚\ncompile(callback) &#123;\n  const params = this.newCompilationParams();\n  this.hooks.beforeCompile.callAsync(params, err => &#123;\n    if (err) return callback(err);\n\n    this.hooks.compile.call(params);\n\n    const compilation = this.newCompilation(params);\n\n    this.hooks.make.callAsync(compilation, err => &#123;\n      if (err) return callback(err);\n\n      compilation.finish(err => &#123;\n        if (err) return callback(err);\n\n        compilation.seal(err => &#123;\n          if (err) return callback(err);\n\n          this.hooks.afterCompile.callAsync(compilation, err => &#123;\n            if (err) return callback(err);\n\n            return callback(null, compilation);\n          &#125;);\n        &#125;);\n      &#125;);\n    &#125;);\n  &#125;);\n&#125;\n\nnewCompilationParams() &#123;\n  const params = &#123;\n    normalModuleFactory: this.createNormalModuleFactory(),\n    contextModuleFactory: this.createContextModuleFactory(),\n    compilationDependencies: new Set()\n  &#125;;\n  return params;\n&#125;\n\nnewCompilation(params) &#123;\n  const compilation = this.createCompilation();\n  compilation.fileTimestamps = this.fileTimestamps;\n  compilation.contextTimestamps = this.contextTimestamps;\n  compilation.name = this.name;\n  compilation.records = this.records;\n  compilation.compilationDependencies = params.compilationDependencies;\n  this.hooks.thisCompilation.call(compilation, params);\n  this.hooks.compilation.call(compilation, params);\n  return compilation;\n&#125;\n\næ€»ç»“\n\n\n\n\n\n\n\n\n\nå°† process.args + webpack.config.js åˆå¹¶æˆç”¨æˆ·é…ç½®\nè°ƒç”¨ validateSchema æ ¡éªŒé…ç½®\nè°ƒç”¨ new WebpackOptionsDefaulter().process(options) åˆå¹¶å‡ºæœ€ç»ˆé…ç½®\nåˆ›å»º compiler å¯¹è±¡\néå†ç”¨æˆ·å®šä¹‰çš„ plugins é›†åˆï¼Œæ‰§è¡Œæ’ä»¶çš„ apply æ–¹æ³•\nè°ƒç”¨ new WebpackOptionsApply().process(options, compiler) æ–¹æ³•ï¼ŒåŠ è½½å„ç§å†…ç½®æ’ä»¶\nä¸»è¦é€»è¾‘é›†ä¸­åœ¨ WebpackOptionsApply ç±»ï¼Œwebpack å†…ç½®äº†æ•°ç™¾ä¸ªæ’ä»¶ï¼Œè¿™äº›æ’ä»¶å¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é…ç½®ï¼ŒWebpackOptionsApply ä¼šåœ¨åˆå§‹åŒ–é˜¶æ®µæ ¹æ®é…ç½®å†…å®¹åŠ¨æ€æ³¨å…¥å¯¹åº”çš„æ’ä»¶ï¼Œæ¯”å¦‚åŒ…æ‹¬ï¼š\n\næ³¨å…¥ EntryOptionPlugin æ’ä»¶ï¼Œå¤„ç† entry é…ç½®\næ ¹æ® devtool å€¼åˆ¤æ–­åç»­ç”¨é‚£ä¸ªæ’ä»¶å¤„ç† sourcemapï¼Œå¯é€‰å€¼ï¼šEvalSourceMapDevToolPluginã€SourceMapDevToolPluginã€EvalDevToolModulePlugin\næ ¹æ® optimization.$&#123;key&#125; é…ç½®ï¼ˆ$&#123;key&#125; - removeAvailableModulesã€removeEmptyChunksã€mergeDuplicateChunksã€flagIncludedChunksã€sideEffectsã€providedExportsã€usedExportsã€concatenateModulesã€splitChunksã€runtimeChunkã€noEmitOnErrorsã€checkWasmTypesï¼‰è‡ªåŠ¨åŠ è½½å¯¹åº”çš„æ’ä»¶\næ³¨å…¥ RuntimePlugin ï¼Œç”¨äºæ ¹æ®ä»£ç å†…å®¹åŠ¨æ€æ³¨å…¥ webpack è¿è¡Œæ—¶\n\n\ncompiler.run å®é™…è°ƒç”¨ compiler.compile å‡½æ•°ï¼Œå®é™…è°ƒç”¨ this.hooks.make.callAsyncï¼Œä»è€Œè§¦å‘ EntryPlugin çš„ compiler.hooks.make.tapAsync å›è°ƒï¼Œåœ¨å›è°ƒä¸­æ‰§è¡Œ compilation.addEntry å‡½æ•°ï¼›compilation.addEntry å‡½æ•°å†…éƒ¨ç»è¿‡ä¸€å¨ä¸ä¸»æµç¨‹æ— å…³çš„ hook ä¹‹åï¼Œå†è°ƒç”¨ handleModuleCreate å‡½æ•°ï¼Œæ­£å¼å¼€å§‹æ„å»ºå†…å®¹\n\n\nå‚è€ƒ[ä¸‡å­—æ€»ç»“] ä¸€æ–‡åƒé€ Webpack æ ¸å¿ƒåŸç†[æºç è§£è¯»] Webpack æ’ä»¶æ¶æ„æ·±åº¦è®²è§£\n","slug":"webpack-stage-init","date":"2022-02-19T22:52:44.000Z","categories_index":"","tags_index":"Webpack","author_index":"Matrix"},{"id":"e8dd10177843eb97f466f57c44ebeb35","title":"React åˆæˆäº‹ä»¶ç³»ç»Ÿ","content":"\nJSX äº‹ä»¶ç»‘å®š -&gt; Fiberclass Index extends React.Component&#123;\n    handerClick= (value) => console.log(value)\n    render()&#123;\n        return &lt;div>\n            &lt;button onClick=&#123; this.handerClick &#125; > æŒ‰é’®ç‚¹å‡» &lt;/button>\n        &lt;/div>\n    &#125;\n&#125;\n\nç»è¿‡ babel è½¬æ¢æˆ React.createElement å½¢å¼æœ€ç»ˆè½¬æˆ fiber å¯¹è±¡å½¢å¼å¦‚ä¸‹fiber å¯¹è±¡ä¸Šçš„ memoizedProps å’Œ pendingProps ä¿å­˜äº†æˆ‘ä»¬çš„äº‹ä»¶ã€‚\nä»€ä¹ˆæ˜¯ React åˆæˆäº‹ä»¶ï¼Ÿclass Index extends React.Component&#123;\n    componentDidMount()&#123;\n        console.log(this)\n    &#125;\n    handerClick= (value) => console.log(value)\n    handerChange=(value) => console.log(value)\n    render()&#123;\n        return &lt;div>\n            &lt;button onClick=&#123;this.handerClick&#125; > æŒ‰é’®ç‚¹å‡» &lt;/button>\n            &lt;input placeholder=\"è¯·è¾“å…¥å†…å®¹\" onChange=&#123;this.handerChange&#125;  />\n        &lt;/div>\n    &#125;\n&#125;\n\næˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ input dom å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹ document ä¸Šç»‘å®šçš„äº‹ä»¶æˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬ç»™ &lt;input&gt; ç»‘å®šçš„ onChangeï¼Œå¹¶æ²¡æœ‰ç›´æ¥ç»‘å®šåœ¨ input ä¸Šï¼Œè€Œæ˜¯ç»Ÿä¸€ç»‘å®šåœ¨äº† document ä¸Šï¼Œç„¶åæˆ‘ä»¬ onChange è¢«å¤„ç†æˆå¾ˆå¤šäº‹ä»¶ç›‘å¬å™¨ï¼Œæ¯”å¦‚ blur , change , input , keydown , keyup ç­‰ã€‚\n\n\n\n\n\n\n\n\n\nç»¼ä¸Šæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šâ‘  æˆ‘ä»¬åœ¨ jsx ä¸­ç»‘å®šçš„äº‹ä»¶(handerClickï¼ŒhanderChange),æ ¹æœ¬å°±æ²¡æœ‰æ³¨å†Œåˆ°çœŸå®çš„ dom ä¸Šã€‚æ˜¯ç»‘å®šåœ¨ document ä¸Šç»Ÿä¸€ç®¡ç†çš„ã€‚â‘¡ çœŸå®çš„ dom ä¸Šçš„ click äº‹ä»¶è¢«å•ç‹¬å¤„ç†,å·²ç»è¢« react åº•å±‚æ›¿æ¢æˆç©ºå‡½æ•°ã€‚â‘¢ æˆ‘ä»¬åœ¨ react ç»‘å®šçš„äº‹ä»¶,æ¯”å¦‚ onChangeï¼Œåœ¨ document ä¸Šï¼Œå¯èƒ½æœ‰å¤šä¸ªäº‹ä»¶ä¸ä¹‹å¯¹åº”ã€‚â‘£ react å¹¶ä¸æ˜¯ä¸€å¼€å§‹ï¼ŒæŠŠæ‰€æœ‰çš„äº‹ä»¶éƒ½ç»‘å®šåœ¨ document ä¸Šï¼Œè€Œæ˜¯é‡‡å–äº†ä¸€ç§æŒ‰éœ€ç»‘å®šï¼Œæ¯”å¦‚å‘ç°äº† onClick äº‹ä»¶,å†å»ç»‘å®š document click äº‹ä»¶ã€‚\näº‹ä»¶åˆæˆçš„æ’ä»¶æœºåˆ¶å¿…è¦æ¦‚å¿µâ‘ namesToPlugins - äº‹ä»¶å -&gt; äº‹ä»¶æ¨¡å—æ’ä»¶çš„æ˜ å°„\nconst namesToPlugins = &#123;\n  SimpleEventPlugin,\n  EnterLeaveEventPlugin,\n  ChangeEventPlugin,\n  SelectEventPlugin,\n  BeforeInputEventPlugin,\n&#125;\n\nâ‘¡plugins - æ³¨å†Œçš„æ‰€æœ‰æ’ä»¶åˆ—è¡¨,åˆå§‹åŒ–ä¸ºç©º\nconst plugins = [LegacySimpleEventPlugin, LegacyEnterLeaveEventPlugin, ...];\n\nâ‘¢registrationNameModules - åˆæˆçš„äº‹ä»¶ -&gt; äº‹ä»¶æ’ä»¶çš„æ˜ å°„\n&#123;\n    onBlur: SimpleEventPlugin,\n    onClick: SimpleEventPlugin,\n    onClickCapture: SimpleEventPlugin,\n    onChange: ChangeEventPlugin,\n    onChangeCapture: ChangeEventPlugin,\n    onMouseEnter: EnterLeaveEventPlugin,\n    onMouseLeave: EnterLeaveEventPlugin,\n    ...\n&#125;\n\nâ‘£ äº‹ä»¶æ’ä»¶ - ä»¥ SimpleEventPlugin ä¸ºä¾‹\nconst SimpleEventPlugin = &#123;\n    eventTypes:&#123;\n        'click':&#123; /* å¤„ç†ç‚¹å‡»äº‹ä»¶  */\n            phasedRegistrationNames:&#123;\n                bubbled: 'onClick',       // å¯¹åº”äº‹ä»¶å†’æ³¡é˜¶æ®µ - onClick\n                captured:'onClickCapture' // å¯¹åº”äº‹ä»¶æ•è·é˜¶æ®µ - onClickCapture\n            &#125;,\n            dependencies: ['click'], // äº‹ä»¶ä¾èµ–\n            ...\n        &#125;,\n        'blur':&#123; /* å¤„ç†å¤±å»ç„¦ç‚¹äº‹ä»¶ */ &#125;,\n        ...\n    &#125;\n    extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget)&#123; /* eventTypes é‡Œé¢çš„äº‹ä»¶å¯¹åº”çš„ç»Ÿä¸€äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ¥ä¸‹æ¥ä¼šé‡ç‚¹è®²åˆ° */ &#125;\n&#125;\n\nå³ï¼šäº‹ä»¶æ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰ä¸¤ä¸ªå±æ€§ï¼ŒextractEvents ä½œä¸ºäº‹ä»¶ç»Ÿä¸€å¤„ç†å‡½æ•°ï¼›eventTypes å¯¹è±¡ä¿å­˜äº†åŸç”Ÿäº‹ä»¶åå’Œå¯¹åº”çš„é…ç½®é¡¹ dispatchConfig çš„æ˜ å°„å…³ç³»ã€‚\nç”±äº React v16 çš„äº‹ä»¶æ˜¯ç»Ÿä¸€ç»‘å®šåœ¨ document ä¸Šçš„ï¼ŒReact ç”¨ç‹¬ç‰¹çš„äº‹ä»¶åç§°æ¯”å¦‚ onClick å’Œ onClickCaptureï¼Œæ¥è¯´æ˜æˆ‘ä»¬ç»™ç»‘å®šçš„å‡½æ•°åˆ°åº•æ˜¯åœ¨å†’æ³¡äº‹ä»¶é˜¶æ®µï¼Œè¿˜æ˜¯æ•è·äº‹ä»¶é˜¶æ®µæ‰§è¡Œã€‚\nâ‘¤ registrationNameDependencies - è®°å½•åˆæˆäº‹ä»¶ -&gt; åŸç”Ÿäº‹ä»¶çš„æ˜ å°„å…³ç³»\næ¯”å¦‚ onClick å’ŒåŸç”Ÿäº‹ä»¶ click å¯¹åº”å…³ç³»æ¯”å¦‚ onChange å¯¹åº” change , input , keydown , keyup äº‹ä»¶\n&#123;\n    onBlur: ['blur'],\n    onClick: ['click'],\n    onClickCapture: ['click'],\n    onChange: ['blur', 'change', 'click', 'focus', 'input', 'keydown', 'keyup', 'selectionchange'],\n    onMouseEnter: ['mouseout', 'mouseover'],\n    onMouseLeave: ['mouseout', 'mouseover'],\n    ...\n&#125;\n\näº‹ä»¶åˆå§‹åŒ–å¯¹äºäº‹ä»¶åˆæˆï¼Œv16.13.1 ç‰ˆæœ¬ react é‡‡ç”¨äº†åˆå§‹åŒ–æ³¨å†Œæ–¹å¼ã€‚\n/* ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œäº‹ä»¶ï¼šreact-dom/src/client/ReactDOMClientInjection.js  */\ninjectEventPluginsByName(&#123;\n    SimpleEventPlugin: SimpleEventPlugin,\n    EnterLeaveEventPlugin: EnterLeaveEventPlugin,\n    ChangeEventPlugin: ChangeEventPlugin,\n    SelectEventPlugin: SelectEventPlugin,\n    BeforeInputEventPlugin: BeforeInputEventPlugin,\n&#125;);\n\n\n/* æ³¨å†Œäº‹ä»¶æ’ä»¶ */\nexport function injectEventPluginsByName(injectedNamesToPlugins)&#123;\n     for (const pluginName in injectedNamesToPlugins) &#123;\n         namesToPlugins[pluginName] = injectedNamesToPlugins[pluginName]\n     &#125;\n     recomputePluginOrdering()\n&#125;\n\ninjectEventPluginsByName åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå½¢æˆä¸Šè¿°çš„ namesToPluginsï¼Œç„¶åæ‰§è¡Œ recomputePluginOrdering\nconst eventPluginOrder = [ 'SimpleEventPlugin' , 'EnterLeaveEventPlugin','ChangeEventPlugin','SelectEventPlugin' , 'BeforeInputEventPlugin' ]\n\nfunction recomputePluginOrdering()&#123;\n    for (const pluginName in namesToPlugins) &#123;\n        /* æ‰¾åˆ°å¯¹åº”çš„äº‹ä»¶å¤„ç†æ’ä»¶ï¼Œæ¯”å¦‚ SimpleEventPlugin  */\n        const pluginModule = namesToPlugins[pluginName];\n        const pluginIndex = eventPluginOrder.indexOf(pluginName);\n        /* å¡«å…… plugins æ•°ç»„  */\n        plugins[pluginIndex] = pluginModule;\n        const publishedEvents = pluginModule.eventTypes;\n    for (const eventName in publishedEvents) &#123;\n       // publishedEvents[eventName] -> eventConfig , pluginModule -> äº‹ä»¶æ’ä»¶ ï¼Œ eventName -> äº‹ä»¶åç§°\n        publishEventForPlugin(publishedEvents[eventName],pluginModule,eventName,)\n    &#125;\n    &#125;\n&#125;\n\nrecomputePluginOrdering ä½œç”¨å¾ˆæ˜ç¡®äº†ï¼Œå½¢æˆä¸Šé¢è¯´çš„é‚£ä¸ª plugins æ•°ç»„ã€‚ç„¶åå°±æ˜¯é‡ç‚¹çš„å‡½æ•° publishEventForPlugin\n/*\n  dispatchConfig -> åŸç”Ÿäº‹ä»¶å¯¹åº”é…ç½®é¡¹ &#123; phasedRegistrationNames :&#123;  å†’æ³¡ æ•è·  &#125; ï¼Œ   &#125;\n  pluginModule -> äº‹ä»¶æ’ä»¶ æ¯”å¦‚SimpleEventPlugin\n  eventName -> åŸç”Ÿäº‹ä»¶åç§°ã€‚\n*/\nfunction publishEventForPlugin (dispatchConfig,pluginModule,eventName)&#123;\n    eventNameDispatchConfigs[eventName] = dispatchConfig;\n    /* äº‹ä»¶ */\n    const phasedRegistrationNames = dispatchConfig.phasedRegistrationNames;\n    if (phasedRegistrationNames) &#123;\n    for (const phaseName in phasedRegistrationNames) &#123;\n        if (phasedRegistrationNames.hasOwnProperty(phaseName)) &#123;\n            // phasedRegistrationName Reactäº‹ä»¶å æ¯”å¦‚ onClick / onClickCapture\n            const phasedRegistrationName = phasedRegistrationNames[phaseName];\n            // å¡«å……å½¢æˆ registrationNameModules React åˆæˆäº‹ä»¶ -> React å¤„ç†äº‹ä»¶æ’ä»¶æ˜ å°„å…³ç³»\n            registrationNameModules[phasedRegistrationName] = pluginModule;\n            // å¡«å……å½¢æˆ registrationNameDependencies React åˆæˆäº‹ä»¶ -> åŸç”Ÿäº‹ä»¶ æ˜ å°„å…³ç³»\n            registrationNameDependencies[phasedRegistrationName] = pluginModule.eventTypes[eventName].dependencies;\n        &#125;\n    &#125;\n    return true;\n    &#125;\n&#125;\n\näº‹ä»¶åˆæˆæ€»ç»“åˆå§‹åŒ–äº‹ä»¶åˆæˆé˜¶æ®µä¸»è¦åšäº†ï¼šå½¢æˆäº†ä¸Šè¿°çš„å‡ ä¸ªé‡è¦å¯¹è±¡ï¼Œæ„å»ºåˆå§‹åŒ– React åˆæˆäº‹ä»¶å’ŒåŸç”Ÿäº‹ä»¶çš„å¯¹åº”å…³ç³»ï¼Œåˆæˆäº‹ä»¶å’Œå¯¹åº”çš„äº‹ä»¶å¤„ç†æ’ä»¶å…³ç³»ã€‚\näº‹ä»¶ç»‘å®šæµç¨‹diffProperties å¤„ç† React åˆæˆäº‹ä»¶\nReact åœ¨è°ƒåˆå­èŠ‚ç‚¹åï¼Œè¿›å…¥ diff é˜¶æ®µï¼Œå¦‚æœåˆ¤æ–­æ˜¯ HostComponent(dom å…ƒç´ )ç±»å‹çš„ fiberï¼Œä¼šç”¨ diff props å‡½æ•° diffProperties å•ç‹¬å¤„ç†\n// react-dom/src/client/ReactDOMComponent.js\nfunction diffProperties()&#123;\n    /* åˆ¤æ–­å½“å‰çš„ propKey æ˜¯ä¸æ˜¯ Reactåˆæˆäº‹ä»¶ */\n    if(registrationNameModules.hasOwnProperty(propKey))&#123;\n         /* è¿™é‡Œå¤šä¸ªå‡½æ•°ç®€åŒ–äº†ï¼Œå¦‚æœæ˜¯åˆæˆäº‹ä»¶ï¼Œ ä¼ å…¥æˆäº‹ä»¶åç§° onClick ï¼Œå‘documentæ³¨å†Œäº‹ä»¶  */\n         legacyListenToEvent(registrationName, documentï¼‰;\n    &#125;\n&#125;\n\ndiffProperties å‡½æ•°åœ¨ diff props å¦‚æœå‘ç°æ˜¯åˆæˆäº‹ä»¶(onClick) å°±ä¼šè°ƒç”¨ legacyListenToEvent å‡½æ•°ã€‚æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨\nlegacyListenToEvent æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨//  registrationName -> onClick äº‹ä»¶\n//  mountAt -> document or container\nfunction legacyListenToEvent(registrationNameï¼ŒmountAt)&#123;\n   const dependencies = registrationNameDependencies[registrationName]; // æ ¹æ® onClick è·å–  onClick ä¾èµ–çš„äº‹ä»¶æ•°ç»„ [ 'click' ]ã€‚\n    for (let i = 0; i &lt; dependencies.length; i++) &#123;\n    const dependency = dependencies[i];\n    //è¿™ä¸ªç»è¿‡å¤šä¸ªå‡½æ•°ç®€åŒ–ï¼Œå¦‚æœæ˜¯ click åŸºç¡€äº‹ä»¶ï¼Œä¼šèµ° legacyTrapBubbledEvent ,è€Œä¸”éƒ½æ˜¯æŒ‰ç…§å†’æ³¡å¤„ç†\n     legacyTrapBubbledEvent(dependency, mountAt);\n  &#125;\n&#125;\n\n\n\n\n\n\n\n\n\n\næ³¨æ„ âš ï¸ï¼šåœ¨ legacyListenToEvent å‡½æ•°ä¸­ï¼Œå…ˆæ‰¾åˆ° React åˆæˆäº‹ä»¶å¯¹åº”çš„åŸç”Ÿäº‹ä»¶é›†åˆï¼Œæ¯”å¦‚ onClick -&gt; [&#39;click&#39;] , onChange -&gt; [blur , change , input , keydown , keyup]ï¼Œç„¶åéå†ä¾èµ–é¡¹çš„æ•°ç»„ï¼Œç»‘å®šäº‹ä»¶ï¼Œè¿™å°±è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨åˆšå¼€å§‹çš„ demo ä¸­ï¼Œåªç»™å…ƒç´ ç»‘å®šäº†ä¸€ä¸ª onChange äº‹ä»¶ï¼Œç»“æœåœ¨ document ä¸Šå‡ºç°å¾ˆå¤šäº‹ä»¶ç›‘å¬å™¨çš„åŸå› ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªå‡½æ•°ä¸Šå¤„ç†çš„\nlegacyTrapBubbledEvent å°±æ˜¯æ‰§è¡Œå°†ç»‘å®šçœŸæ­£çš„ dom äº‹ä»¶çš„å‡½æ•° legacyTrapBubbledEvent(å†’æ³¡å¤„ç†)ã€‚\nfunction legacyTrapBubbledEvent(topLevelType,element)&#123;\n   addTrappedEventListener(element,topLevelType,PLUGIN_EVENT_SYSTEM,false)\n&#125;\n\n\n\n\n\n\n\n\n\n\næ³¨æ„ âš ï¸ï¼šReact æ˜¯é‡‡ç”¨äº‹ä»¶ç»‘å®šï¼ŒReact å¯¹äº click ç­‰åŸºç¡€äº‹ä»¶ï¼Œä¼šé»˜è®¤æŒ‰ç…§äº‹ä»¶ å†’æ³¡é˜¶æ®µ çš„äº‹ä»¶å¤„ç†ï¼Œä¸è¿‡è¿™ä¹Ÿä¸ç»å¯¹çš„ï¼Œæ¯”å¦‚ä¸€äº›äº‹ä»¶çš„å¤„ç†ï¼Œæœ‰äº›ç‰¹æ®Šçš„äº‹ä»¶ï¼Œå¦‚ scrollã€focusã€blur æ˜¯æŒ‰ç…§ äº‹ä»¶æ•è· å¤„ç†çš„ã€‚\ncase TOP_SCROLL: &#123;                                // scroll äº‹ä»¶\n    legacyTrapCapturedEvent(TOP_SCROLL, mountAt); // legacyTrapCapturedEvent äº‹ä»¶æ•è·å¤„ç†ã€‚\n    break;\n&#125;\ncase TOP_FOCUS: // focus äº‹ä»¶\ncase TOP_BLUR:  // blur äº‹ä»¶\nlegacyTrapCapturedEvent(TOP_FOCUS, mountAt);\nlegacyTrapCapturedEvent(TOP_BLUR, mountAt);\nbreak;\n\nç»‘å®š dispatchEventï¼Œè¿›è¡Œäº‹ä»¶ç›‘å¬å¦‚ä¸Šè¿°çš„ scroll äº‹ä»¶ï¼Œfocus äº‹ä»¶ ï¼Œblur äº‹ä»¶ç­‰ï¼Œæ˜¯é»˜è®¤æŒ‰ç…§äº‹ä»¶æ•è·é€»è¾‘å¤„ç†ã€‚æ¥ä¸‹æ¥å°±æ˜¯æœ€é‡è¦å…³é”®çš„ä¸€æ­¥ã€‚React æ˜¯å¦‚ä½•ç»‘å®šäº‹ä»¶åˆ° documentï¼Ÿ äº‹ä»¶å¤„ç†å‡½æ•°å‡½æ•°åˆæ˜¯ä»€ä¹ˆï¼Ÿé—®é¢˜éƒ½æŒ‡å‘äº†ä¸Šè¿°çš„ addTrappedEventListenerï¼Œè®©æˆ‘ä»¬æ¥æ­å¼€å®ƒçš„é¢çº±ã€‚\n/*\n  targetContainer -> document\n  topLevelType ->  click\n  capture = false\n*/\nfunction addTrappedEventListener(targetContainer,topLevelType,eventSystemFlags,capture)&#123;\n   const listener = dispatchEvent.bind(null,topLevelType,eventSystemFlags,targetContainer)\n   if(capture)&#123;\n       // äº‹ä»¶æ•è·é˜¶æ®µå¤„ç†å‡½æ•°ã€‚\n   &#125;else&#123;\n       /* TODO: é‡è¦, è¿™é‡Œè¿›è¡ŒçœŸæ­£çš„äº‹ä»¶ç»‘å®šã€‚*/\n      targetContainer.addEventListener(topLevelType,listener,false) // document.addEventListener('click',listener,false)\n   &#125;\n&#125;\n\nè¿™ä¸ªå‡½æ•°å†…å®¹è™½ç„¶ä¸å¤šï¼Œä½†æ˜¯å´éå¸¸é‡è¦,é¦–å…ˆç»‘å®šæˆ‘ä»¬çš„äº‹ä»¶ç»Ÿä¸€å¤„ç†å‡½æ•° dispatchEventï¼Œç»‘å®šå‡ ä¸ªé»˜è®¤å‚æ•°ï¼Œäº‹ä»¶ç±»å‹ topLevelType demo ä¸­çš„ click ï¼Œè¿˜æœ‰ç»‘å®šçš„å®¹å™¨ doucmentã€‚ç„¶åçœŸæ­£çš„äº‹ä»¶ç»‘å®š,æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ addEventListenerï¼Œ äº‹ä»¶ç»‘å®šé˜¶æ®µå®Œæ¯•ã€‚\näº‹ä»¶è§¦å‘æµç¨‹extractEvents å½¢æˆäº‹ä»¶å¯¹è±¡ event å’Œ äº‹ä»¶å¤„ç†å‡½æ•°é˜Ÿåˆ—\nconst  SimpleEventPlugin = &#123;\n    extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget)&#123;\n        const dispatchConfig = topLevelEventsToDispatchConfig.get(topLevelType);\n        if (!dispatchConfig) &#123;\n            return null;\n        &#125;\n        switch(topLevelType)&#123;\n            default:\n            EventConstructor = SyntheticEvent;\n            break;\n        &#125;\n        /* äº§ç”Ÿäº‹ä»¶æºå¯¹è±¡ */\n        const event = EventConstructor.getPooled(dispatchConfig,targetInst,nativeEvent,nativeEventTarget)\n        const phasedRegistrationNames = event.dispatchConfig.phasedRegistrationNames;\n        const dispatchListeners = [];\n        const &#123;bubbled, captured&#125; = phasedRegistrationNames; /* onClick / onClickCapture */\n        const dispatchInstances = [];\n        /* ä»äº‹ä»¶æºå¼€å§‹é€æ¸å‘ä¸Šï¼ŒæŸ¥æ‰¾domå…ƒç´ ç±»å‹HostComponentå¯¹åº”çš„fiber ï¼Œæ”¶é›†ä¸Šé¢çš„Reactåˆæˆäº‹ä»¶ï¼ŒonClick / onClickCapture  */\n         while (instance !== null) &#123;\n              const &#123;stateNode, tag&#125; = instance;\n              if (tag === HostComponent &amp;&amp; stateNode !== null) &#123; /* DOM å…ƒç´  */\n                   const currentTarget = stateNode;\n                   if (captured !== null) &#123; /* äº‹ä»¶æ•è· */\n                        /* åœ¨äº‹ä»¶æ•è·é˜¶æ®µ,çœŸæ­£çš„äº‹ä»¶å¤„ç†å‡½æ•° */\n                        const captureListener = getListener(instance, captured);\n                        if (captureListener != null) &#123;\n                        /* å¯¹åº”å‘ç”Ÿåœ¨äº‹ä»¶æ•è·é˜¶æ®µçš„å¤„ç†å‡½æ•°ï¼Œé€»è¾‘æ˜¯å°†æ‰§è¡Œå‡½æ•°unshiftæ·»åŠ åˆ°é˜Ÿåˆ—çš„æœ€å‰é¢ */\n                            dispatchListeners.unshift(captureListener);\n                            dispatchInstances.unshift(instance);\n                            dispatchCurrentTargets.unshift(currentTarget);\n                        &#125;\n                    &#125;\n                    if (bubbled !== null) &#123; /* äº‹ä»¶å†’æ³¡ */\n                        /* äº‹ä»¶å†’æ³¡é˜¶æ®µï¼ŒçœŸæ­£çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œé€»è¾‘æ˜¯å°†æ‰§è¡Œå‡½æ•°pushåˆ°æ‰§è¡Œé˜Ÿåˆ—çš„æœ€åé¢ */\n                        const bubbleListener = getListener(instance, bubbled);\n                        if (bubbleListener != null) &#123;\n                            dispatchListeners.push(bubbleListener);\n                            dispatchInstances.push(instance);\n                            dispatchCurrentTargets.push(currentTarget);\n                        &#125;\n                    &#125;\n              &#125;\n              instance = instance.return;\n         &#125;\n          if (dispatchListeners.length > 0) &#123;\n              /* å°†å‡½æ•°æ‰§è¡Œé˜Ÿåˆ—ï¼ŒæŒ‚åˆ°äº‹ä»¶å¯¹è±¡eventä¸Š */\n            event._dispatchListeners = dispatchListeners;\n            event._dispatchInstances = dispatchInstances;\n            event._dispatchCurrentTargets = dispatchCurrentTargets;\n         &#125;\n        return event\n    &#125;\n&#125;\n\n\n\n\n\n\n\n\n\n\näº‹ä»¶æ’ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒ extractEvents ä¸»è¦åšçš„äº‹æ˜¯:\nâ‘  é¦–å…ˆå½¢æˆ React äº‹ä»¶ç‹¬æœ‰çš„åˆæˆäº‹ä»¶æºå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ï¼Œä¿å­˜äº†æ•´ä¸ªäº‹ä»¶çš„ä¿¡æ¯ã€‚å°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™çœŸæ­£çš„äº‹ä»¶å¤„ç†å‡½æ•°(handerClick)ã€‚â‘¡ ç„¶åå£°æ˜äº‹ä»¶æ‰§è¡Œé˜Ÿåˆ— ï¼ŒæŒ‰ç…§å†’æ³¡å’Œæ•è·é€»è¾‘ï¼Œä»äº‹ä»¶æºå¼€å§‹é€æ¸å‘ä¸Šï¼ŒæŸ¥æ‰¾ dom å…ƒç´ ç±»å‹ HostComponent å¯¹åº”çš„ fiber ï¼Œæ”¶é›†ä¸Šé¢çš„ React åˆæˆäº‹ä»¶ï¼Œä¾‹å¦‚ onClick &#x2F; onClickCapture ï¼Œå¯¹äºå†’æ³¡é˜¶æ®µçš„äº‹ä»¶(onClick)ï¼Œå°† push åˆ°æ‰§è¡Œé˜Ÿåˆ—åé¢ ï¼Œ å¯¹äºæ•è·é˜¶æ®µçš„äº‹ä»¶(onClickCapture)ï¼Œå°† unShift åˆ°æ‰§è¡Œé˜Ÿåˆ—çš„å‰é¢ã€‚â‘¢ æœ€åå°†äº‹ä»¶æ‰§è¡Œé˜Ÿåˆ—ï¼Œä¿å­˜åˆ° React äº‹ä»¶æºå¯¹è±¡ä¸Šã€‚ç­‰å¾…æ‰§è¡Œã€‚\n\n\n\n\n\n\n\n\n\nä¸¾ä¸ª ğŸŒ°\nrender()&#123;\n   return &lt;div onClick=&#123; this.handerClick2 &#125; onClickCapture=&#123; this.handerClick3 &#125;>\n       &lt;button onClick=&#123; this.handerClick &#125;  onClickCapture=&#123; this.handerClick1 &#125;>ç‚¹å‡»&lt;/button>\n   &lt;/div>\n&#125;\n\n\näº‹ä»¶è§¦å‘React çš„äº‹ä»¶æºå¯¹è±¡ SyntheticEvent\nfunction SyntheticEvent( dispatchConfig,targetInst,nativeEvent,nativeEventTarget)&#123;\n  this.dispatchConfig = dispatchConfig;\n  this._targetInst = targetInst;\n  this.nativeEvent = nativeEvent;\n  this._dispatchListeners = null;\n  this._dispatchInstances = null;\n  this._dispatchCurrentTargets = null;\n  this.isPropagationStopped = () => false; /* åˆå§‹åŒ–ï¼Œè¿”å›ä¸ºfalse  */\n\n&#125;\nSyntheticEvent.prototype=&#123;\n    stopPropagation()&#123; this.isPropagationStopped = () => true;  &#125;, /* Reactå•ç‹¬å¤„ç†ï¼Œé˜»æ­¢äº‹ä»¶å†’æ³¡å‡½æ•° */\n    preventDefault()&#123; &#125;,  /* Reactå•ç‹¬å¤„ç†ï¼Œé˜»æ­¢äº‹ä»¶æ•è·å‡½æ•°  */\n    ...\n&#125;\n\näº‹ä»¶æ‰§è¡Œé˜Ÿåˆ— å’Œ äº‹ä»¶æºå¯¹è±¡ éƒ½å½¢æˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æœ€åä¸€æ­¥äº‹ä»¶è§¦å‘äº†ã€‚ä¸Šé¢å¤§å®¶æœ‰æ²¡æœ‰æ³¨æ„åˆ°ä¸€ä¸ªå‡½æ•° runEventsInBatchï¼Œæ‰€æœ‰äº‹ä»¶ç»‘å®šå‡½æ•°ï¼Œå°±æ˜¯åœ¨è¿™é‡Œè§¦å‘çš„\nfunction runEventsInBatch()&#123;\n    const dispatchListeners = event._dispatchListeners;\n    const dispatchInstances = event._dispatchInstances;\n    if (Array.isArray(dispatchListeners)) &#123;\n    for (let i = 0; i &lt; dispatchListeners.length; i++) &#123;\n      if (event.isPropagationStopped()) &#123; /* åˆ¤æ–­æ˜¯å¦å·²ç»é˜»æ­¢äº‹ä»¶å†’æ³¡ */\n        break;\n      &#125;\n\n      dispatchListeners[i](event)\n    &#125;\n  &#125;\n  /* æ‰§è¡Œå®Œå‡½æ•°ï¼Œç½®ç©ºä¸¤å­—æ®µ */\n  event._dispatchListeners = null;\n  event._dispatchInstances = null;\n&#125;\n\n\n\n\n\n\n\n\n\n\næ³¨æ„ âš ï¸ï¼šReact å¯¹äº é˜»æ­¢å†’æ³¡ï¼Œå°±æ˜¯é€šè¿‡ isPropagationStopped åˆ¤æ–­æ˜¯å¦å·²ç»é˜»æ­¢äº‹ä»¶å†’æ³¡ã€‚å¦‚æœæˆ‘ä»¬åœ¨äº‹ä»¶å‡½æ•°æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼ŒæŸä¸€ä¼šå‡½æ•°ä¸­ï¼Œè°ƒç”¨ e.stopPropagation() å°±ä¼šèµ‹å€¼ç»™ isPropagationStopped = () =&gt; trueï¼Œå½“å†æ‰§è¡Œ e.isPropagationStopped() å°±ä¼šè¿”å› true ,æ¥ä¸‹æ¥äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå°±ä¸ä¼šæ‰§è¡Œäº†ã€‚åŒç†ï¼Œå¯¹äº é˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º ä¹Ÿå¿…é¡»ä½¿ç”¨ e.preventDefault() å³\n// ä»¥ä¸‹é€»è¾‘ä¸èƒ½é˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸ºã€‚\nhanderClick() &#123;\n   return false\n&#125;\n// åº”è¯¥æ”¹ä¸º\nhanderClick(e) &#123;\n   e.preventDefault()\n&#125;\nå…¶ä»–æ¦‚å¿µ-äº‹ä»¶æ±  handerClick = (e) => &#123;\n    console.log(e.target) // button\n    setTimeout(()=>&#123;\n        console.log(e.target) // null\n    &#125;,0)\n&#125;\n\nå¯¹äºä¸€æ¬¡ç‚¹å‡»äº‹ä»¶çš„å¤„ç†å‡½æ•°ï¼Œåœ¨æ­£å¸¸çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ‰“å° e.target å°±æŒ‡å‘äº† dom å…ƒç´ ï¼Œä½†æ˜¯åœ¨ setTimeout ä¸­æ‰“å°å´æ˜¯ nullï¼Œå¦‚æœè¿™ä¸æ˜¯ React äº‹ä»¶ç³»ç»Ÿï¼Œä¸¤æ¬¡æ‰“å°çš„åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¸¤æ¬¡æ‰“å°ä¸ä¸€æ ·å‘¢ï¼Ÿ\n\n\n\n\n\n\n\n\n\nå› ä¸ºåœ¨ React é‡‡å–äº†ä¸€ä¸ªäº‹ä»¶æ± çš„æ¦‚å¿µï¼Œæ¯æ¬¡æˆ‘ä»¬ç”¨çš„äº‹ä»¶æºå¯¹è±¡ï¼Œåœ¨äº‹ä»¶å‡½æ•°æ‰§è¡Œä¹‹åï¼Œå¯ä»¥é€šè¿‡ releaseTopLevelCallbackBookKeeping ç­‰æ–¹æ³•å°†äº‹ä»¶æºå¯¹è±¡é‡Šæ”¾åˆ°äº‹ä»¶æ± ä¸­ï¼Œè¿™æ ·çš„å¥½å¤„æ¯æ¬¡æˆ‘ä»¬ä¸å¿…å†åˆ›å»ºäº‹ä»¶æºå¯¹è±¡ï¼Œå¯ä»¥ä»äº‹ä»¶æ± ä¸­å–å‡ºä¸€ä¸ªäº‹ä»¶æºå¯¹è±¡è¿›è¡Œå¤ç”¨ï¼Œåœ¨äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•å,ä¼šé‡Šæ”¾äº‹ä»¶æºåˆ°äº‹ä»¶æ± ä¸­ï¼Œæ¸…ç©ºå±æ€§ï¼Œè¿™å°±æ˜¯ setTimeout ä¸­æ‰“å°ä¸ºä»€ä¹ˆæ˜¯ null çš„åŸå› äº†ã€‚\nå…³äº React v17 ç‰ˆæœ¬çš„äº‹ä»¶ç³»ç»ŸReact v17 æ•´ä½“æ”¹åŠ¨ä¸æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯äº‹ä»¶ç³»ç»Ÿçš„æ”¹åŠ¨å´ä¸å°ï¼Œé¦–å…ˆä¸Šè¿°çš„å¾ˆå¤šæ‰§è¡Œå‡½æ•°ï¼Œåœ¨ v17 ç‰ˆæœ¬ä¸å¤å­˜åœ¨äº†\näº‹ä»¶ä»£ç†ä¸å†ç»‘å®šè‡³ documentï¼Œè€Œæ˜¯ rootäº‹ä»¶ç»Ÿä¸€ç»‘å®š container ä¸Šï¼ŒReactDOM.render(appï¼Œ container);è€Œä¸æ˜¯ document ä¸Šï¼Œè¿™æ ·å¥½å¤„æ˜¯æœ‰åˆ©äº å¾®å‰ç«¯ çš„ï¼Œå¾®å‰ç«¯ ä¸€ä¸ªå‰ç«¯ç³»ç»Ÿä¸­å¯èƒ½æœ‰å¤šä¸ªåº”ç”¨ï¼Œå¦‚æœç»§ç»­é‡‡å–å…¨éƒ¨ç»‘å®šåœ¨ document ä¸Šï¼Œé‚£ä¹ˆå¯èƒ½å¤šåº”ç”¨ä¸‹ä¼šå‡ºç°é—®é¢˜ã€‚\n\nå¯¹é½åŸç”Ÿæµè§ˆå™¨äº‹ä»¶React 17 ä¸­ç»ˆäºæ”¯æŒäº† åŸç”Ÿæ•è·äº‹ä»¶ çš„æ”¯æŒï¼Œ å¯¹é½äº†æµè§ˆå™¨åŸç”Ÿæ ‡å‡†ã€‚åŒæ—¶ onScroll äº‹ä»¶ä¸å†è¿›è¡Œäº‹ä»¶å†’æ³¡(è§£å†³ v16 é—®é¢˜ï¼šå½“æ»šåŠ¨å­å…ƒç´ æ—¶ï¼Œçˆ¶å…ƒç´ ä¸Šçš„ onScroll å›è°ƒä¼šè§¦å‘)ã€‚onFocus å’Œ onBlur ä½¿ç”¨åŸç”Ÿ focusinï¼Œ focusout åˆæˆã€‚\nå–æ¶ˆäº‹ä»¶æ± React 17 å–æ¶ˆäº‹ä»¶æ± å¤ç”¨ï¼Œä¹Ÿå°±è§£å†³äº†ä¸Šè¿°åœ¨ setTimeout æ‰“å°ï¼Œæ‰¾ä¸åˆ° e.target çš„é—®é¢˜ã€‚\nå‚è€ƒã€Œreact è¿›é˜¶ã€ä¸€æ–‡åƒé€ react äº‹ä»¶ç³»ç»ŸåŸç†React v17.0 çš„ 6 å¤§å˜åŒ–\n","slug":"react-event-system","date":"2022-02-16T22:12:01.000Z","categories_index":"","tags_index":"React","author_index":"Matrix"},{"id":"f8393fb18aa0424e4c73686abd0807ce","title":"Source Map","content":"ä¸ºä»€ä¹ˆéœ€è¦ Source mapï¼Ÿè¿™ä¸ªè¦ä»æºç è½¬æ¢è®²èµ·ï¼ŒJavaScript è„šæœ¬æ­£å˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚å¤§éƒ¨åˆ†æºç ï¼ˆå°¤å…¶æ˜¯å„ç§å‡½æ•°åº“å’Œæ¡†æ¶ï¼‰éƒ½è¦ç»è¿‡è½¬æ¢ï¼Œæ‰èƒ½æŠ•å…¥ç”Ÿäº§ç¯å¢ƒã€‚\n\n\n\n\n\n\n\n\n\nå¸¸è§çš„æºç è½¬æ¢ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š\nï¼ˆ1ï¼‰å‹ç¼©ï¼Œå‡å°ä½“ç§¯ã€‚æ¯”å¦‚ jQuery 1.9 çš„æºç ï¼Œå‹ç¼©å‰æ˜¯ 252KBï¼Œå‹ç¼©åæ˜¯ 32KBã€‚ï¼ˆ2ï¼‰å¤šä¸ªæ–‡ä»¶åˆå¹¶ï¼Œå‡å°‘ HTTP è¯·æ±‚æ•°ã€‚ï¼ˆ3ï¼‰å…¶ä»–è¯­è¨€ç¼–è¯‘æˆ JavaScriptã€‚æœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯ CoffeeScriptã€‚\nè¿™ä¸‰ç§æƒ…å†µï¼Œéƒ½ä½¿å¾—å®é™…è¿è¡Œçš„ä»£ç ä¸åŒäºå¼€å‘ä»£ç ï¼Œé™¤é”™ï¼ˆdebugï¼‰å˜å¾—å›°éš¾é‡é‡ã€‚é€šå¸¸ï¼ŒJavaScript çš„è§£é‡Šå™¨ä¼šå‘Šè¯‰ä½ ï¼Œç¬¬å‡ è¡Œç¬¬å‡ åˆ—ä»£ç å‡ºé”™ã€‚ä½†æ˜¯ï¼Œè¿™å¯¹äºè½¬æ¢åçš„ä»£ç æ¯«æ— ç”¨å¤„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒjQuery 1.9 å‹ç¼©ååªæœ‰ 3 è¡Œï¼Œæ¯è¡Œ 3 ä¸‡ä¸ªå­—ç¬¦ï¼Œæ‰€æœ‰å†…éƒ¨å˜é‡éƒ½æ”¹äº†åå­—ã€‚ä½ çœ‹ç€æŠ¥é”™ä¿¡æ¯ï¼Œæ„Ÿåˆ°æ¯«æ— å¤´ç»ªï¼Œæ ¹æœ¬ä¸çŸ¥é“å®ƒæ‰€å¯¹åº”çš„åŸå§‹ä½ç½®ã€‚\nè¿™å°±æ˜¯ Source map æƒ³è¦è§£å†³çš„é—®é¢˜ã€‚\nä»€ä¹ˆæ˜¯ Source mapï¼Ÿç®€å•è¯´ï¼ŒSource map å°±æ˜¯ä¸€ä¸ªä¿¡æ¯æ–‡ä»¶ï¼Œé‡Œé¢å‚¨å­˜ç€ä½ç½®ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè½¬æ¢åçš„ä»£ç çš„æ¯ä¸€ä¸ªä½ç½®ï¼Œæ‰€å¯¹åº”çš„è½¬æ¢å‰çš„ä½ç½®ã€‚\næœ‰äº†å®ƒï¼Œå‡ºé”™çš„æ—¶å€™ï¼Œé™¤é”™å·¥å…·å°†ç›´æ¥æ˜¾ç¤ºåŸå§‹ä»£ç ï¼Œè€Œä¸æ˜¯è½¬æ¢åçš„ä»£ç ã€‚è¿™æ— ç–‘ç»™å¼€å‘è€…å¸¦æ¥äº†å¾ˆå¤§æ–¹ä¾¿ã€‚\n\nå¦‚ä½•å¯ç”¨ Source mapï¼Ÿæ­£å¦‚å‰æ–‡æ‰€æåˆ°çš„ï¼Œåªè¦åœ¨è½¬æ¢åçš„ä»£ç å°¾éƒ¨ï¼ŒåŠ ä¸Šä¸€è¡Œå°±å¯ä»¥äº†ã€‚\nã€€//@ sourceMappingURL=/path/to/file.js.map\n\nmap æ–‡ä»¶å¯ä»¥æ”¾åœ¨ç½‘ç»œä¸Šï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚é‚£è¿™é‡Œå°±ä¸å¾—ä¸æ Webpack Devtool é…ç½®ã€‚\nSource map å­—æ®µè§£è¯»&#123;\n  \"version\": 3,\n  \"file\": \"main.js\",\n  \"sources\": [\n    \"../src/main.js\"\n  ],\n  \"sourcesContent\": [\n    \"throw new Error('error 1');\\n\"\n  ],\n  \"names\": [\n    \"Error\"\n  ],\n  \"mappings\": \";;AAAA,MAAM,IAAIA,KAAJ,CAAU,SAAV,CAAN\"\n&#125;\n\n\n\n\n\n\n\n\n\n\nversionï¼š sourceMap ç‰ˆæœ¬ï¼Œç›®å‰çš„ç‰ˆæœ¬æ˜¯ 3ã€‚fileï¼šè½¬æ¢åçš„æ–‡ä»¶åã€‚sourcesï¼šè½¬æ¢å‰çš„æ–‡ä»¶ã€‚è¯¥é¡¹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºå¯èƒ½å­˜åœ¨å¤šä¸ªæ–‡ä»¶åˆå¹¶ã€‚sourcesContentï¼šsource ä¸­æ–‡ä»¶å¯¹åº”çš„æºä»£ç ï¼Œæ˜¯ä¸ªæ•°ç»„namesï¼šè½¬æ¢å‰çš„æ‰€æœ‰å˜é‡åå’Œå±æ€§åã€‚mappingsï¼šè®°å½•ä½ç½®ä¿¡æ¯çš„å­—ç¬¦ä¸²ã€‚\n\nå…³é”®å°±æ˜¯ map æ–‡ä»¶çš„ mappings å±æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œå®ƒåˆ†æˆä¸‰å±‚\n\nç¬¬ä¸€å±‚æ˜¯è¡Œå¯¹åº”ï¼Œä»¥åˆ†å· ; è¡¨ç¤ºï¼Œæ¯ä¸ªåˆ†å·å¯¹åº”è½¬æ¢åæºç çš„ä¸€è¡Œã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªåˆ†å·å‰çš„å†…å®¹ï¼Œå°±å¯¹åº”æºç çš„ç¬¬ä¸€è¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚\nç¬¬äºŒå±‚æ˜¯ä½ç½®å¯¹åº”ï¼Œä»¥é€—å· ,è¡¨ç¤ºï¼Œæ¯ä¸ªé€—å·å¯¹åº”è½¬æ¢åæºç çš„ä¸€ä¸ªä½ç½®ã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªé€—å·å‰çš„å†…å®¹ï¼Œå°±å¯¹åº”è¯¥è¡Œæºç çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä»¥æ­¤ç±»æ¨ã€‚\nç¬¬ä¸‰å±‚æ˜¯ä½ç½®è½¬æ¢ï¼Œä»¥ VLQ ç¼–ç è¡¨ç¤ºï¼Œä»£è¡¨è¯¥ä½ç½®å¯¹åº”çš„è½¬æ¢å‰çš„æºç ä½ç½®ã€‚\n\n\nWebpack Devtool é…ç½®\n\n\næ¨¡å¼\nè§£é‡Š\nç¼ºç‚¹\n\n\n\neval\næ¯ä¸ª module ä¼šå°è£…åˆ° eval é‡ŒåŒ…è£¹èµ·æ¥æ‰§è¡Œï¼Œå¹¶ä¸”ä¼šåœ¨æœ«å°¾è¿½åŠ æ³¨é‡Š &#x2F;&#x2F;@ sourceURL\næ˜ å°„åˆ°è½¬æ¢åçš„ä»£ç ï¼Œè€Œä¸æ˜¯æ˜ å°„åˆ°åŸå§‹ä»£ç \n\n\nsource-map\næ•´ä¸ª source map ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ç”Ÿæˆã€‚å®ƒä¸º bundle æ·»åŠ äº†ä¸€ä¸ªå¼•ç”¨æ³¨é‡Šï¼Œä»¥ä¾¿å¼€å‘å·¥å…·çŸ¥é“åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°å®ƒ\nä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒï¼ˆåº”è¯¥å°†ä½ çš„æœåŠ¡å™¨é…ç½®ä¸ºï¼Œä¸å…è®¸æ™®é€šç”¨æˆ·è®¿é—® source map æ–‡ä»¶ï¼‰\n\n\nhidden-source-map\nä¸ source-map ç›¸åŒï¼Œä½†ä¸ä¼šä¸º bundle æ·»åŠ å¼•ç”¨æ³¨é‡Š\nä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒï¼ˆä¸åº”å°† source map æ–‡ä»¶éƒ¨ç½²åˆ° web æœåŠ¡å™¨ã€‚è€Œæ˜¯åªå°†å…¶ç”¨äºé”™è¯¯æŠ¥å‘Šå·¥å…·ï¼‰\n\n\nnosources-source-map\nåˆ›å»ºçš„ source map ä¸åŒ…å« sourcesContent(æºä»£ç å†…å®¹)\nå¯å°† source map æ–‡ä»¶éƒ¨ç½²åˆ° web æœåŠ¡å™¨ï¼Œä½†ä»ç„¶ä¼šæš´éœ²åç¼–è¯‘åçš„æ–‡ä»¶åå’Œç»“æ„ï¼Œä½†å®ƒä¸ä¼šæš´éœ²åŸå§‹ä»£ç \n\n\ninline-source-map\nsource map è½¬æ¢ä¸º DataUrl åæ·»åŠ åˆ° bundle ä¸­\nbundle ä½“ç§¯å·¨å¢\n\n\ncheap-source-map\næ²¡æœ‰åˆ—æ˜ å°„(column mapping)çš„ source map\nå¿½ç•¥ loader source map\n\n\ninline-cheap-source-map\nç±»ä¼¼ cheap-source-mapï¼Œä½†æ˜¯ source map è½¬æ¢ä¸º DataUrl åæ·»åŠ åˆ° bundle ä¸­\nbundle ä½“ç§¯å¢å¤§\n\n\ncheap-module-source-map\næ²¡æœ‰åˆ—æ˜ å°„(column mapping)çš„ source mapï¼Œå°† loader source map ç®€åŒ–ä¸ºæ¯è¡Œä¸€ä¸ªæ˜ å°„(mapping)\nâ€“\n\n\ninline-cheap-module-source-map\nç±»ä¼¼ cheap-module-source-mapï¼Œä½†æ˜¯ source map è½¬æ¢ä¸º DataUrl æ·»åŠ åˆ° bundle ä¸­\nâ€“\n\n\nWebpack Devtool é…ç½®æ§åˆ¶æ˜¯å¦ç”Ÿæˆï¼Œä»¥åŠå¦‚ä½•ç”Ÿæˆ source map\nå‚è€ƒWebpack å®˜æ–¹æ–‡æ¡£ - Devtool é…ç½®èŠä¸ª 5 æ¯›é’±çš„ Source Mapå¦‚ä½•åœ¨æ­£å¼ç¯å¢ƒæ— å®³çš„ä½¿ç”¨ sourceMapï¼ŸJavaScript Source Map è¯¦è§£\n","slug":"sourcemap","date":"2022-02-16T18:13:27.000Z","categories_index":"","tags_index":"Webpack","author_index":"Matrix"},{"id":"1be78549da2d3dbc703ef7208cb57948","title":"Chrome 80+","content":"Chrome 80 ç­–ç•¥æ›´æ–°Chrome 80 ç¨³å®šç‰ˆï¼ˆç‰ˆæœ¬å· v80.0.3987.87ï¼‰å·²æ­£å¼é¢å‘ Windowsã€macOSã€Linuxã€Android å’Œ iOS å…¨å¹³å°æ¨é€\næ··åˆå†…å®¹å¼ºåˆ¶ HTTPSæ··åˆå†…å®¹æ˜¯æŒ‡ https é¡µé¢ä¸‹æœ‰é https èµ„æºæ—¶ï¼Œæµè§ˆå™¨çš„åŠ è½½ç­–ç•¥ã€‚\nåœ¨ Chrome 80 ä¸­ï¼Œå¦‚æœä½ çš„é¡µé¢å¼€å¯äº† httpsï¼ŒåŒæ—¶ä½ åœ¨é¡µé¢ä¸­è¯·æ±‚äº† http çš„éŸ³é¢‘å’Œè§†é¢‘èµ„æºï¼Œè¿™äº›èµ„æºå°†å°†è‡ªåŠ¨å‡çº§ä¸º https ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå®ƒä»¬æ— æ³•é€šè¿‡ https åŠ è½½ï¼ŒChrome å°†é˜»æ­¢å®ƒä»¬ã€‚è¿™æ ·å°±ä¼šé€ æˆä¸€äº›æœªæ”¯æŒ https åè®®çš„èµ„æºåŠ è½½å¤±è´¥ã€‚\nå¦‚æœä½ æƒ³ä¸´æ—¶è®¿é—®è¿™äº›èµ„æºï¼Œä½ å¯ä»¥é€šè¿‡æ›´æ”¹ä¸‹é¢çš„æµè§ˆå™¨è®¾ç½®æ¥è®¿é—®ï¼š\n\n\n\n\n\n\n\n\n\n\nå•å‡»åœ°å€æ ä¸Šçš„é”å®šå›¾æ ‡å¹¶é€‰æ‹© â€œç«™ç‚¹è®¾ç½®â€\n\nå°† â€œéšç§è®¾ç½®å’Œå®‰å…¨æ€§â€ ä¸­çš„ â€œä¸å®‰å…¨å†…å®¹â€ é€‰æ‹©ä¸º â€œå…è®¸â€\n\nä½ è¿˜å¯ä»¥é€šè¿‡è®¾ç½® StricterMixedContentTreatmentEnabled ç­–ç•¥æ¥æ§åˆ¶è¿™äº›å˜åŒ–ï¼š\n\næ­¤ç­–ç•¥æ§åˆ¶æµè§ˆå™¨ä¸­æ··åˆå†…å®¹ï¼ˆHTTPS ç«™ç‚¹ä¸­çš„ HTTP å†…å®¹ï¼‰çš„å¤„ç†æ–¹å¼ã€‚å¦‚æœè¯¥æ”¿ç­–è®¾ç½®ä¸º true æˆ–æœªè®¾ç½®ï¼Œåˆ™éŸ³é¢‘å’Œè§†é¢‘æ··åˆå†…å®¹å°†è‡ªåŠ¨å‡çº§ä¸º HTTPSï¼ˆå³ï¼ŒURL å°†è¢«é‡å†™ä¸º HTTPSï¼Œå¦‚æœèµ„æºä¸èƒ½é€šè¿‡ HTTPS è·å¾—ï¼Œåˆ™ä¸ä¼šè¿›è¡Œå›é€€ï¼‰ï¼Œå¹¶ä¸”å°†æ˜¾ç¤ºâ€œä¸å®‰å…¨â€è­¦å‘Šåœ¨ç½‘å€åˆ—ä¸­æ˜¾ç¤ºå›¾ç‰‡æ··åˆå†…å®¹ã€‚å¦‚æœè¯¥ç­–ç•¥è®¾ç½®ä¸º falseï¼Œåˆ™å°†ç¦ç”¨éŸ³é¢‘å’Œè§†é¢‘çš„è‡ªåŠ¨å‡çº§ï¼Œå¹¶ä¸”ä¸ä¼šæ˜¾ç¤ºå›¾åƒè­¦å‘Šã€‚è¯¥ç­–ç•¥ä¸å½±å“éŸ³é¢‘ï¼Œè§†é¢‘å’Œå›¾åƒä»¥å¤–çš„å…¶ä»–ç±»å‹çš„æ··åˆå†…å®¹ã€‚\nä½†æ˜¯ä»¥ä¸Šç­–ç•¥æ˜¯ä¸€ä¸ªä¸´æ—¶ç­–ç•¥ï¼Œå°†åœ¨ Chrome 84 ä¸­åˆ é™¤ã€‚æ›´åˆç†çš„æ–¹å¼æ˜¯ä½ éœ€è¦æ¨åŠ¨å…¨ç«™èµ„æºå¼€å¯ HTTPSã€‚Chrome ä¹Ÿæ˜¯æ¨èå¤§å®¶è¿™ä¹ˆåšçš„\n\n\n\nå¼ºæ¨ SameSite CookieSameSite æ˜¯ Chrome 51 ç‰ˆæœ¬ä¸ºæµè§ˆå™¨çš„ Cookie æ–°å¢çš„äº†ä¸€ä¸ªå±æ€§ï¼Œ SameSite é˜»æ­¢æµè§ˆå™¨å°†æ­¤ Cookie ä¸è·¨ç«™ç‚¹è¯·æ±‚ä¸€èµ·å‘é€ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯é™ä½è·¨æºä¿¡æ¯æ³„æ¼çš„é£é™©ã€‚åŒæ—¶ä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜»æ­¢äº† CSRFï¼ˆCross-site request forgery è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰\nCookie å¾€å¾€ç”¨æ¥å­˜å‚¨ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œæ¶æ„ç½‘ç«™å¯ä»¥è®¾æ³•ä¼ªé€ å¸¦æœ‰æ­£ç¡® Cookie çš„ HTTP è¯·æ±‚ï¼Œè¿™å°±æ˜¯ CSRF æ”»å‡»ã€‚\n\n\n\n\n\n\n\n\n\nSameSite å¯ä»¥é¿å…è·¨ç«™è¯·æ±‚å‘é€ Cookieï¼Œæœ‰ä»¥ä¸‹ä¸‰ä¸ªå±æ€§ï¼š\n\nStrictStrict æ˜¯æœ€ä¸¥æ ¼çš„é˜²æŠ¤ï¼Œå°†é˜»æ­¢æµè§ˆå™¨åœ¨æ‰€æœ‰è·¨ç«™ç‚¹æµè§ˆä¸Šä¸‹æ–‡ä¸­å°† Cookie å‘é€åˆ°ç›®æ ‡ç«™ç‚¹ï¼Œå³ä½¿åœ¨éµå¾ªå¸¸è§„é“¾æ¥æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å› æ­¤è¿™ç§è®¾ç½®å¯ä»¥é˜»æ­¢æ‰€æœ‰ CSRF æ”»å‡»ã€‚ç„¶è€Œï¼Œå®ƒçš„ç”¨æˆ·å‹å¥½æ€§å¤ªå·®ï¼Œå³ä½¿æ˜¯æ™®é€šçš„ GET è¯·æ±‚å®ƒä¹Ÿä¸å…è®¸é€šè¿‡ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªæ™®é€šçš„ç«™ç‚¹ï¼Œè¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªå·²ç»ç™»å½•çš„ç”¨æˆ·è·Ÿè¸ªä¸€ä¸ªå‘å¸ƒåœ¨å…¬å¸è®¨è®ºè®ºå›æˆ–ç”µå­é‚®ä»¶ä¸Šçš„ç½‘ç«™é“¾æ¥ï¼Œè¿™ä¸ªç«™ç‚¹å°†ä¸ä¼šæ”¶åˆ° Cookie ï¼Œç”¨æˆ·è®¿é—®è¯¥ç«™ç‚¹è¿˜éœ€è¦é‡æ–°ç™»é™†ã€‚ä¸è¿‡ï¼Œå…·æœ‰äº¤æ˜“ä¸šåŠ¡çš„ç½‘ç«™å¾ˆå¯èƒ½ä¸å¸Œæœ›ä»å¤–ç«™é“¾æ¥åˆ°ä»»ä½•äº¤æ˜“é¡µé¢ï¼Œå› æ­¤è¿™ç§åœºæ™¯æœ€é€‚åˆä½¿ç”¨ strict æ ‡å¿—ã€‚\nLaxå¯¹äºå…è®¸ç”¨æˆ·ä»å¤–éƒ¨é“¾æ¥åˆ°è¾¾æœ¬ç«™å¹¶ä½¿ç”¨å·²æœ‰ä¼šè¯çš„ç½‘ç«™ç«™ï¼Œé»˜è®¤çš„ Lax å€¼åœ¨å®‰å…¨æ€§å’Œå¯ç”¨æ€§ä¹‹é—´æä¾›äº†åˆç†çš„å¹³è¡¡ã€‚Lax å±æ€§åªä¼šåœ¨ä½¿ç”¨å±é™© HTTP æ–¹æ³•å‘é€è·¨åŸŸ Cookie çš„æ—¶å€™è¿›è¡Œé˜»æ­¢ï¼Œä¾‹å¦‚ POST æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·åœ¨ A ç«™ç‚¹ ç‚¹å‡»äº†ä¸€ä¸ª B ç«™ç‚¹ï¼ˆGET è¯·æ±‚ï¼‰ï¼Œè€Œå‡å¦‚ B ç«™ç‚¹ ä½¿ç”¨äº† Samesite-cookies&#x3D;Laxï¼Œé‚£ä¹ˆç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½• B ç«™ç‚¹ã€‚ç›¸å¯¹åœ°ï¼Œå¦‚æœç”¨æˆ·åœ¨ A ç«™ç‚¹æäº¤äº†ä¸€ä¸ªè¡¨å•åˆ° B ç«™ç‚¹ï¼ˆPOST è¯·æ±‚ï¼‰ï¼Œé‚£ä¹ˆç”¨æˆ·çš„è¯·æ±‚å°†è¢«é˜»æ­¢ï¼Œå› ä¸ºæµè§ˆå™¨ä¸å…è®¸ä½¿ç”¨ POST æ–¹å¼å°† Cookie ä» A åŸŸå‘é€åˆ°ï¼¢åŸŸã€‚\nNoneæµè§ˆå™¨ä¼šåœ¨åŒç«™è¯·æ±‚ã€è·¨ç«™è¯·æ±‚ä¸‹ç»§ç»­å‘é€ Cookiesï¼Œä¸åŒºåˆ†å¤§å°å†™ã€‚\n\nä»¥ä¸Šæ›´æ–°å¯èƒ½å¯¹ä»¥ä¸‹åŠŸèƒ½é€ æˆå½±å“ï¼š\n\nè·¨åŸŸåç™»é™†å¤±æ•ˆ\njsonp è·å–æ•°æ®å¤±æ•ˆ\niframe åµŒå¥—çš„é¡µé¢æ‰“ä¸å¼€æˆ–å¼‚å¸¸\néƒ¨åˆ†å®¢æˆ·ç«¯æœªæ”¹é€ å¯¼è‡´å„ç§æ•°æ®è·å–å¼‚å¸¸\n\næ­£å¼æ”¯æŒ JavaScript Optional chaining &amp; Nullish coalescingJavaScript Optional chaining// å¯¹è±¡å¼å†™æ³•\n// é€šå¸¸å†™æ³•\nconst nestedProp = obj.first &amp;&amp; obj.first.second;\n// æ”¯æŒJavaScript Optional chainingåæˆ‘ä»¬å¯ä»¥ä¸ç”¨å†åšæ— è°“çš„åˆ¤æ–­é€»è¾‘äº†\nconst nestedProp = obj.first?.second;\n\n// æ•°ç»„å¼å†™æ³•\n// é€šå¸¸å†™æ³•\nconst firstEl = arr &amp;&amp; Array.isArray(arr) &amp;&amp; arr[0];\n// æ”¯æŒJavaScript Optional chainingå\nconst firstEl = arr?.[0];\n\n// å‡½æ•°å¼å†™æ³•\n// é€šå¸¸å†™æ³•\nconst result = someInterface.customMethod &amp;&amp; someInterface.customMethod();\n// æ”¯æŒJavaScript Optional chainingå\nconst result = someInterface.customMethod?.();\n\n\n\n\n\n\n\n\n\n\næ³¨ï¼šå¦‚æœåœ¨å¼€å‘çš„æ—¶å€™ï¼Œéœ€è¦å…¼å®¹ä¸€äº›æ—§ç‰ˆæœ¬çš„æµè§ˆå™¨çš„è¯å¯ä»¥è€ƒè™‘å¼•å…¥ @babel/plugin-proposal-optional-chaining æ’ä»¶\nNullish coalescing/***************** Example 1 *******************/\nconst foo;\n\n//  åœ¨ä¸‹é¢ä»£ç æ‰§è¡Œå®Œä¹‹åfooè¿˜æ˜¯undefinedï¼Œå¹¶æ²¡æœ‰è¢«èµ‹å€¼ï¼Œbarçš„ç»“æœä¸€å®šä¼šæ˜¯'hello'\nconst bar = foo || 'Hello!';\n\n/***************** Example 2 *******************/\n\nconst num = 0;\nconst txt = '';\n\nconst qty = num || 42;\nconst team = txt || 'AIPE-FE';\nconsole.log(qty);  // 42 and not 0\nconsole.log(team); // \"AIPE-FE\" and not ''\n\n/***************** Example 3 *******************/\n\nlet txt = '';\n\nconst team = txt || 'AIPE-FE';\nconsole.log(team); // 'AIPE-FE'\n\nlet result = txt ?? 'AIPE-FE';\nconsole.log(result); // '' (è¿™ä¸ªæ—¶å€™txtå°±ä¸å†æ˜¯''äº†ï¼Œè€Œæ˜¯è¢«èµ‹å€¼æˆ'AIPE-FE');\n\n/***************** Example 4 *******************/\nconst nullValue = null;\nconst emptyText = '';\nconst someNumber = 42;\n\nconst valA = nullValue ?? 'default for A';\nconst valB = emptyText ?? 'default for B';\nconst valC = someNumber ?? 0;\n\nconsole.log(valA); // 'default for A'\nconsole.log(valB); // '' (as the empty string is not null or undefined)\nconsole.log(valC); // 42\n\n\n\n\n\n\n\n\n\n\næ³¨ï¼šå¦‚æœåœ¨å¼€å‘çš„æ—¶å€™ï¼Œéœ€è¦å…¼å®¹ä¸€äº›æ—§ç‰ˆæœ¬çš„æµè§ˆå™¨çš„è¯å¯ä»¥è€ƒè™‘å¼•å…¥ @babel/plugin-proposal-nullish-coalescing-operator æ’ä»¶\nFavicon å›¾æ ‡æ”¯æŒ SVG æ ¼å¼è¿™ä¸ªå‡çº§ç‚¹å°±ä¸ç”¨å¤šè¯´äº†\nnew CopyWebpackPlugin([\n    &#123;\n      // æˆ‘ä»¬ç°åœ¨å¯ä»¥è¾“å‡ºsvgæ ¼å¼çš„faviconäº†\n      from: 'images/favicon-32.svg'\n    &#125;\n])\n\nç§»é™¤å¯¹ FTP çš„æ”¯æŒ\nGoogle Chrome å½“å‰ FTP çš„å®ç°ä¸æ”¯æŒåŠ å¯†è¿æ¥ï¼ˆFTPSï¼‰ï¼Œä¹Ÿæ²¡æœ‰ä»£ç†ã€‚ FTP åœ¨æµè§ˆå™¨ä¸­çš„ä½¿ç”¨ç‡éå¸¸ä½ï¼Œä»¥è‡´æ— æ³•å†æŠ•èµ„äºæ”¹è¿›ç°æœ‰çš„ FTP å®¢æˆ·ç«¯ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰å—å½±å“çš„å¹³å°ä¸Šéƒ½æä¾›äº†åŠŸèƒ½æ›´å¼ºå¤§çš„ FTP å®¢æˆ·ç«¯ã€‚ Google Chrome 72+åˆ é™¤äº†å¯¹é€šè¿‡ FTP æå–æ–‡æ¡£å­èµ„æºå’Œå‘ˆç°é¡¶çº§ FTP èµ„æºçš„æ”¯æŒã€‚å½“å‰ï¼Œå¯¼èˆªåˆ° FTP URL ä¼šå¯¼è‡´æ˜¾ç¤ºç›®å½•åˆ—è¡¨æˆ–ä¸‹è½½ï¼Œå…·ä½“å–å†³äºèµ„æºçš„ç±»å‹ã€‚ Google Chrome 74+ä¸­çš„ä¸€ä¸ªé”™è¯¯å¯¼è‡´æ”¾å¼ƒäº†å¯¹é€šè¿‡ HTTP ä»£ç†è®¿é—® FTP URL çš„æ”¯æŒã€‚å¯¹ FTP çš„ä»£ç†æ”¯æŒå·²åœ¨ Google Chrome 76 ä¸­å®Œå…¨åˆ é™¤ã€‚ Google Chrome çš„ FTP å®æ–½çš„å…¶ä½™åŠŸèƒ½ä»…é™äºæ˜¾ç¤ºç›®å½•åˆ—è¡¨æˆ–é€šè¿‡æœªåŠ å¯†çš„è¿æ¥ä¸‹è½½èµ„æºã€‚æˆ‘ä»¬æƒ³å¼ƒç”¨å¹¶åˆ é™¤æ­¤å‰©ä½™åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ç»´æŠ¤ä¸å®‰å…¨çš„ FTP å®ç°ã€‚\næ€»çš„æ¥è¯´ï¼šchrome 80+ ä»¥åï¼Œgoogle chrome å›¢é˜Ÿæ›´ focus çš„ç‚¹å°±æ˜¯å®‰å…¨ç›¸å…³çš„é—®é¢˜\nWeb workers ä¸­æ”¯æŒ ES modulesModule Workers æ˜¯ä¸€ç§é€‚ç”¨äº Web Worker çš„æ–°æ¨¡å¼-å¾—ç›Šäº JavaScript æ¨¡å—åŒ–çš„ä¼˜åŠ¿ã€‚ Worker æ„é€ å‡½æ•°ç°åœ¨å¯ä»¥æ¥å—ä¸€ä¸ª{typeï¼šâ€œ moduleâ€}é€‰é¡¹ï¼Œè¯¥é€‰é¡¹æ›´æ”¹äº†è„šæœ¬çš„åŠ è½½å’Œæ‰§è¡Œæ–¹å¼ï¼Œç”¨äºåŒ¹é…\n&lt;script type=\"module\">\n    const worker = new Worker('worker.js', &#123;\n        type: 'module'\n    &#125;);\n&lt;/script>\n\nè¯¦è§ Threading the web with module workers\nChrome 86 ç­–ç•¥æ›´æ–°Chrome 86 åœ¨ 2020 å¹´ 10 æœˆæ¨å‡ºäº†ç¨³å®šç‰ˆï¼Œç°å·²å…¨é¢åº”ç”¨äº Androidã€Chrome OSã€Linuxã€macOS å’Œ Windows ç­‰å¹³å°\næ–‡ä»¶ç³»ç»Ÿè®¿é—®é€šè¿‡è°ƒç”¨ showOpenFilePicker æ–¹æ³•ï¼Œä½ å¯ä»¥å”¤èµ·æ–‡ä»¶é€‰æ‹©çª—å£ï¼Œè¿›è€Œé€šè¿‡è¿”å›çš„æ–‡ä»¶å¥æŸ„å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚\nasync function getFileHandle() &#123;\n  const opts = &#123;\n    types: [\n      &#123;\n        description: 'Text Files',\n        accept: &#123;\n          'text/plain': ['.txt', '.text'],\n          'text/html': ['.html', '.htm']\n        &#125;\n      &#125;\n    ]\n  &#125;;\n  return await window.showOpenFilePicker(opts);\n&#125;\n\nå…¨é¢é˜»æ­¢æ‰€æœ‰é HTTPS æ··åˆå†…å®¹ä¸‹è½½HTTPS æ··åˆå†…å®¹é”™è¯¯æ˜¯æŒ‡åˆå§‹ç½‘é¡µé€šè¿‡å®‰å…¨çš„ HTTPS é“¾æ¥åŠ è½½ï¼Œä½†é¡µé¢ä¸­å…¶ä»–èµ„æºï¼Œæ¯”å¦‚å›¾åƒï¼Œè§†é¢‘ï¼Œæ ·å¼è¡¨ï¼Œè„šæœ¬å´é€šè¿‡ä¸å®‰å…¨çš„ HTTP é“¾æ¥åŠ è½½ï¼Œè¿™æ ·å°±ä¼šå‡ºç°æ··åˆå†…å®¹é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯ä¸å®‰å…¨å› ç´ ã€‚\næ”»å‡»è€…å¯æ‹¦æˆªä¸å®‰å…¨çš„ä¸‹è½½åœ°å€ï¼Œå°†ç¨‹åºæ›¿æ¢æˆæ¶æ„è½¯ä»¶ã€ç”šè‡³è®¿é—®æ›´å¤šçš„æ•æ„Ÿä¿¡æ¯ã€‚ä¸ºç®¡æ§è¿™äº›é£é™©ï¼Œè°·æ­Œæœ€ç»ˆè¿˜æ˜¯å†³å®šåœ¨ Chrome ä¸­ç¦æ­¢åŠ è½½ä¸å®‰å…¨èµ„æºã€‚\nä» M86 å¼€å§‹ï¼Œå›¾ç‰‡ç±»å‹çš„è¯·æ±‚ï¼Œä¼šè‡ªåŠ¨å‡çº§åˆ° HTTPSï¼Œå¹¶ä¸”æ²¡æœ‰ HTTP çš„é™çº§ï¼ŒAudio&#x2F;Video ç±»å‹çš„è¯·æ±‚æ—©åœ¨ M80 å°±å¼€å§‹è¿›è¡Œäº†è‡ªåŠ¨å‡çº§\nreplaceChildrenç›®å‰ï¼Œè¦æƒ³æ›¿æ¢æŸ DOM èŠ‚ç‚¹ä¸‹çš„å…¨éƒ¨å­èŠ‚ç‚¹ï¼Œå¿…é¡»è¦å…ˆé€šè¿‡ innerHTML æˆ– removeChild åˆ é™¤å…¨éƒ¨å­èŠ‚ç‚¹ï¼Œç„¶åå†é€ä¸ªæ·»åŠ ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚ä¸ºæ­¤ï¼ŒChrome æ”¯æŒäº† replaceChildren æ–¹æ³•ï¼Œå¯ä»¥ç”¨å‚æ•°ä¸­çš„å­èŠ‚ç‚¹åˆ—è¡¨æ›¿æ¢åŸæœ‰çš„å…¨éƒ¨å­èŠ‚ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š\nparentNode.replaceChildren(newChildren);\n\næ›´é†’ç›®çš„ HTTP å®‰å…¨è­¦å‘Šåœ¨æˆ‘ä»¬è®¿é—® HTTPS ç½‘é¡µæ—¶ï¼Œåœ°å€æ æœ€å·¦ä¾§ä¼šæ˜¾ç¤ºä¸€ä¸ªé”å®šå›¾æ ‡æ¥è¡¨æ˜å½“å‰ç½‘ç«™æ˜¯å®‰å…¨çš„ï¼Œä½†å¦‚æœ HTTPS ç½‘é¡µä¸­åµŒå…¥çš„æ˜¯å¹¶ä¸å®‰å…¨çš„ HTTP è¡¨å•ï¼Œæµè§ˆå™¨åˆ™ä¸ä¼šç»™å‡ºä»»ä½•æç¤ºä¿¡æ¯ã€‚è€Œå®é™…ä¸Šå·²ç»æœ‰é’“é±¼ç½‘ç«™é€šè¿‡è¿™ç§æ–¹å¼æ¥ç›—å–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯äº†ã€‚\næ‰€ä»¥åœ¨ Chrome 86 ä¸­ï¼Œå¦‚æœ HTTPS çš„ç½‘é¡µä¸­åµŒå…¥äº†ä¸å®‰å…¨çš„ HTTP è¡¨å•ï¼Œè¡¨å•å­—æ®µä¸‹æ–¹ä¼šæœ‰æä¸ºé†’ç›®çš„ã€Œæ­¤è¡¨å•ä¸å®‰å…¨ã€æ–‡æœ¬æç¤ºã€‚\n\nåå°æ ‡ç­¾é¡µæ›´çœç”µå¦‚æœä¸€ä¸ªæ ‡ç­¾é¡µåœ¨åå°è¿è¡Œäº†äº”åˆ†é’Ÿä»¥ä¸Šï¼Œè¿™ä¸ªé¡µé¢å°±ä¼šè¢«æš‚æ—¶å†»ç»“ï¼Œç›¸åº”çš„ CPU ä½¿ç”¨ä¹Ÿä¼šè¢«é™åˆ¶åœ¨ 1% å·¦å³ï¼›å¦‚æœé¡µé¢æ”¯æŒè‡ªåŠ¨åˆ·æ–°ï¼Œå”¤é†’æ—¶é—´è¢«é™åˆ¶åœ¨æ¯ä¸€åˆ†é’Ÿä¸€æ¬¡ã€‚\nå‚è€ƒChrome 80 ç‰ˆæœ¬åˆ°åº•å‡çº§äº†äº›ä»€ä¹ˆä¸¤ä¸ªä½ å¿…é¡»è¦é‡è§†çš„ Chrome 80 ç­–ç•¥æ›´æ–°ï¼ï¼ï¼2020 å¹´ 10 æœˆ Chrome 86 é‡è¦æ›´æ–°è§£è¯»Threading the web with module workers\n","slug":"chrome80","date":"2022-02-13T14:20:14.000Z","categories_index":"","tags_index":"","author_index":"Matrix"},{"id":"78e195a173181f2e8327460e98bdacbc","title":"CORS vs HSTS","content":"æµè§ˆå™¨åŒæºç­–ç•¥æ‰€è°“åŒæºå°±æ˜¯æµè§ˆå™¨çš„ä¸€ä¸ªå®‰å…¨æœºåˆ¶,ä¸åŒæºçš„å®¢æˆ·ç«¯è„šæœ¬æ²¡æœ‰åœ¨æ˜ç¡®æˆæƒçš„æƒ…å†µä¸‹,ä¸èƒ½è¯»å†™å¯¹æ–¹èµ„æºã€‚ç”±äºå­˜åœ¨åŒæºç­–ç•¥çš„é™åˆ¶,è€Œåˆæœ‰éœ€è¦è·¨åŸŸçš„ä¸šåŠ¡,æ‰€ä»¥å°±æœ‰äº† CORS çš„å‡ºç°ã€‚\nå½“èµ„æºä½äºä¸åŒåè®®ã€å­åŸŸæˆ–ç«¯å£çš„ç«™ç‚¹æ—¶ï¼Œè¿™ä¸ªè¯·æ±‚å°±æ˜¯è·¨åŸŸçš„\n\nCORS ä¸ HSTSHSTS å…¨ç§°ï¼šHTTP Strict Transport Securityï¼Œæ„è¯‘ï¼šHTTP ä¸¥æ ¼ä¼ è¾“å®‰å…¨ï¼Œæ˜¯ä¸€ä¸ª Web å®‰å…¨ç­–ç•¥æœºåˆ¶ã€‚\n\n\n\n\n\n\n\n\n\nHSTS è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿå®ƒè§£å†³çš„æ˜¯ï¼šç½‘ç«™ä» Http è½¬è·³åˆ° Https æ—¶ï¼Œå¯èƒ½å‡ºç°çš„å®‰å…¨é—®é¢˜ã€‚Client ä» Http åˆ‡æ¢åˆ° Https å‰æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œå› æ­¤æ˜¯å¯ä»¥è¢« Man-In-The-Middle åŠ«æŒçš„ï¼Œå¦‚ä¸‹æµç¨‹ï¼š\n\nHSTS å¦‚ä½•è§£å†³?è¦è§£å†³ä» Http åˆ‡æ¢åˆ° Https è¢«åŠ«æŒçš„é—®é¢˜ï¼Œåªè¦ä¸€å¼€å§‹å°±æ²¡æœ‰ Http è¯·æ±‚å³å¯ï¼Œæµç¨‹å¦‚ä¸‹ï¼š\n\nHSTS å¦‚ä½•çŸ¥é“å“ªäº›è¯·æ±‚è¯¥è½¬ä¸º HTTPSï¼Œå“ªäº›ä¸è¯¥è½¬?\nHSTS HEADER(Strict-Transport-Security)\næœ€è¿‘ä¸€æ¬¡è¯·æ±‚çš„ HTTPS å“åº”ä¸­ï¼ˆRESPONSEï¼‰ä¸­ï¼Œå¸¦ä¸Š HSTS HEADERï¼š\nStrict-Transport-Security: &lt;max-age=>[; includeSubDomains][; preload]\n\nHSTS PRELOAD LIST\nHSTS HEADER(Strict-Transport-Security) è¿˜æ˜¯æœ‰ä¸ªæ¼æ´ï¼š\n\nå¦‚æœç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™ A å°±è¢«åŠ«æŒäº†ï¼Œå“ªæ–¹æ¡ˆ 1 å²‚ä¸ç™½æ­ï¼Ÿ\næ¸… Cookies æˆ–è€… HSTS Header è¿‡æœŸäº†ï¼Œä¸‹æ¬¡è®¿é—®å²‚ä¸åˆé£é™©é‡é‡ï¼ŸåŸºäºä»¥ä¸Šé—®é¢˜ï¼Œå°±éœ€è¦æ–¹æ¡ˆ 2ï¼ˆHSTS Preload Listï¼‰ï¼š\n\nå®˜æ–¹è¯´æ˜ï¼š\nThis is a list of sites that are hardcoded into Chrome as being HTTPS only.\nHSTS Preload List æ˜¯ä¸€ä¸ªç«™ç‚¹åˆ—è¡¨ï¼Œå®ƒè¢« hardcode å†™å…¥ Chrome ä¸­ï¼Œåˆ—è¡¨ä¸­çš„ç«™ç‚¹å°†ä¼šé»˜è®¤ä½¿ç”¨ HTTPS è¿›è¡Œè®¿é—®ã€‚\n\nMost major browsers (Chrome, Firefox, Opera, Safari, IE 11 and Edge) also have HSTS preload lists based on the Chrome list. (See the HSTS compatibility matrix.)\nä¸»æµæµè§ˆå™¨ï¼ˆFirefox, Opera, Safari, IE 11 and Edgeï¼‰éƒ½æœ‰å’Œ Chrome ä¸€æ ·çš„ HSTS Preload Listã€‚\nHSTS å¯èƒ½å¯¼è‡´ CORS äº§ç”Ÿè·¨åŸŸé—®é¢˜HSTS (HTTP Strict Transport Security) ä¸ºäº†é¿å… HTTP è·³è½¬åˆ° HTTPS æ—¶é­å—æ½œåœ¨çš„ä¸­é—´äººæ”»å‡»ï¼Œç”±æµè§ˆå™¨æœ¬èº«æ§åˆ¶åˆ° HTTPS çš„è·³è½¬ã€‚å¦‚åŒ CORS ä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯æœ‰ä¸€ä¸ªæœåŠ¡å™¨çš„å“åº”å¤´ Strict-Transport-Security: max-age=5184000 æ¥æ§åˆ¶ï¼Œæ­¤æ—¶æµè§ˆå™¨è®¿é—®è¯¥åŸŸåæ—¶ï¼Œä¼šä½¿ç”¨ 307 Internal Redirectï¼Œæ— éœ€æœåŠ¡å™¨å¹²æ¶‰ï¼Œè‡ªåŠ¨è·³è½¬åˆ° HTTPS è¯·æ±‚ã€‚\nã€Œå¦‚æœå‰ç«¯è®¿é—® HTTP è·¨åŸŸè¯·æ±‚ï¼Œæ­¤æ—¶æµè§ˆå™¨é€šè¿‡ HSTS è·³è½¬åˆ° HTTPSï¼Œä½†æµè§ˆå™¨ä¸ä¼šç»™å‡ºç›¸åº”çš„ CORS å“åº”å¤´éƒ¨ï¼Œå°±ä¼šå‘ç”Ÿè·¨åŸŸé—®é¢˜ã€‚ã€\nGET / HTTP/1.1\nHost: shanyue.tech\nOrigin: http://shanyue.tech\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36\nAccess to XMLHttpRequest at 'xxx' from origin 'xxx' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.\n\nCORSCORS å³è·¨åŸŸèµ„æºå…±äº« (Cross-Origin Resource Sharing, CORS)ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„å“åº”ä¸­åŠ å…¥å‡ ä¸ªæ ‡å¤´ï¼Œä½¿å¾—æµè§ˆå™¨èƒ½å¤Ÿè·¨åŸŸè®¿é—®èµ„æºã€‚\nè¿™ä¸ªå“åº”å¤´çš„å­—æ®µè®¾ç½®å°±æ˜¯ï¼šAccess-Control-Allow-Origin: *\næµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚\n\n\n\n\n\n\n\n\n\nç®€å•è¯·æ±‚Method: è¯·æ±‚çš„æ–¹æ³•æ˜¯ GETã€POST åŠ HEADHeader: è¯·æ±‚å¤´æ˜¯ Content-Type (æœ‰é™åˆ¶)ã€Accept-Languageã€Content-Language ç­‰Content-Type: è¯·æ±‚ç±»å‹æ˜¯ application&#x2F;x-www-form-urlencodedã€multipart&#x2F;form-data æˆ– text&#x2F;plain\néç®€å•è¯·æ±‚é™¤ç®€å•è¯·æ±‚å¤–ï¼Œå‡ä¸ºéç®€å•è¯·æ±‚ã€‚ä¸€èˆ¬éœ€è¦å¼€å‘è€…ä¸»åŠ¨æ„é€ ï¼Œåœ¨é¡¹ç›®ä¸­å¸¸è§çš„ Content-Type: application&#x2F;json åŠ Authorization:  ä¸ºå…¸å‹çš„ã€Œéç®€å•è¯·æ±‚ã€\né¢„æ£€è¯·æ±‚(preflight request)éç®€å•è¯·æ±‚çš„ CORS è¯·æ±‚æ˜¯ä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰è¿›è¡Œä¸€æ¬¡é¢„æ£€è¯·æ±‚ï¼Œâ€é¢„æ£€â€ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯ OPTIONS , è¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„\n// è·¨åŸŸè¯·æ±‚\nvar url = 'http://localhost:2333/cors';\nvar xhr = new XMLHttpRequest();\nxhr.open('PUT', url, true);\nxhr.setRequestHeader('X-Custom-Header', 'value');\nxhr.send();\n\nç”±äºä¸Šé¢çš„ä»£ç ä½¿ç”¨çš„æ˜¯ PUT æ–¹æ³•,å¹¶ä¸”å‘é€äº†ä¸€ä¸ªè‡ªå®šä¹‰å¤´ä¿¡æ¯.æ‰€ä»¥æ˜¯ä¸€ä¸ªéç®€å•è¯·æ±‚,å½“æµè§ˆå™¨å‘ç°è¿™æ˜¯ä¸€ä¸ªéç®€å•è¯·æ±‚çš„æ—¶å€™,ä¼šè‡ªåŠ¨å‘å‡ºé¢„æ£€è¯·æ±‚,çœ‹çœ‹æœåŠ¡å™¨å¯ä¸å¯ä»¥æ¥æ”¶è¿™ç§è¯·æ±‚,ä¸‹é¢æ˜¯â€é¢„æ£€â€çš„ HTTP å¤´ä¿¡æ¯\n// è·¨åŸŸè¯·æ±‚ é¢„æ£€ request headers\nOPTIONS /cors HTTP/1.1\nOrigin: localhost:2333\nAccess-Control-Request-Method: PUT // è¡¨ç¤ºä½¿ç”¨çš„ä»€ä¹ˆHTTPè¯·æ±‚æ–¹æ³•\nAccess-Control-Request-Headers: X-Custom-Header // è¡¨ç¤ºæµè§ˆå™¨å‘é€çš„è‡ªå®šä¹‰å­—æ®µ\nHost: localhost:2332\nAccept-Language: zh-CN,zh;q=0.9\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...\n\né¢„æ£€è¯·æ±‚åçš„å›åº”ï¼ŒæœåŠ¡å™¨æ”¶åˆ°â€é¢„æ£€â€è¯·æ±‚ä»¥åï¼Œæ£€æŸ¥äº† Originã€Access-Control-Request-Method å’Œ Access-Control-Request-Headers å­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚\n// è·¨åŸŸè¯·æ±‚ é¢„æ£€ response headers\nHTTP/1.1 200 OK\nDate: Mon, 01 Dec 2008 01:15:39 GMT\nServer: Apache/2.0.61 (Unix)\nAccess-Control-Allow-Origin: http://localhost:2332 // è¡¨ç¤ºhttp://localhost:2332å¯ä»¥è®¿é—®æ•°æ®\nAccess-Control-Allow-Methods: GET, POST, PUT\nAccess-Control-Allow-Headers: X-Custom-Header\nContent-Type: text/html; charset=utf-8\nContent-Encoding: gzip\nContent-Length: 0\nKeep-Alive: timeout=2, max=100\nConnection: Keep-Alive\nContent-Type: text/plain\n\nCORS Response HeadersAccess-Control-Allow-Origin: å¯ä»¥æŠŠèµ„æºå…±äº«ç»™é‚£äº›åŸŸåï¼Œæ”¯æŒ * åŠ ç‰¹å®šåŸŸåAccess-Control-Allow-Credentials: è¯·æ±‚æ˜¯å¦å¯ä»¥å¸¦ cookieAccess-Control-Allow-Methods: è¯·æ±‚æ‰€å…è®¸çš„æ–¹æ³•, ã€Œç”¨äºé¢„æ£€è¯·æ±‚ä¸­ã€Access-Control-Allow-Headers: è¯·æ±‚æ‰€å…è®¸çš„å¤´ï¼Œã€Œç”¨äºé¢„æ£€è¯·æ±‚ä¸­ã€Access-Control-Expose-Headers: é‚£äº›å¤´å¯ä»¥åœ¨å“åº”ä¸­åˆ—å‡ºAccess-Control-Max-Age: é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´\nKoa CORS ä¸­é—´ä»¶åŸç†\nå¿…é¡»æ ¡éªŒæ˜¯å¦æœ‰ Origin è¯·æ±‚å¤´ï¼Œè·¨åŸŸè¯·æ±‚ä¸€å®šä¼šæœ‰ Origin è¯·æ±‚å¤´ï¼Œ@koa/cors ä¸­é—´ä»¶æºç  origin = options.origin || requestOrigin å¯çŸ¥ï¼Œä¼˜å…ˆå– options.originï¼Œé»˜è®¤ä»¥å½“å‰è¯·æ±‚çš„ Origin è¯·æ±‚å¤´ä½œä¸º Access-Control-Allow-Origin çš„å“åº”å¤´ä¿¡æ¯ï¼Œä¿è¯å½“å‰è¯·æ±‚å…è®¸è·¨åŸŸã€‚\nmodule.exports = function(options) &#123;\n const defaults = &#123;\n   allowMethods: 'GET,HEAD,PUT,POST,DELETE,PATCH',\n &#125;;\n\n options = &#123;\n   ...defaults,\n   ...options,\n &#125;;\n\n // ...\n\n return async function cors(ctx, next) &#123;\n   // If the Origin header is not present terminate this set of steps.\n   // The request is outside the scope of this specification.\n   const requestOrigin = ctx.get('Origin');\n\n   // Always set Vary header\n   // https://github.com/rs/cors/issues/10\n   ctx.vary('Origin');\n\n   if (!requestOrigin) return await next();\n\n   let origin;\n   if (typeof options.origin === 'function') &#123;\n     origin = options.origin(ctx);\n     if (origin instanceof Promise) origin = await origin;\n     if (!origin) return await next();\n   &#125; else &#123;\n     origin = options.origin || requestOrigin;\n   &#125;\n\n   let credentials;\n   if (typeof options.credentials === 'function') &#123;\n     credentials = options.credentials(ctx);\n     if (credentials instanceof Promise) credentials = await credentials;\n   &#125; else &#123;\n     credentials = !!options.credentials;\n   &#125;\n\n   const headersSet = &#123;&#125;;\n\n   function set(key, value) &#123;\n     ctx.set(key, value);\n     headersSet[key] = value;\n   &#125;\n\n   if (ctx.method !== 'OPTIONS') &#123;\n     // Simple Cross-Origin Request, Actual Request, and Redirects\n     set('Access-Control-Allow-Origin', origin);\n\n     if (credentials === true) &#123;\n       set('Access-Control-Allow-Credentials', 'true');\n     &#125;\n\n     if (options.exposeHeaders) &#123;\n       set('Access-Control-Expose-Headers', options.exposeHeaders);\n    &#125;\n\n     if (!options.keepHeadersOnError) &#123;\n       return await next();\n     &#125;\n     try &#123;\n       return await next();\n     &#125; catch (err) &#123;\n       const errHeadersSet = err.headers || &#123;&#125;;\n       const varyWithOrigin = vary.append(errHeadersSet.vary || errHeadersSet.Vary || '', 'Origin');\n       delete errHeadersSet.Vary;\n\n       err.headers = &#123;\n         ...errHeadersSet,\n         ...headersSet,\n         ...&#123; vary: varyWithOrigin &#125;,\n       &#125;;\n       throw err;\n     &#125;\n   &#125; else &#123;\n     // Preflight Request\n\n     // If there is no Access-Control-Request-Method header or if parsing failed,\n     // do not set any additional headers and terminate this set of steps.\n     // The request is outside the scope of this specification.\n     if (!ctx.get('Access-Control-Request-Method')) &#123;\n       // this not preflight request, ignore it\n       return await next();\n     &#125;\n\n     ctx.set('Access-Control-Allow-Origin', origin);\n\n     if (credentials === true) &#123;\n       ctx.set('Access-Control-Allow-Credentials', 'true');\n     &#125;\n\n     if (options.maxAge) &#123;\n       ctx.set('Access-Control-Max-Age', options.maxAge);\n     &#125;\n\n     if (options.allowMethods) &#123;\n       ctx.set('Access-Control-Allow-Methods', options.allowMethods);\n     &#125;\n\n     let allowHeaders = options.allowHeaders;\n     if (!allowHeaders) &#123;\n       allowHeaders = ctx.get('Access-Control-Request-Headers');\n     &#125;\n     if (allowHeaders) &#123;\n       ctx.set('Access-Control-Allow-Headers', allowHeaders);\n     &#125;\n\n     ctx.status = 204;\n   &#125;\n &#125;;\n&#125;;\n\nCORS ä¸ Vary: Originå½“è¯·æ±‚ç½‘ç»œé™æ€èµ„æºä¸ºè·¨åŸŸèµ„æºï¼ˆå¸¸è§çš„ä¸º cdn é™æ€èµ„æºï¼Œå¦‚ jsã€cssã€images ç­‰ï¼‰æ—¶ï¼Œé€šå¸¸æ˜¯ä¼šè®¾ç½®ç›¸å…³åå•†ç¼“å­˜å“åº”å¤´ï¼ˆLast-Modifiedã€Etagï¼‰ã€‚è¿™ç§ä¸€æ—¦ç›¸åŒçš„èµ„æºé“¾æ¥éœ€è¦æ ¹æ®ä¸åŒçš„è¯·æ±‚å¤´ï¼ˆå¦‚User-Agentï¼‰å“åº”ä¸åŒçš„é™æ€èµ„æºï¼ˆPCã€Mobileï¼‰æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜èµ„æºå“åº”é”™ä¹±ï¼Œæ­¤æ—¶å¿…é¡»è®¾ç½® Vary: Origin, User-Agentï¼Œå³ä»£è¡¨ä¸ºä¸åŒçš„ Origin æˆ– User-Agent ç¼“å­˜ä¸åŒçš„èµ„æºã€‚\nè¯¦è§ æµè§ˆå™¨ç¼“å­˜åŠå†…å®¹åå•†\nå‚è€ƒæµè§ˆå™¨ä¸­çš„è·¨åŸŸé—®é¢˜ä¸ CORSé¢è¯•å®˜é—®æˆ‘ CORS è·¨åŸŸï¼Œæˆ‘ç›´æ¥ä¸€å¥—æ“ä½œæ–©æ€ï¼æµ…æ HSTSç®€å•æ˜“æ‡‚ HSTSï¼Œä½ éœ€è¦å®ƒï¼ã€å®‰å…¨ã€‘HSTS - å¼ºåˆ¶å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰ä½¿ç”¨ HTTPS ä¸æœåŠ¡å™¨åˆ›å»ºè¿æ¥\n","slug":"cors","date":"2022-02-12T16:54:51.000Z","categories_index":"","tags_index":"HTTP","author_index":"Matrix"},{"id":"0f1e554315f0274ca298957330a8910f","title":"æµè§ˆå™¨ç¼“å­˜åŠå†…å®¹åå•†","content":"æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ HTTP ç¼“å­˜æœºåˆ¶ï¼Œå…¶æœºåˆ¶æ˜¯æ ¹æ® HTTP æŠ¥æ–‡çš„ç¼“å­˜æ ‡è¯†è¿›è¡Œçš„ã€‚\n\n\n\n\n\n\n\n\n\næµè§ˆå™¨ç¼“å­˜è¿‡ç¨‹ï¼š å¼ºç¼“å­˜ã€åå•†ç¼“å­˜ã€‚æµè§ˆå™¨ç¼“å­˜ä½ç½®ä¸€èˆ¬åˆ†ä¸ºå››ç±»ï¼š Service Workerã€Memory Cacheã€Disk Cacheã€Push Cache\nå¼ºç¼“å­˜å¼ºç¼“å­˜æ˜¯å½“æˆ‘ä»¬è®¿é—® URL çš„æ—¶å€™ï¼Œä¸ä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–èµ„æºï¼Œä½†æ˜¯ä¼šè¿”å› 200 çš„çŠ¶æ€ç ã€‚\nå¦‚ä½•è®¾ç½®å¼ºç¼“å­˜ï¼Ÿæˆ‘ä»¬ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢ï¼Œè¯·æ±‚æœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨è¿›è¡Œåº”ç­”ï¼Œæµè§ˆå™¨ä¼šæ ¹æ® response Header æ¥åˆ¤æ–­æ˜¯å¦å¯¹èµ„æºè¿›è¡Œç¼“å­˜ï¼Œå¦‚æœå“åº”å¤´ä¸­ expiresã€pragma æˆ–è€… cache-control å­—æ®µï¼Œä»£è¡¨è¿™æ˜¯å¼ºç¼“å­˜ï¼Œæµè§ˆå™¨å°±ä¼šæŠŠèµ„æºç¼“å­˜åœ¨ memory cache æˆ– disk cache ä¸­ã€‚\nç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨åˆ¤æ–­è¯·æ±‚å‚æ•°ï¼Œå¦‚æœç¬¦åˆå¼ºç¼“å­˜æ¡ä»¶å°±ç›´æ¥è¿”å›çŠ¶æ€ç  200ï¼Œä»æœ¬åœ°ç¼“å­˜ä¸­æ‹¿æ•°æ®ã€‚å¦åˆ™æŠŠå“åº”å‚æ•°å­˜åœ¨ request header è¯·æ±‚å¤´ä¸­ï¼Œçœ‹æ˜¯å¦ç¬¦åˆåå•†ç¼“å­˜ï¼Œç¬¦åˆåˆ™è¿”å›çŠ¶æ€ç  304ï¼Œä¸ç¬¦åˆåˆ™æœåŠ¡å™¨ä¼šè¿”å›å…¨æ–°èµ„æºã€‚\n\n\n\n\n\n\n\n\n\n\nExpiresæ˜¯ HTTP1.0 æ§åˆ¶ç½‘é¡µç¼“å­˜çš„å­—æ®µï¼Œå€¼ä¸ºä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå‡†ç¡®æ¥è®²æ˜¯æ ¼æ—å°¼æ²»æ—¶é—´ï¼ŒæœåŠ¡å™¨è¿”å›è¯¥è¯·æ±‚ç»“æœç¼“å­˜çš„åˆ°æœŸæ—¶é—´ï¼Œæ„æ€æ˜¯ï¼Œå†æ¬¡å‘é€è¯·æ±‚æ—¶ï¼Œå¦‚æœæœªè¶…è¿‡è¿‡æœŸæ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨è¯¥ç¼“å­˜ï¼Œå¦‚æœè¿‡æœŸäº†åˆ™é‡æ–°è¯·æ±‚ã€‚ç¼ºç‚¹ï¼šå°±æ˜¯å®ƒåˆ¤æ–­æ˜¯å¦è¿‡æœŸæ˜¯ç”¨æœ¬åœ°æ—¶é—´æ¥åˆ¤æ–­çš„ï¼Œæœ¬åœ°æ—¶é—´æ˜¯å¯ä»¥è‡ªå·±ä¿®æ”¹çš„ã€‚\nCache-Controlæ˜¯ HTTP1.1 ä¸­æ§åˆ¶ç½‘é¡µç¼“å­˜çš„å­—æ®µï¼Œå½“ Cache-Control éƒ½å­˜åœ¨æ—¶ï¼ŒCache-Control ä¼˜å…ˆçº§æ›´é«˜\n\npublicï¼šèµ„æºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥ç¼“å­˜ã€‚\nprivateï¼šèµ„æºåªæœ‰å®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜ã€‚\nno-cacheï¼šå®¢æˆ·ç«¯ç¼“å­˜èµ„æºï¼Œä½†æ˜¯æ˜¯å¦ç¼“å­˜éœ€è¦ç»è¿‡åå•†ç¼“å­˜æ¥éªŒè¯ã€‚\nno-storeï¼šä¸ä½¿ç”¨ç¼“å­˜ã€‚\nmax-ageï¼šæœ€å¤§è¿‡æœŸæ—¶é—´ï¼ˆè·ç¦»å½“å‰è¯·æ±‚çš„æ—¶é—´å·®ï¼‰\n\n\nCache-Control ä½¿ç”¨äº† max-age ç›¸å¯¹æ—¶é—´ï¼Œè§£å†³äº† expires çš„é—®é¢˜\nPragmaè¿™ä¸ªæ˜¯ HTTP1.0 ä¸­ç¦ç”¨ç½‘é¡µç¼“å­˜çš„å­—æ®µï¼Œå…¶å–å€¼ä¸º no-cacheï¼Œå’Œ Cache-Control çš„ no-cache æ•ˆæœä¸€æ ·\nVary(å†…å®¹åå•†)è¦äº†è§£ Vary çš„ä½œç”¨ï¼Œå…ˆå¾—äº†è§£ HTTP çš„å†…å®¹åå•†æœºåˆ¶ã€‚æœ‰æ—¶å€™ï¼ŒåŒä¸€ä¸ª URL å¯ä»¥æä¾›å¤šä»½ä¸åŒçš„æ–‡æ¡£ï¼Œè¿™å°±è¦æ±‚æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´æœ‰ä¸€ä¸ªé€‰æ‹©æœ€åˆé€‚ç‰ˆæœ¬çš„æœºåˆ¶ï¼Œè¿™å°±æ˜¯å†…å®¹åå•†.æœåŠ¡ç«¯æ ¹æ®å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¤´ä¸­æŸäº›å­—æ®µè‡ªåŠ¨å‘é€æœ€åˆé€‚çš„ç‰ˆæœ¬ã€‚å¯ä»¥ç”¨äºè¿™ä¸ªæœºåˆ¶çš„è¯·æ±‚å¤´å­—æ®µåˆåˆ†ä¸¤ç§ï¼šå†…å®¹åå•†ä¸“ç”¨å­—æ®µï¼ˆAccept å­—æ®µï¼‰ã€å…¶ä»–å­—æ®µ.\n\n\n\nè¯·æ±‚å¤´å­—æ®µ\nè¯´æ˜\nå“åº”å¤´å­—æ®µ\n\n\n\nAccept\nå‘ŠçŸ¥æœåŠ¡å™¨å‘é€ä½•ç§åª’ä½“ç±»å‹\nContent-Type\n\n\nAccept-Language\nå‘ŠçŸ¥æœåŠ¡å™¨å‘é€ä½•ç§è¯­è¨€\nContent-Language\n\n\nAccept-Charset\nå‘ŠçŸ¥æœåŠ¡å™¨å‘é€ä½•ç§å­—ç¬¦é›†\nContent-Type\n\n\nAccept-Encoding\nå‘ŠçŸ¥æœåŠ¡å™¨é‡‡ç”¨ä½•ç§å‹ç¼©æ–¹å¼\nContent-Encoding\n\n\n// ä¾‹å¦‚å®¢æˆ·ç«¯å‘é€ä»¥ä¸‹è¯·æ±‚å¤´\n// è¡¨ç¤ºå®ƒå¯ä»¥æ¥å—ä»»ä½• MIME ç±»å‹çš„èµ„æºï¼›æ”¯æŒé‡‡ç”¨ gzipã€deflate æˆ– sdch å‹ç¼©è¿‡çš„èµ„æºï¼›å¯ä»¥æ¥å— zh-CNã€en-US å’Œ en ä¸‰ç§è¯­è¨€ï¼Œå¹¶ä¸” zh-CN çš„æƒé‡æœ€é«˜ï¼ˆq å–å€¼ 0 - 1ï¼Œæœ€é«˜ä¸º 1ï¼Œæœ€ä½ä¸º 0ï¼Œé»˜è®¤ä¸º 1ï¼‰ï¼ŒæœåŠ¡ç«¯åº”è¯¥ä¼˜å…ˆè¿”å›è¯­è¨€ç­‰äº zh-CN çš„ç‰ˆæœ¬ã€‚\nAccept:*/*\nAccept-Encoding:gzip,deflate,sdch\nAccept-Language:zh-CN,en-US;q=0.8,en;q=0.6\n\n// æµè§ˆå™¨çš„å“åº”å¤´å¯èƒ½æ˜¯è¿™æ ·çš„\n// è¡¨ç¤ºè¿™ä¸ªæ–‡æ¡£ç¡®åˆ‡çš„ MIME ç±»å‹æ˜¯ text/javascriptï¼›æ–‡æ¡£å†…å®¹è¿›è¡Œäº† gzip å‹ç¼©ï¼›å“åº”å¤´æ²¡æœ‰ Content-Language å­—æ®µï¼Œé€šå¸¸è¯´æ˜è¿”å›ç‰ˆæœ¬çš„è¯­è¨€æ­£å¥½æ˜¯è¯·æ±‚å¤´ Accept-Language ä¸­æƒé‡æœ€é«˜çš„é‚£ä¸ª\nContent-Type: text/javascript\nContent-Encoding: gzip\n\nä¸Šé¢å››ä¸ª Accept å­—æ®µå¹¶ä¸å¤Ÿç”¨ï¼Œä¾‹å¦‚è¦é’ˆå¯¹ç‰¹å®šæµè§ˆå™¨å¦‚ IE6 è¾“å‡ºä¸ä¸€æ ·çš„å†…å®¹ï¼Œå°±éœ€è¦ç”¨åˆ°è¯·æ±‚å¤´ä¸­çš„ User-Agent å­—æ®µã€‚ç±»ä¼¼çš„ï¼Œè¯·æ±‚å¤´ä¸­çš„ Cookie ä¹Ÿå¯èƒ½è¢«æœåŠ¡ç«¯ç”¨åšè¾“å‡ºå·®å¼‚åŒ–å†…å®¹çš„ä¾æ®ã€‚ç”±äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å¯èƒ½å­˜åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªä¸­é—´å®ä½“ï¼ˆå¦‚ç¼“å­˜æœåŠ¡å™¨ï¼‰ï¼Œè€Œç¼“å­˜æœåŠ¡æœ€åŸºæœ¬çš„è¦æ±‚æ˜¯ç»™ç”¨æˆ·è¿”å›æ­£ç¡®çš„æ–‡æ¡£ã€‚å¦‚æœæœåŠ¡ç«¯æ ¹æ®ä¸åŒ User-Agent è¿”å›ä¸åŒå†…å®¹ï¼Œè€Œç¼“å­˜æœåŠ¡å™¨æŠŠ IE6 ç”¨æˆ·çš„å“åº”ç¼“å­˜ä¸‹æ¥ï¼Œå¹¶è¿”å›ç»™ä½¿ç”¨å…¶ä»–æµè§ˆå™¨çš„ç”¨æˆ·ï¼Œè‚¯å®šä¼šå‡ºé—®é¢˜æ‰€ä»¥ HTTP åè®®è§„å®šï¼Œå¦‚æœæœåŠ¡ç«¯æä¾›çš„å†…å®¹å–å†³äº User-Agent è¿™æ ·ã€Œå¸¸è§„ Accept åå•†å­—æ®µä¹‹å¤–ã€çš„è¯·æ±‚å¤´å­—æ®µï¼Œé‚£ä¹ˆå“åº”å¤´ä¸­å¿…é¡»åŒ…å« Vary å­—æ®µï¼Œä¸” Vary çš„å†…å®¹å¿…é¡»åŒ…å« User-Agentã€‚åŒç†ï¼Œå¦‚æœæœåŠ¡ç«¯åŒæ—¶ä½¿ç”¨è¯·æ±‚å¤´ä¸­ User-Agent å’Œ Cookie è¿™ä¸¤ä¸ªå­—æ®µæ¥ç”Ÿæˆå†…å®¹ï¼Œé‚£ä¹ˆå“åº”ä¸­çš„ Vary å­—æ®µçœ‹ä¸Šå»åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š\nVary: User-Agent, Cookie\n\nä¹Ÿå°±æ˜¯è¯´ Vary å­—æ®µç”¨äºåˆ—å‡ºä¸€ä¸ªå“åº”å­—æ®µåˆ—è¡¨ï¼Œå‘Šè¯‰ç¼“å­˜æœåŠ¡å™¨é‡åˆ°åŒä¸€ä¸ª URL å¯¹åº”ç€ä¸åŒç‰ˆæœ¬æ–‡æ¡£çš„æƒ…å†µæ—¶ï¼Œå¦‚ä½•ç¼“å­˜å’Œç­›é€‰åˆé€‚çš„ç‰ˆæœ¬ã€‚\n\n\nç¼“å­˜ä½ç½®å¼ºç¼“å­˜ä¼šæŠŠèµ„æºæˆ¿æ”¾åˆ° memory cache å’Œ disk cache ä¸­ï¼Œé‚£ä»€ä¹ˆèµ„æºæ”¾åœ¨ memory cacheï¼Œä»€ä¹ˆèµ„æºæ”¾åœ¨ disk cache ä¸­ï¼Ÿ\n\næŸ¥æ‰¾æµè§ˆå™¨ç¼“å­˜æ—¶ä¼šæŒ‰é¡ºåºæŸ¥æ‰¾: Service Worker -&gt; Memory Cache -&gt; Disk Cache -&gt; Push Cacheã€‚\n\n\n\n\n\n\n\n\n\nService Workeræ˜¯è¿è¡Œåœ¨æµè§ˆå™¨èƒŒåçš„ç‹¬ç«‹çº¿ç¨‹ï¼Œä¸€èˆ¬å¯ä»¥ç”¨æ¥å®ç°ç¼“å­˜åŠŸèƒ½ã€‚ä½¿ç”¨ Service Worker çš„è¯ï¼Œä¼ è¾“åè®®å¿…é¡»ä¸º HTTPSã€‚å› ä¸º Service Worker ä¸­æ¶‰åŠåˆ°è¯·æ±‚æ‹¦æˆªï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ HTTPS åè®®æ¥ä¿éšœå®‰å…¨ã€‚Service Worker çš„ç¼“å­˜ä¸æµè§ˆå™¨å…¶ä»–å†…å»ºçš„ç¼“å­˜æœºåˆ¶ä¸åŒï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬è‡ªç”±æ§åˆ¶ç¼“å­˜å“ªäº›æ–‡ä»¶ã€å¦‚ä½•åŒ¹é…ç¼“å­˜ã€å¦‚ä½•è¯»å–ç¼“å­˜ï¼Œå¹¶ä¸”ç¼“å­˜æ˜¯æŒç»­æ€§çš„ã€‚\nMemory Cacheå†…å­˜ä¸­çš„ç¼“å­˜ï¼Œä¸»è¦åŒ…å«çš„æ˜¯å½“å‰ä¸­é¡µé¢ä¸­å·²ç»æŠ“å–åˆ°çš„èµ„æºï¼Œä¾‹å¦‚é¡µé¢ä¸Šå·²ç»ä¸‹è½½çš„æ ·å¼ã€è„šæœ¬ã€å›¾ç‰‡ç­‰ã€‚è¯»å–å†…å­˜ä¸­çš„æ•°æ®è‚¯å®šæ¯”ç£ç›˜å¿«ï¼Œå†…å­˜ç¼“å­˜è™½ç„¶è¯»å–é«˜æ•ˆï¼Œå¯æ˜¯ç¼“å­˜æŒç»­æ€§å¾ˆçŸ­ï¼Œä¼šéšç€è¿›ç¨‹çš„é‡Šæ”¾è€Œé‡Šæ”¾ã€‚ä¸€æ—¦æˆ‘ä»¬å…³é—­ Tab é¡µé¢ï¼Œå†…å­˜ä¸­çš„ç¼“å­˜ä¹Ÿå°±è¢«é‡Šæ”¾äº†ã€‚\nDisk Cacheå­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„ç¼“å­˜ï¼Œè¯»å–é€Ÿåº¦æ…¢ç‚¹ï¼Œä½†æ˜¯ä»€ä¹ˆéƒ½èƒ½å­˜å‚¨åˆ°ç£ç›˜ä¸­ï¼Œæ¯”ä¹‹ Memory Cache èƒœåœ¨å®¹é‡å’Œå­˜å‚¨æ—¶æ•ˆæ€§ä¸Šã€‚åœ¨æ‰€æœ‰æµè§ˆå™¨ç¼“å­˜ä¸­ï¼ŒDisk Cache è¦†ç›–é¢åŸºæœ¬æ˜¯æœ€å¤§çš„ã€‚å®ƒä¼šæ ¹æ® HTTP Herder ä¸­çš„å­—æ®µåˆ¤æ–­å“ªäº›èµ„æºéœ€è¦ç¼“å­˜ï¼Œå“ªäº›èµ„æºå¯ä»¥ä¸è¯·æ±‚ç›´æ¥ä½¿ç”¨ï¼Œå“ªäº›èµ„æºå·²ç»è¿‡æœŸéœ€è¦é‡æ–°è¯·æ±‚ã€‚å¹¶ä¸”å³ä½¿åœ¨è·¨ç«™ç‚¹çš„æƒ…å†µä¸‹ï¼Œç›¸åŒåœ°å€çš„èµ„æºä¸€æ—¦è¢«ç¡¬ç›˜ç¼“å­˜ä¸‹æ¥ï¼Œå°±ä¸ä¼šå†æ¬¡å»è¯·æ±‚æ•°æ®ã€‚ç»å¤§éƒ¨åˆ†çš„ç¼“å­˜éƒ½æ¥è‡ª Disk Cacheã€‚memory cache è¦æ¯” disk cache å¿«çš„å¤šã€‚ä¸¾ä¸ªä¾‹å­ï¼šä»è¿œç¨‹ web æœåŠ¡å™¨ç›´æ¥æå–è®¿é—®æ–‡ä»¶å¯èƒ½éœ€è¦ 500 æ¯«ç§’(åŠç§’)ï¼Œé‚£ä¹ˆç£ç›˜è®¿é—®å¯èƒ½éœ€è¦ 10-20 æ¯«ç§’ï¼Œè€Œå†…å­˜è®¿é—®åªéœ€è¦ 100 çº³ç§’ï¼Œæ›´é«˜çº§çš„è¿˜æœ‰ L1 ç¼“å­˜è®¿é—®(æœ€å¿«å’Œæœ€å°çš„ CPU ç¼“å­˜)åªéœ€è¦ 0.5 çº³ç§’ã€‚å¾ˆç¥å¥‡çš„ï¼Œæˆ‘ä»¬åˆçœ‹åˆ°äº†ä¸€ä¸ª prefetch cacheï¼Œè¿™ä¸ªåˆæ˜¯ä»€ä¹ˆå‘¢?\n\nprefetch cache(é¢„å–ç¼“å­˜)link æ ‡ç­¾ä¸Šå¸¦äº† prefetchï¼Œå†æ¬¡åŠ è½½ä¼šå‡ºç°ã€‚prefetch æ˜¯é¢„åŠ è½½çš„ä¸€ç§æ–¹å¼ï¼Œè¢«æ ‡è®°ä¸º prefetch çš„èµ„æºï¼Œå°†ä¼šè¢«æµè§ˆå™¨åœ¨ç©ºé—²æ—¶é—´åŠ è½½ã€‚ 4. Push Cache\nPush Cache(æ¨é€ç¼“å­˜)æ˜¯ HTTP&#x2F;2 ä¸­çš„å†…å®¹ï¼Œå½“ä»¥ä¸Šä¸‰ç§ç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­æ—¶ï¼Œå®ƒæ‰ä¼šè¢«ä½¿ç”¨ã€‚å®ƒåªåœ¨ä¼šè¯ï¼ˆSessionï¼‰ä¸­å­˜åœ¨ï¼Œä¸€æ—¦ä¼šè¯ç»“æŸå°±è¢«é‡Šæ”¾ï¼Œå¹¶ä¸”ç¼“å­˜æ—¶é—´ä¹Ÿå¾ˆçŸ­æš‚ï¼Œåœ¨ Chrome æµè§ˆå™¨ä¸­åªæœ‰ 5 åˆ†é’Ÿå·¦å³ï¼ŒåŒæ—¶å®ƒä¹Ÿå¹¶éä¸¥æ ¼æ‰§è¡Œ HTTP å¤´ä¸­çš„ç¼“å­˜æŒ‡ä»¤ã€‚\n\nåå•†ç¼“å­˜åå•†ç¼“å­˜å°±æ˜¯å¼ºç¼“å­˜å¤±æ•ˆåï¼Œæµè§ˆå™¨æºå¸¦ç¼“å­˜æ ‡è¯†å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨æ ¹æ®ç¼“å­˜æ ‡è¯†æ¥å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜çš„è¿‡ç¨‹ã€‚\nåå•†ç¼“å­˜ç”Ÿæ•ˆï¼Œè¿”å› 304\nåå•†ç¼“å­˜å¤±æ•ˆï¼Œè¿”å› 200 å’Œè¯·æ±‚ç»“æœ\n\n\n\n\n\n\n\n\n\nLast-Modified &#x2F; If-Modified-SinceLast-Modified æ˜¯æœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶ï¼Œè¿”å›è¯¥èµ„æºæ–‡ä»¶åœ¨æœåŠ¡å™¨æœ€åè¢«ä¿®æ”¹çš„æ—¶é—´ã€‚If-Modified-Since åˆ™æ˜¯å®¢æˆ·ç«¯å†æ¬¡å‘èµ·è¯¥è¯·æ±‚æ—¶ï¼Œæºå¸¦ä¸Šæ¬¡è¯·æ±‚è¿”å›çš„ Last-Modified å€¼ï¼Œé€šè¿‡æ­¤å­—æ®µå€¼å‘Šè¯‰æœåŠ¡å™¨è¯¥èµ„æºä¸Šæ¬¡è¯·æ±‚è¿”å›çš„æœ€åè¢«ä¿®æ”¹æ—¶é—´ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯¥è¯·æ±‚ï¼Œå‘ç°è¯·æ±‚å¤´å«æœ‰ If-Modified-Since å­—æ®µï¼Œåˆ™ä¼šæ ¹æ® If-Modified-Since çš„å­—æ®µå€¼ä¸è¯¥èµ„æºåœ¨æœåŠ¡å™¨çš„æœ€åè¢«ä¿®æ”¹æ—¶é—´åšå¯¹æ¯”ï¼Œè‹¥æœåŠ¡å™¨çš„èµ„æºæœ€åè¢«ä¿®æ”¹æ—¶é—´å¤§äº If-Modified-Since çš„å­—æ®µå€¼ï¼Œåˆ™é‡æ–°è¿”å›èµ„æºï¼ŒçŠ¶æ€ç ä¸º 200ï¼›å¦åˆ™åˆ™è¿”å› 304ï¼Œä»£è¡¨èµ„æºæ— æ›´æ–°ï¼Œå¯ç»§ç»­ä½¿ç”¨ç¼“å­˜æ–‡ä»¶ã€‚\nEtag &#x2F; If-None-MatchEtag æ˜¯æœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶ï¼Œè¿”å›å½“å‰èµ„æºæ–‡ä»¶çš„ä¸€ä¸ªå”¯ä¸€æ ‡è¯†(ç”±æœåŠ¡å™¨ç”Ÿæˆ)ã€‚If-None-Match æ˜¯å®¢æˆ·ç«¯å†æ¬¡å‘èµ·è¯¥è¯·æ±‚æ—¶ï¼Œæºå¸¦ä¸Šæ¬¡è¯·æ±‚è¿”å›çš„å”¯ä¸€æ ‡è¯† Etag å€¼ï¼Œé€šè¿‡æ­¤å­—æ®µå€¼å‘Šè¯‰æœåŠ¡å™¨è¯¥èµ„æºä¸Šæ¬¡è¯·æ±‚è¿”å›çš„å”¯ä¸€æ ‡è¯†å€¼ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯¥è¯·æ±‚åï¼Œå‘ç°è¯¥è¯·æ±‚å¤´ä¸­å«æœ‰ If-None-Matchï¼Œåˆ™ä¼šæ ¹æ® If-None-Match çš„å­—æ®µå€¼ä¸è¯¥èµ„æºåœ¨æœåŠ¡å™¨çš„ Etag å€¼åšå¯¹æ¯”ï¼Œä¸€è‡´åˆ™è¿”å› 304ï¼Œä»£è¡¨èµ„æºæ— æ›´æ–°ï¼Œç»§ç»­ä½¿ç”¨ç¼“å­˜æ–‡ä»¶ï¼›ä¸ä¸€è‡´åˆ™é‡æ–°è¿”å›èµ„æºæ–‡ä»¶ï¼ŒçŠ¶æ€ç ä¸º 200ã€‚\nCORS ä¸ Vary: Originåœ¨è®¨è®º CORS ä¸ Vary å…³ç³»æ—¶ï¼Œå…ˆæŠ›å‡ºä¸€ä¸ªé—®é¢˜ï¼š\n\n\n\n\n\n\n\n\n\nå¦‚ä½•é¿å… CDN ä¸º PC ç«¯ç¼“å­˜ç§»åŠ¨ç«¯é¡µé¢ï¼Ÿ\nå‡è®¾æœ‰ä¸¤ä¸ªåŸŸåè®¿é—® static.shanyue.tech çš„è·¨åŸŸèµ„æº\n\nfoo.shanyue.techï¼Œå“åº”å¤´ä¸­è¿”å› Access-Control-Allow-Origin: foo.shanyue.tech\nbar.shanyue.techï¼Œå“åº”å¤´ä¸­è¿”å› Access-Control-Allow-Origin: bar.shanyue.tech\n\nçœ‹èµ·æ¥ä¸€åˆ‡æ­£å¸¸ï¼Œä½†å¹³é™çš„æ°´é¢ä¸‹æ³¢æ¶›æš—æ¶Œ:\nã€Œå¦‚æœ static.shanyue.tech èµ„æºè¢« CDN ç¼“å­˜ï¼Œbar.shanyue.tech å†æ¬¡è®¿é—®èµ„æºæ—¶ï¼Œå› ç¼“å­˜é—®é¢˜ï¼Œå› æ­¤æ­¤æ—¶è¿”å›çš„æ˜¯ Access-Control-Allow-Origin: foo.shanyue.techï¼Œæ­¤æ—¶ä¼šæœ‰è·¨åŸŸé—®é¢˜ã€\næ­¤æ—¶ï¼ŒVary: Origin å°±ä¸Šåœºäº†ï¼Œä»£è¡¨ä¸ºä¸åŒçš„ Origin ç¼“å­˜ä¸åŒçš„èµ„æºï¼Œè¿™åœ¨å„ä¸ªæœåŠ¡å™¨ç«¯ CORS ä¸­é—´ä»¶ä¹Ÿèƒ½ä½“ç°å‡ºæ¥ã€‚\nKoa å…³äº CORS çš„å¤„ç†å‡½æ•°\nreturn async function cors(ctx, next) &#123;\n  // If the Origin header is not present terminate this set of steps.\n  // The request is outside the scope of this specification.\n  const requestOrigin = ctx.get('Origin');\n\n  // Always set Vary header\n  // https://github.com/rs/cors/issues/10\n  ctx.vary('Origin');\n&#125;\n\n\n\n\n\n\n\n\n\n\næœåŠ¡å™¨ç«¯é€šè¿‡å“åº”å¤´ Origin æ¥åˆ¤æ–­æ˜¯å¦ä¸ºè·¨åŸŸè¯·æ±‚ï¼Œå¹¶ä»¥æ­¤è®¾ç½®å¤šåŸŸåè·¨åŸŸï¼Œä½†è¦åŠ ä¸Š Vary: Originã€‚\nå‚è€ƒå½»åº•ç†è§£æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶å‰ç«¯æµè§ˆå™¨ç¼“å­˜çŸ¥è¯†æ¢³ç†(1.6w å­—)æµè§ˆå™¨çµé­‚ä¹‹é—®ï¼Œè¯·é—®ä½ èƒ½æ¥å¾—ä½å‡ ä¸ªï¼ŸHTTP åè®®ä¸­ Vary çš„ä¸€äº›ç ”ç©¶æµè§ˆå™¨ä¸­çš„è·¨åŸŸé—®é¢˜ä¸ CORS\n","slug":"broswer-cache","date":"2022-02-12T13:40:50.000Z","categories_index":"","tags_index":"HTTP","author_index":"Matrix"},{"id":"230f463a6828a545fa6d14af02ab1fd6","title":"Monorepo","content":"ä»€ä¹ˆæ˜¯ Monorepo?Monorepo å…¶å®ä¸æ˜¯ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œåœ¨è½¯ä»¶å·¥ç¨‹é¢†åŸŸï¼Œå®ƒå·²ç»æœ‰ç€åå¤šå¹´çš„å†å²äº†ã€‚æ¦‚å¿µä¸Šå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æŠŠå¤šä¸ªé¡¹ç›®æ”¾åœ¨ä¸€ä¸ªä»“åº“é‡Œé¢ï¼Œç›¸å¯¹ç«‹çš„æ˜¯ä¼ ç»Ÿçš„ MultiRepo æ¨¡å¼ï¼Œå³æ¯ä¸ªé¡¹ç›®å¯¹åº”ä¸€ä¸ªå•ç‹¬çš„ä»“åº“æ¥åˆ†æ•£ç®¡ç†ã€‚\nMonorepo æ˜¯ä¸€ç§å°†å¤šä¸ªé¡¹ç›®ä»£ç å­˜å‚¨åœ¨ä¸€ä¸ªä»“åº“é‡Œçš„è½¯ä»¶å¼€å‘ç­–ç•¥ï¼ˆâ€monoâ€ æ¥æºäºå¸Œè…Šè¯­ Î¼ÏŒÎ½Î¿Ï‚ æ„å‘³å•ä¸ªçš„ï¼Œè€Œ â€œrepoâ€ï¼Œæ˜¾è€Œæ˜“è§åœ°ï¼Œæ˜¯ repository çš„ç¼©å†™ï¼‰ã€‚\n\nç°ä»£çš„å‰ç«¯å·¥ç¨‹å·²ç»è¶Šæ¥è¶Šç¦»ä¸å¼€ Monorepo äº†ï¼Œæ— è®ºæ˜¯ä¸šåŠ¡ä»£ç è¿˜æ˜¯å·¥å…·åº“ï¼Œè¶Šæ¥è¶Šå¤šçš„é¡¹ç›®å·²ç»é‡‡ç”¨ Monorepo çš„æ–¹å¼æ¥è¿›è¡Œå¼€å‘ã€‚Google å®æ„¿æŠŠæ‰€æœ‰çš„ä»£ç éƒ½æ”¾åœ¨ä¸€ä¸ª Monorepo å·¥ç¨‹ä¸‹é¢ï¼ŒVue 3ã€Yarnã€Npm7 ç­‰ç­‰çŸ¥åå¼€æºé¡¹ç›®çš„æºç ä¹Ÿæ˜¯é‡‡ç”¨ Monorepo çš„æ–¹å¼æ¥è¿›è¡Œç®¡ç†çš„ã€‚\nä¸€èˆ¬ Monorepo çš„ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨ packages å­˜æ”¾å¤šä¸ªå­é¡¹ç›®ï¼Œå¹¶ä¸”æ¯ä¸ªå­é¡¹ç›®éƒ½æœ‰è‡ªå·±çš„ package.json:\nâ”œâ”€â”€ packages\n|   â”œâ”€â”€ pkg1\n|   |   â”œâ”€â”€ package.json\n|   â”œâ”€â”€ pkg2\n|   |   â”œâ”€â”€ package.json\nâ”œâ”€â”€ package.json\n\n\né‚£ Monorepo ç©¶ç«Ÿæœ‰ä»€ä¹ˆé­”åŠ›ï¼Œè®©å¤§å®¶å¦‚æ­¤æ¨å´‡ï¼Œè½åœ°å¦‚æ­¤ä¹‹å¹¿å‘¢ï¼Ÿ\nMonorepo æœ€ä½³å®è·µä¹‹ Yarn WorkspacesYarn Workspacesï¼ˆå·¥ä½œç©ºé—´&#x2F;å·¥ä½œåŒºï¼Œæœ¬æ–‡ä½¿ç”¨å·¥ä½œç©ºé—´è¿™ä¸€åç§°ï¼‰æ˜¯ Yarn æä¾›çš„ Monorepo ä¾èµ–ç®¡ç†æœºåˆ¶ï¼Œä» Yarn 1.0 å¼€å§‹é»˜è®¤æ”¯æŒï¼Œç”¨äºåœ¨ä»£ç ä»“åº“çš„æ ¹ç›®å½•ä¸‹ç®¡ç†å¤šä¸ª project çš„ä¾èµ–ã€‚\nYarn Workspaces çš„ç›®æ ‡æ˜¯ä»¤ä½¿ç”¨ Monorepo å˜å¾—ç®€å•ï¼Œä»¥ä¸€ç§æ›´å…·å£°æ˜æ€§çš„æ–¹å¼å¤„ç† yarn link çš„ä¸»è¦ä½¿ç”¨åœºæ™¯ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒä»¬å…è®¸å¤šä¸ªé¡¹ç›®å…±å­˜åœ¨åŒä¸€ä¸ªä»£ç åº“ä¸­ï¼Œå¹¶ç›¸äº’äº¤å‰å¼•ç”¨ï¼Œå¹¶ä¸”ä¿è¯ä¸€ä¸ªé¡¹ç›®æºä»£ç çš„ä»»ä½•ä¿®æ”¹éƒ½ä¼šç«‹å³åº”ç”¨åˆ°å…¶ä»–é¡¹ç›®ä¸­ã€‚\né‡å¤å®‰è£…ã€ç®¡ç†ç¹ççš„ç¼ºç‚¹ä» npm package è¯ç”Ÿèµ·ä¾¿ä¸€ç›´å­˜åœ¨ï¼Œnode_modules hell å°±æ˜¯è¯¥é—®é¢˜çš„é›†ä¸­ä½“ç°ã€‚\n\nä¸ºäº†ç®€åŒ–æµç¨‹ï¼Œå¾ˆå¤šå¤§å‹é¡¹ç›®é‡‡ç”¨äº† Monorepo çš„åšæ³•ï¼Œå³æŠŠæ‰€æœ‰çš„åŒ…æ”¾åœ¨ä¸€ä¸ªä»“åº“ä¸­ç®¡ç†\n\n\n\n\n\n\n\n\n\nBabelã€Reactã€Vueã€Jest ç­‰éƒ½ä½¿ç”¨äº† monorepo çš„ç®¡ç†æ–¹å¼ã€‚\nMenorepo çš„ä¼˜ç‚¹æ˜¯å¯ä»¥åœ¨ä¸€ä¸ªä»“åº“é‡Œç»´æŠ¤å¤šä¸ª packageï¼Œå¯ç»Ÿä¸€æ„å»ºï¼Œè·¨ package è°ƒè¯•ã€ä¾èµ–ç®¡ç†ã€ç‰ˆæœ¬å‘å¸ƒéƒ½ååˆ†æ–¹ä¾¿ï¼Œæ­é…å·¥å…·è¿˜èƒ½ç»Ÿä¸€ç”Ÿæˆ CHANGELOGï¼›ä»£ä»·æ˜¯å³ä½¿åªå¼€å‘å…¶ä¸­ä¸€ä¸ª package ä¹Ÿéœ€è¦å®‰è£…æ•´ä¸ªé¡¹ç›®çš„ä¾èµ–ã€‚ä»¥ jest ä¸ºä¾‹ï¼Œå…¶ Monorepo ä»£ç ç»“æ„ä¸ºï¼š\n| jest/\n| ---- package.json\n| ---- packages/\n| -------- babel-jest/\n| ------------ package.json\n| -------- babel-plugin-jest-hoist/\n| ------------ package.json\n| -------- babel-preset-jest/\n| ------------ package.json\n| -------- .../\n\n\nä¸ºä½•ä½¿ç”¨ Yarn Workspacesåœ¨ä»¥ Monorepo ä¸ºä»£ç ç»„ç»‡æ–¹å¼çš„é¡¹ç›®ä¸­ï¼Œä¾èµ–ç®¡ç†çš„è§„æ¨¡å’Œå¤æ‚åº¦å‡æœ‰ä¸å°çš„æå‡ï¼ˆè¿™ä¹Ÿä¸éš¾ç†è§£ï¼Œéšç€â€æ•°é‡â€œçš„å¢åŠ ï¼Œä»»ä½•å°çš„é—®é¢˜éƒ½ä¼šå˜å¾—å¤æ‚ï¼‰ã€‚å¦‚ä½•å‡å°‘ä¾èµ–é‡å¤å®‰è£…ï¼Ÿå¦‚ä½•ä¼˜é›…å®ç°è·¨ç›®å½•ä»£ç å…±äº«ï¼Ÿå¦‚ä½•å¯¹ä¾èµ–ç‰ˆæœ¬è¿›è¡Œç»Ÿä¸€ç®¡ç†ä»¥é¿å…ç‰ˆæœ¬å†²çªï¼Ÿæ‰€ä»¥è¿™äº›é—®é¢˜éƒ½å¯ä»¥å€ŸåŠ© Yarn Workspaces æ¥è§£å†³ï¼Yarn å®˜æ–¹å¯¹äº Yarn Workspaces çš„ä½¿ç”¨æ—¶æœºï¼ˆWhy would you want to do this?ï¼‰æ˜¯è¿™æ ·æè¿°çš„ï¼š\n\n\n\n\n\n\n\n\n\nYour dependencies can be linked together, which means that your workspaces can depend on one another while always using the most up-to-date code available. This is also a better mechanism thanÂ yarn linkÂ since it only affects your workspace tree rather than your whole system.\nå·¥ä½œåŒºå†…çš„ä¾èµ–å…³ç³»å¯ä»¥é“¾æ¥åœ¨ä¸€èµ·ï¼Œè¿™æ„å‘³ç€å·¥ä½œåŒºå¯ä»¥ç›¸äº’ä¾èµ–ï¼ŒåŒæ—¶å§‹ç»ˆä½¿ç”¨æœ€æ–°çš„å¯ç”¨ä»£ç ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹äº yarn link æ›´å¥½çš„æœºåˆ¶ï¼Œå› ä¸ºå®ƒåªå½±å“ä½ çš„å·¥ä½œç©ºé—´æ ‘ï¼Œè€Œä¸æ˜¯æ•´ä¸ªç³»ç»Ÿã€‚\nAll your project dependencies will be installed together, giving Yarn more latitude to better optimize them.\næ‰€æœ‰çš„é¡¹ç›®ä¾èµ–å…³ç³»éƒ½å°†è¢«å®‰è£…åœ¨ä¸€èµ·ï¼Œä¸º Yarn æä¾›æ›´å¤šçš„è‡ªç”±åº¦æ¥æ›´å¥½åœ°ä¼˜åŒ–å®ƒä»¬ã€‚\nYarn will use a single lockfile rather than a different one for each project, which means fewer conflicts and easier reviews.\nå¯¹äºæ¯ä¸ªé¡¹ç›®ï¼ŒYarn å°†ä½¿ç”¨ä¸€ä¸ªå…¬å…±çš„çš„é”æ–‡ä»¶è€Œä¸æ˜¯ä¸ºæ¯ä¸ªå·¥ç¨‹ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„é”æ–‡ä»¶ï¼Œè¿™æ„å‘³ç€æ›´å°‘çš„å†²çªå’Œæ›´å®¹æ˜“çš„ç‰ˆæœ¬å®¡æŸ¥ã€‚\nå¦‚ä½•å¯ç”¨ Workspace\n\n\n\n\n\n\n\n\n\nç¡®ä¿é¡¹ç›®ä¸­å®‰è£…æœ‰ yarn\nåœ¨é¡¹ç›®æ ¹ç›®å½•çš„ packag.json ä¸­å¢åŠ å¦‚ä¸‹é…ç½®:\n\n&#123;\n  \"private\": true,\n  \"workspaces\": [\"packages/*\"]\n&#125;\nmonorepo æ–¹æ¡ˆå®è·µé”å®šç¯å¢ƒï¼šVoltaVolta æ˜¯ä¸€ä¸ª JavaScript å·¥å…·ç®¡ç†å™¨ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬è½»æ¾åœ°åœ¨é¡¹ç›®ä¸­é”å®š nodeï¼Œnpm å’Œ yarn çš„ç‰ˆæœ¬ã€‚ä½ åªéœ€åœ¨å®‰è£…å®Œ Volta åï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ‰§è¡Œ volta pin å‘½ä»¤ï¼Œé‚£ä¹ˆæ— è®ºæ‚¨å½“å‰ä½¿ç”¨çš„ node æˆ– npmï¼ˆyarnï¼‰ç‰ˆæœ¬æ˜¯ä»€ä¹ˆï¼Œvolta éƒ½ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºæ‚¨æŒ‡å®šçš„ç‰ˆæœ¬ã€‚\nç›¸è¾ƒäº nvmï¼ŒVolta è¿˜å…·æœ‰ä¸€ä¸ªè¯±äººçš„ç‰¹æ€§ï¼šå½“æ‚¨é¡¹ç›®çš„ CLI å·¥å…·ä¸å…¨å±€ CLI å·¥å…·ä¸ä¸€è‡´æ—¶ï¼ŒVolta å¯ä»¥åšåˆ°åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è‡ªåŠ¨è¯†åˆ«ï¼Œåˆ‡æ¢åˆ°é¡¹ç›®æŒ‡å®šçš„ç‰ˆæœ¬\nå¤ç”¨ packagesï¼šworkspaceä½¿ç”¨ monorepo ç­–ç•¥åï¼Œæ”¶ç›Šæœ€å¤§çš„ä¸¤ç‚¹æ˜¯ï¼š\né¿å…é‡å¤å®‰è£…åŒ…ï¼Œå› æ­¤å‡å°‘äº†ç£ç›˜ç©ºé—´çš„å ç”¨ï¼Œå¹¶é™ä½äº†æ„å»ºæ—¶é—´ï¼›å†…éƒ¨ä»£ç å¯ä»¥å½¼æ­¤ç›¸äº’å¼•ç”¨ï¼›è¿™ä¸¤é¡¹å¥½å¤„å…¨éƒ¨éƒ½å¯ä»¥ç”±ä¸€ä¸ªæˆç†Ÿçš„åŒ…ç®¡ç†å·¥å…·æ¥å®Œæˆï¼Œå¯¹å‰ç«¯å¼€å‘è€Œè¨€ï¼Œå³æ˜¯ yarnï¼ˆ1.0 ä»¥ä¸Šï¼‰æˆ– npmï¼ˆ7.0 ä»¥ä¸Šï¼‰é€šè¿‡åä¸º workspaces çš„ç‰¹æ€§å®ç°çš„ï¼ˆâš ï¸ æ³¨æ„ï¼Œæ”¯æŒ workspaces ç‰¹æ€§çš„ npm ç›®å‰ä¾æ—§ä¸æ˜¯ LTS ç‰ˆæœ¬ï¼‰ã€‚\nä¸ºäº†å®ç°å‰é¢æåˆ°çš„ä¸¤ç‚¹æ”¶ç›Šï¼Œæ‚¨éœ€è¦åœ¨ä»£ç ä¸­åšä¸‰ä»¶äº‹ï¼š\n\nè°ƒæ•´ç›®å½•ç»“æ„ï¼Œå°†ç›¸äº’å…³è”çš„é¡¹ç›®æ”¾ç½®åœ¨åŒä¸€ä¸ªç›®å½•ï¼Œæ¨èå‘½åä¸º packagesï¼›\nåœ¨é¡¹ç›®æ ¹ç›®å½•é‡Œçš„ package.json æ–‡ä»¶ä¸­ï¼Œè®¾ç½® workspaces å±æ€§ï¼Œå±æ€§å€¼ä¸ºä¹‹å‰åˆ›å»ºçš„ç›®å½•ï¼›\nåŒæ ·ï¼Œåœ¨ package.json æ–‡ä»¶ä¸­ï¼Œè®¾ç½® private å±æ€§ä¸º trueï¼ˆä¸ºäº†é¿å…æˆ‘ä»¬è¯¯æ“ä½œå°†ä»“åº“å‘å¸ƒï¼‰ï¼›\n\nç»è¿‡ä¿®æ”¹ï¼Œæ‚¨çš„é¡¹ç›®ç›®å½•çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·ï¼š\n.\nâ”œâ”€â”€ package.json\nâ””â”€â”€ packages/\n    â”œâ”€â”€ @mono/project_1/ # æ¨èä½¿ç”¨ `@&lt;é¡¹ç›®å>/&lt;å­é¡¹ç›®å>` çš„æ–¹å¼å‘½å\n    â”‚   â”œâ”€â”€ index.js\n    â”‚   â””â”€â”€ package.json\n    â””â”€â”€ @mono/project_2/\n        â”œâ”€â”€ index.js\n        â””â”€â”€ package.json\n\n\nè€Œå½“æ‚¨åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ‰§è¡Œ npm install æˆ– yarn install åï¼Œæ‚¨ä¼šå‘ç°åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­å‡ºç°äº† node_modules ç›®å½•ï¼Œå¹¶ä¸”è¯¥ç›®å½•ä¸ä»…æ‹¥æœ‰æ‰€æœ‰å­é¡¹ç›®å…±ç”¨çš„ npm åŒ…ï¼Œè¿˜åŒ…å«äº†æˆ‘ä»¬çš„å­é¡¹ç›®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å­é¡¹ç›®ä¸­é€šè¿‡å„ç§æ¨¡å—å¼•å…¥æœºåˆ¶ï¼Œåƒå¼•å…¥ä¸€èˆ¬çš„ npm æ¨¡å—ä¸€æ ·å¼•å…¥å…¶ä»–å­é¡¹ç›®çš„ä»£ç ã€‚è¯·æ³¨æ„æˆ‘ä»¬å¯¹å­é¡¹ç›®çš„å‘½åï¼Œç»Ÿä¸€ä»¥ @&#x2F; å¼€å¤´ï¼Œè¿™æ˜¯ä¸€ç§ç¤¾åŒºæœ€ä½³å®è·µï¼Œä¸ä»…å¯ä»¥è®©ç”¨æˆ·æ›´å®¹æ˜“äº†è§£æ•´ä¸ªåº”ç”¨çš„æ¶æ„ï¼Œä¹Ÿæ–¹ä¾¿æ‚¨åœ¨é¡¹ç›®ä¸­æ›´å¿«æ·çš„æ‰¾åˆ°æ‰€éœ€çš„å­é¡¹ç›®ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº† monorepo ç­–ç•¥çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®åœ¨æ˜¯å¾ˆå®¹æ˜“ä¸æ˜¯å—ï¼Ÿä½†æ˜¯è€è¯è¯´ã€Œè¡Œç™¾é‡Œè€…åŠä¹åã€ï¼Œè·ç¦»ä¼˜é›…çš„æ­å»ºä¸€ä¸ª monorepo é¡¹ç›®ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€äº›è·¯è¦èµ°ã€‚\nç»Ÿä¸€é…ç½®ï¼šåˆå¹¶åŒç±»é¡¹ - Eslintï¼ŒTypescript ä¸ BabelTypeScriptæˆ‘ä»¬å¯ä»¥åœ¨ packages ç›®å½•ä¸­æ”¾ç½® tsconfig.settting.json æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­å®šä¹‰é€šç”¨çš„ ts é…ç½®ï¼Œç„¶åï¼Œåœ¨æ¯ä¸ªå­é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ extends å±æ€§ï¼Œå¼•å…¥é€šç”¨é…ç½®ï¼Œå¹¶è®¾ç½® compilerOptions.composite çš„å€¼ä¸º trueï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œå­é¡¹ç›®ä¸­çš„ tsconfig æ–‡ä»¶åº”è¯¥ä»…åŒ…å«ä¸‹è¿°å†…å®¹ï¼š\n&#123;\n  \"extends\": \"../tsconfig.setting.json\", // ç»§æ‰¿ packages ç›®å½•ä¸‹é€šç”¨é…ç½®\n  \"compilerOptions\": &#123;\n    \"composite\": true, // ç”¨äºå¸®åŠ© TypeScript å¿«é€Ÿç¡®å®šå¼•ç”¨å·¥ç¨‹çš„è¾“å‡ºæ–‡ä»¶ä½ç½®\n    \"outDir\": \"dist\",\n    \"rootDir\": \"src\"\n  &#125;,\n  \"include\": [\"src\"]\n&#125;\n\n\nEslintå¯¹äº Eslint é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¦‚æ³•ç‚®åˆ¶ï¼Œè¿™æ ·å®šä¹‰å­é¡¹ç›®çš„ .eslintrc æ–‡ä»¶å†…å®¹ï¼š\n&#123;\n  \"extends\": \"../../.eslintrc\", // æ³¨æ„è¿™é‡Œçš„ä¸åŒ\n  \"parserOptions\": &#123;\n    \"project\": \"tsconfig.json\"\n  &#125;\n&#125;\n\nBabelBabel é…ç½®æ–‡ä»¶åˆå¹¶çš„æ–¹å¼ä¸ TypeScript å¦‚å‡ºä¸€è¾™ï¼Œç”šè‡³æ›´åŠ ç®€å•ï¼Œæˆ‘ä»¬åªéœ€åœ¨å­é¡¹ç›®ä¸­çš„ .babelrc æ–‡ä»¶ä¸­è¿™æ ·å£°æ˜å³å¯ï¼š\n&#123;\n  \"extends\": \"../.babelrc\"\n&#125;\n\nå½“ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç›®å½•åº”è¯¥å¤§è‡´å‘ˆå¦‚ä¸‹æ‰€ç¤ºçš„ç»“æ„ï¼š\n.\nâ”œâ”€â”€ package.json\nâ”œâ”€â”€ .eslintrc\nâ””â”€â”€ packages/\n    â”‚   â”œâ”€â”€ tsconfig.settings.json\n    â”‚   â”œâ”€â”€ .babelrc\n    â”œâ”€â”€ @mono/project_1/\n    â”‚   â”œâ”€â”€ index.js\n    â”‚   â”œâ”€â”€ .eslintrc\n    â”‚   â”œâ”€â”€ .babelrc\n    â”‚   â”œâ”€â”€ tsconfig.json\n    â”‚   â””â”€â”€ package.json\n    â””â”€â”€â”€@mono/project_2/\n        â”œâ”€â”€ index.js\n        â”œâ”€â”€ .eslintrc\n        â”œâ”€â”€ .babelrc\n        â”œâ”€â”€ tsconfig.json\n        â””â”€â”€ package.json\n\n\nç»Ÿä¸€å‘½ä»¤è„šæœ¬ï¼šscriptyå¦‚æœæ‚¨çš„å­é¡¹ç›®è¶³å¤Ÿå¤šï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ï¼Œæ¯ä¸ª package.json æ–‡ä»¶ä¸­çš„ scripts å±æ€§éƒ½å¤§åŒå°å¼‚ï¼Œå¹¶ä¸”ä¸€äº› scripts å……æ–¥ç€å„ç§ Linux è¯­æ³•ï¼Œä¾‹å¦‚ç®¡é“æ“ä½œç¬¦ï¼Œé‡å®šå‘æˆ–ç›®å½•ç”Ÿæˆã€‚é‡å¤å¸¦æ¥ä½æ•ˆï¼Œå¤æ‚åˆ™ä½¿äººéš¾ä»¥ç†è§£ï¼Œè¿™éƒ½æ˜¯éœ€è¦æˆ‘ä»¬è§£å†³çš„é—®é¢˜ã€‚\nè¿™é‡Œç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä½¿ç”¨ scripty ç®¡ç†æ‚¨çš„è„šæœ¬å‘½ä»¤ï¼Œç®€å•æ¥è¯´ï¼Œscripty å…è®¸æ‚¨å°†è„šæœ¬å‘½ä»¤å®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨ package.json æ–‡ä»¶ä¸­ç›´æ¥é€šè¿‡æ–‡ä»¶åæ¥å¼•ç”¨ã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥å®ç°å¦‚ä¸‹ç›®çš„ï¼š\nå­é¡¹ç›®é—´å¤ç”¨è„šæœ¬å‘½ä»¤ï¼›åƒå†™ä»£ç ä¸€æ ·ç¼–å†™è„šæœ¬å‘½ä»¤ï¼Œæ— è®ºå®ƒæœ‰å¤šå¤æ‚ï¼Œè€Œåœ¨è°ƒç”¨æ—¶ï¼Œåƒè°ƒç”¨å‡½æ•°ä¸€æ ·è°ƒç”¨ï¼›\né€šè¿‡ä½¿ç”¨ scripty ç®¡ç†æˆ‘ä»¬çš„ monorepo åº”ç”¨ï¼Œç›®å½•ç»“æ„çœ‹èµ·æ¥å°†ä¼šæ˜¯è¿™æ ·ï¼š\n.\nâ”œâ”€â”€ package.json\nâ”œâ”€â”€ .eslintrc\nâ”œâ”€â”€ scirpts/ # è¿™é‡Œå­˜æ”¾æ‰€æœ‰çš„è„šæœ¬\nâ”‚   â”‚   â”œâ”€â”€ packages/ # åŒ…çº§åˆ«è„šæœ¬\nâ”‚   â”‚   â”‚   â”œâ”€â”€ build.sh\nâ”‚   â”‚   â”‚   â””â”€â”€ test.sh\nâ”‚   â””â”€â”€â”€â””â”€â”€ workspaces/ # å…¨å±€è„šæœ¬\nâ”‚           â”œâ”€â”€ build.sh\nâ”‚           â””â”€â”€ test.sh\nâ””â”€â”€ packages/\n    â”‚   â”œâ”€â”€ tsconfig.settings.json\n    â”‚   â”œâ”€â”€ .babelrc\n    â”œâ”€â”€ @mono/project_1/\n    â”‚   â”œâ”€â”€ index.js\n    â”‚   â”œâ”€â”€ .eslintrc\n    â”‚   â”œâ”€â”€ .babelrc\n    â”‚   â”œâ”€â”€ tsconfig.json\n    â”‚   â””â”€â”€ package.json\n    â””â”€â”€ @mono/project_2/\n        â”œâ”€â”€ index.js\n        â”œâ”€â”€ .eslintrc\n        â”œâ”€â”€ .babelrc\n        â”œâ”€â”€ tsconfig.json\n        â””â”€â”€ package.json\n\næ³¨æ„ï¼Œæˆ‘ä»¬è„šæœ¬åˆ†ä¸ºä¸¤ç±»ã€Œpackage çº§åˆ«ã€ä¸ã€Œworkspace çº§åˆ«ã€ï¼Œå¹¶ä¸”åˆ†åˆ«æ”¾åœ¨ä¸¤ä¸ªæ–‡ä»¶å¤¹å†…ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œæˆ‘ä»¬æ—¢å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œå…¨å±€è„šæœ¬ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹å•ä¸ªé¡¹ç›®æ‰§è¡Œç‰¹å®šçš„è„šæœ¬ã€‚\né€šè¿‡ä½¿ç”¨ scriptyï¼Œå­é¡¹ç›®çš„ package.json æ–‡ä»¶ä¸­çš„ scripts å±æ€§å°†å˜å¾—éå¸¸ç²¾ç®€ï¼š\n&#123;\n  ...\n  \"scripts\": &#123;\n    \"test\": \"scripty\",\n    \"lint\": \"scripty\",\n    \"build\": \"scripty\"\n  &#125;,\n  \"scripty\": &#123;\n    \"path\": \"../../scripts/packages\" // æ³¨æ„è¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº† scripty çš„è·¯å¾„\n  &#125;,\n  ...\n&#125;\n\nç»Ÿä¸€åŒ…ç®¡ç†ï¼šLerna\n\n\n\n\n\n\n\n\n\nå½“å¤šä¸ªå­é¡¹ç›®æ”¾åœ¨ä¸€ä¸ªä»£ç ä»“åº“ï¼Œå¹¶ä¸”å­é¡¹ç›®ä¹‹é—´åˆç›¸äº’ä¾èµ–æ—¶ï¼Œæˆ‘ä»¬é¢ä¸´çš„æ£˜æ‰‹é—®é¢˜æœ‰ä¸¤ä¸ªï¼š\n\nå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªå­ç›®å½•æ‰§è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è¿›å…¥å„ä¸ªç›®å½•ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤ï¼›\n\nå½“ä¸€ä¸ªå­é¡¹ç›®æ›´æ–°åï¼Œæˆ‘ä»¬åªèƒ½æ‰‹åŠ¨è¿½è¸ªä¾èµ–è¯¥é¡¹ç›®çš„å…¶ä»–å­é¡¹ç›®ï¼Œå¹¶å‡çº§å…¶ç‰ˆæœ¬ã€‚\n\n\né€šè¿‡ä½¿ç”¨ Lernaï¼Œè¿™äº›æ£˜æ‰‹çš„é—®é¢˜éƒ½å°†ä¸å¤å­˜åœ¨ã€‚å½“åœ¨é¡¹ç›®æ ¹ç›®å½•ä½¿ç”¨ npx lerna init åˆå§‹åŒ–åï¼Œæˆ‘ä»¬çš„æ ¹ç›®å½•ä¼šæ–°å¢ä¸€ä¸ª lerna.json æ–‡ä»¶ï¼Œé»˜è®¤å†…å®¹ä¸ºï¼š\n&#123;\n  \"packages\": [\"packages/*\"],\n  \"version\": \"0.0.0\"\n&#125;\n\nè®©æˆ‘ä»¬ç¨ç¨æ”¹åŠ¨è¿™ä¸ªæ–‡ä»¶ï¼Œä½¿å…¶å˜ä¸ºï¼š\n&#123;\n  \"packages\": [\"packages/*\"],\n  \"npmClient\": \"yarn\",\n  \"version\": \"independent\",\n  \"useWorkspaces\": true,\n&#125;\n\nå¯ä»¥æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬æ˜¾ç¤ºå£°æ˜äº†æˆ‘ä»¬çš„åŒ…å®¢æˆ·ç«¯ï¼ˆnpmClientï¼‰ä¸º yarnï¼Œå¹¶ä¸”è®© Lerna è¿½è¸ªæˆ‘ä»¬ workspaces è®¾ç½®çš„ç›®å½•ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¾æ—§ä¿ç•™äº†ä¹‹å‰ workspaces çš„æ‰€æœ‰ç‰¹æ€§ï¼ˆå­é¡¹ç›®å¼•ç”¨å’Œé€šç”¨åŒ…æå‡ï¼‰ã€‚\né™¤æ­¤ä¹‹å¤–ä¸€ä¸ªæœ‰è¶£çš„æ”¹åŠ¨åœ¨äºæˆ‘ä»¬å°† version å±æ€§æŒ‡å®šä¸ºä¸€ä¸ªå…³é”®å­— independentï¼Œè¿™å°†å‘Šè¯‰ lerna åº”è¯¥å°†æ¯ä¸ªå­é¡¹ç›®çš„ç‰ˆæœ¬å·çœ‹ä½œæ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚å½“æŸä¸ªå­é¡¹ç›®ä»£ç æ›´æ–°åï¼Œè¿è¡Œ lerna publish æ—¶ï¼ŒLerna å°†ç›‘å¬åˆ°ä»£ç å˜åŒ–çš„å­é¡¹ç›®å¹¶ä»¥äº¤äº’å¼ CLI æ–¹å¼è®©å¼€å‘è€…å†³å®šéœ€è¦å‡çº§çš„ç‰ˆæœ¬å·ï¼Œå…³è”çš„å­é¡¹ç›®ç‰ˆæœ¬å·ä¸ä¼šè‡ªåŠ¨å‡çº§ï¼Œåä¹‹ï¼Œå½“æˆ‘ä»¬å¡«å…¥å›ºå®šçš„ç‰ˆæœ¬å·æ—¶ï¼Œåˆ™ä»»ä¸€å­é¡¹ç›®çš„ä»£ç å˜åŠ¨ï¼Œéƒ½ä¼šå¯¼è‡´æ‰€æœ‰å­é¡¹ç›®çš„ç‰ˆæœ¬å·åŸºäºå½“å‰æŒ‡å®šçš„ç‰ˆæœ¬å·å‡çº§ã€‚\nLerna æä¾›äº†å¾ˆå¤š CLI å‘½ä»¤ä»¥æ»¡è¶³æˆ‘ä»¬çš„å„ç§éœ€æ±‚ï¼Œä½†æ ¹æ® 2&#x2F;8 æ³•åˆ™ï¼Œæ‚¨åº”è¯¥é¦–å…ˆå…³æ³¨ä»¥ä¸‹è¿™äº›å‘½ä»¤ï¼š\n\nlerna initï¼šå¸¸è§ä¸€ä¸ªæ–°çš„ lerna ä»“åº“ï¼ˆrepoï¼‰æˆ–å°†ç°æœ‰çš„ä»“åº“å‡çº§ä¸ºé€‚é…å½“å‰ ç‰ˆæœ¬çš„ Lernaã€‚å‚æ•° --independent/-i â€“ ä½¿ç”¨ç‹¬ç«‹çš„ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼\nlerna bootstrapï¼šç­‰åŒäº lerna link + yarn installï¼Œç”¨äºåˆ›å»ºç¬¦åˆé“¾æ¥å¹¶å®‰è£…ä¾èµ–åŒ…ï¼›\nlerna runï¼šä¼šåƒæ‰§è¡Œä¸€ä¸ª for å¾ªç¯ä¸€æ ·ï¼Œåœ¨æ‰€æœ‰å­é¡¹ç›®ä¸­æ‰§è¡Œ npm script è„šæœ¬ï¼Œå¹¶ä¸”ï¼Œå®ƒä¼šéå¸¸æ™ºèƒ½çš„è¯†åˆ«ä¾èµ–å…³ç³»ï¼Œå¹¶ä»æ ¹ä¾èµ–å¼€å§‹æ‰§è¡Œå‘½ä»¤ï¼›\nlerna execï¼šåƒ lerna run ä¸€æ ·ï¼Œä¼šæŒ‰ç…§ä¾èµ–é¡ºåºæ‰§è¡Œå‘½ä»¤ï¼Œä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œä¾‹å¦‚ shell è„šæœ¬ï¼›\nlerna publishï¼šå‘å¸ƒä»£ç æœ‰å˜åŠ¨çš„ packageï¼Œå› æ­¤é¦–å…ˆæ‚¨éœ€è¦åœ¨ä½¿ç”¨ Lerna å‰ä½¿ç”¨ git commit å‘½ä»¤æäº¤ä»£ç ï¼Œå¥½è®© Lerna æœ‰ä¸€ä¸ª baselineï¼›\nlerna addï¼šå°†æœ¬åœ°æˆ–è¿œç¨‹çš„åŒ…ä½œä¸ºä¾èµ–æ·»åŠ è‡³å½“å‰çš„ monorepo ä»“åº“ä¸­ï¼Œè¯¥å‘½ä»¤è®© Lerna å¯ä»¥è¯†åˆ«å¹¶è¿½è¸ªåŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå› æ­¤éå¸¸é‡è¦ï¼›\n\nå‚è€ƒAll in oneï¼šé¡¹ç›®çº§ monorepo ç­–ç•¥æœ€ä½³å®è·µMonorepo æœ€ä½³å®è·µä¹‹ Yarn Workspacesç°ä»£å‰ç«¯å·¥ç¨‹ä¸ºä»€ä¹ˆè¶Šæ¥è¶Šç¦»ä¸å¼€ Monorepo?lerna å¤šåŒ…ç®¡ç†å®è·µ\n","slug":"monorepo","date":"2022-02-09T23:18:46.000Z","categories_index":"","tags_index":"Monorepo","author_index":"Matrix"},{"id":"51e9acccf01c1d764ee3a75bbf79b49b","title":"HTTP2","content":"ç»´åŸºç™¾ç§‘å…³äº HTTP&#x2F;2 çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹ä¸‹å®šä¹‰å’Œå‘å±•å†å²:\nWiki\nRFC 7540 å®šä¹‰äº† HTTP&#x2F;2 çš„åè®®è§„èŒƒå’Œç»†èŠ‚ï¼Œæœ¬æ–‡çš„ç»†èŠ‚ä¸»è¦æ¥è‡ªæ­¤æ–‡æ¡£ï¼Œå»ºè®®å…ˆçœ‹ä¸€éæœ¬æ–‡ï¼Œå†å›è¿‡å¤´æ¥ç…§ç€åè®®å¤§è‡´è¿‡ä¸€é RFCï¼Œå¦‚æœæƒ³æ·±å…¥æŸäº›ç»†èŠ‚å†ä»”ç»†ç¿»çœ‹ RFC\nRFC7540\nWhy use it ?HTTP&#x2F;1.1 å­˜åœ¨çš„é—®é¢˜:\n\nTCP è¿æ¥æ•°é™åˆ¶å¯¹äºåŒä¸€ä¸ªåŸŸåï¼Œæµè§ˆå™¨æœ€å¤šåªèƒ½åŒæ—¶åˆ›å»º 6 - 8 ä¸ª TCP è¿æ¥ (ä¸åŒæµè§ˆå™¨ä¸ä¸€æ ·)ã€‚ä¸ºäº†è§£å†³æ•°é‡é™åˆ¶ï¼Œå‡ºç°äº† åŸŸååˆ†ç‰‡ æŠ€æœ¯ï¼Œå…¶å®å°±æ˜¯èµ„æºåˆ†åŸŸï¼Œå°†èµ„æºæ”¾åœ¨ä¸åŒåŸŸåä¸‹ (æ¯”å¦‚äºŒçº§å­åŸŸåä¸‹)ï¼Œè¿™æ ·å°±å¯ä»¥é’ˆå¯¹ä¸åŒåŸŸååˆ›å»ºè¿æ¥å¹¶è¯·æ±‚ï¼Œä»¥ä¸€ç§è®¨å·§çš„æ–¹å¼çªç ´é™åˆ¶ï¼Œä½†æ˜¯æ»¥ç”¨æ­¤æŠ€æœ¯ä¹Ÿä¼šé€ æˆå¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚æ¯ä¸ª TCP è¿æ¥æœ¬èº«éœ€è¦ç»è¿‡ DNS æŸ¥è¯¢ã€ä¸‰æ­¥æ¡æ‰‹ã€æ…¢å¯åŠ¨ç­‰ï¼Œè¿˜å ç”¨é¢å¤–çš„ CPU å’Œå†…å­˜ï¼Œå¯¹äºæœåŠ¡å™¨æ¥è¯´è¿‡å¤šè¿æ¥ä¹Ÿå®¹æ˜“é€ æˆç½‘ç»œæ‹¥æŒ¤ã€äº¤é€šé˜»å¡ç­‰ï¼Œå¯¹äºç§»åŠ¨ç«¯æ¥è¯´é—®é¢˜æ›´æ˜æ˜¾ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« : Why Domain Sharding is Bad News for Mobile Performance and Usersã€‚åœ¨å›¾ä¸­å¯ä»¥çœ‹åˆ°æ–°å»ºäº†å…­ä¸ª TCP è¿æ¥ï¼Œæ¯æ¬¡æ–°å»ºè¿æ¥ DNS è§£æéœ€è¦æ—¶é—´(å‡  ms åˆ°å‡ ç™¾ ms ä¸ç­‰)ã€TCP æ…¢å¯åŠ¨ä¹Ÿéœ€è¦æ—¶é—´ã€TLS æ¡æ‰‹åˆè¦æ—¶é—´ï¼Œè€Œä¸”åç»­è¯·æ±‚éƒ½è¦ç­‰å¾…é˜Ÿåˆ—è°ƒåº¦\nçº¿å¤´é˜»å¡ (Head Of Line Blocking) é—®é¢˜æ¯ä¸ª TCP è¿æ¥åŒæ—¶åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ - å“åº”ï¼Œæµè§ˆå™¨æŒ‰ FIFO åŸåˆ™å¤„ç†è¯·æ±‚ï¼Œå¦‚æœä¸Šä¸€ä¸ªå“åº”æ²¡è¿”å›ï¼Œåç»­è¯·æ±‚ - å“åº”éƒ½ä¼šå—é˜»ã€‚ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œå‡ºç°äº† ç®¡çº¿åŒ– - pipelining æŠ€æœ¯ï¼Œä½†æ˜¯ç®¡çº¿åŒ–å­˜åœ¨è¯¸å¤šé—®é¢˜ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªå“åº”æ…¢è¿˜æ˜¯ä¼šé˜»å¡åç»­å“åº”ã€æœåŠ¡å™¨ä¸ºäº†æŒ‰åºè¿”å›ç›¸åº”éœ€è¦ç¼“å­˜å¤šä¸ªå“åº”å ç”¨æ›´å¤šèµ„æºã€æµè§ˆå™¨ä¸­é€”æ–­è¿é‡è¯•æœåŠ¡å™¨å¯èƒ½å¾—é‡æ–°å¤„ç†å¤šä¸ªè¯·æ±‚ã€è¿˜æœ‰å¿…é¡»å®¢æˆ·ç«¯ - ä»£ç† - æœåŠ¡å™¨éƒ½æ”¯æŒç®¡çº¿åŒ–\nHeader å†…å®¹å¤šï¼Œè€Œä¸”æ¯æ¬¡è¯·æ±‚ Header ä¸ä¼šå˜åŒ–å¤ªå¤šï¼Œæ²¡æœ‰ç›¸åº”çš„å‹ç¼©ä¼ è¾“ä¼˜åŒ–æ–¹æ¡ˆ\nä¸ºäº†å°½å¯èƒ½å‡å°‘è¯·æ±‚æ•°ï¼Œéœ€è¦åšåˆå¹¶æ–‡ä»¶ã€é›ªç¢§å›¾ã€èµ„æºå†…è”ç­‰ä¼˜åŒ–å·¥ä½œï¼Œä½†æ˜¯è¿™æ— ç–‘é€ æˆäº†å•ä¸ªè¯·æ±‚å†…å®¹å˜å¤§å»¶è¿Ÿå˜é«˜çš„é—®é¢˜ï¼Œä¸”å†…åµŒçš„èµ„æºä¸èƒ½æœ‰æ•ˆåœ°ä½¿ç”¨ç¼“å­˜æœºåˆ¶\næ˜æ–‡ä¼ è¾“ä¸å®‰å…¨\n\nHTTP2 çš„ä¼˜åŠ¿äºŒè¿›åˆ¶åˆ†å¸§å±‚ (Binary Framing Layer)å¸§æ˜¯æ•°æ®ä¼ è¾“çš„æœ€å°å•ä½ï¼Œä»¥äºŒè¿›åˆ¶ä¼ è¾“ä»£æ›¿åŸæœ¬çš„æ˜æ–‡ä¼ è¾“ï¼ŒåŸæœ¬çš„æŠ¥æ–‡æ¶ˆæ¯è¢«åˆ’åˆ†ä¸ºæ›´å°çš„æ•°æ®å¸§:\n\nh1 å’Œ h2 çš„æŠ¥æ–‡å¯¹æ¯”:\n\nå›¾ä¸­ h2 çš„æŠ¥æ–‡æ˜¯é‡ç»„è§£æè¿‡åçš„ï¼Œå¯ä»¥å‘ç°ä¸€äº›å¤´å­—æ®µå‘ç”Ÿäº†å˜åŒ–ï¼Œè€Œä¸”æ‰€æœ‰å¤´å­—æ®µå‡å°å†™\nå¤šè·¯å¤ç”¨ (MultiPlexing)åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å‘å¯¹æ–¹ä¸æ–­å‘é€å¸§ï¼Œæ¯å¸§çš„ stream identifier çš„æ ‡æ˜è¿™ä¸€å¸§å±äºå“ªä¸ªæµï¼Œç„¶ååœ¨å¯¹æ–¹æ¥æ”¶æ—¶ï¼Œæ ¹æ® stream identifier æ‹¼æ¥æ¯ä¸ªæµçš„æ‰€æœ‰å¸§ç»„æˆä¸€æ•´å—æ•°æ®ã€‚æŠŠ HTTP&#x2F;1.1 æ¯ä¸ªè¯·æ±‚éƒ½å½“ä½œä¸€ä¸ªæµï¼Œé‚£ä¹ˆå¤šä¸ªè¯·æ±‚å˜æˆå¤šä¸ªæµï¼Œè¯·æ±‚å“åº”æ•°æ®åˆ†æˆå¤šä¸ªå¸§ï¼Œä¸åŒæµä¸­çš„å¸§äº¤é”™åœ°å‘é€ç»™å¯¹æ–¹ï¼Œè¿™å°±æ˜¯ HTTP&#x2F;2 ä¸­çš„å¤šè·¯å¤ç”¨ã€‚\næµçš„æ¦‚å¿µå®ç°äº†å•è¿æ¥ä¸Šå¤šè¯·æ±‚ - å“åº”å¹¶è¡Œï¼Œè§£å†³äº†çº¿å¤´é˜»å¡çš„é—®é¢˜ï¼Œå‡å°‘äº† TCP è¿æ¥æ•°é‡å’Œ TCP è¿æ¥æ…¢å¯åŠ¨é€ æˆçš„é—®é¢˜\næ‰€ä»¥ http2 å¯¹äºåŒä¸€åŸŸååªéœ€è¦åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œè€Œä¸æ˜¯åƒ http&#x2F;1.1 é‚£æ ·åˆ›å»º 6~8 ä¸ªè¿æ¥:\n\næœåŠ¡ç«¯æ¨é€ (Server Push)æµè§ˆå™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¸»åŠ¨å‘æµè§ˆå™¨æ¨é€ä¸è¿™ä¸ªè¯·æ±‚ç›¸å…³çš„èµ„æºï¼Œè¿™æ ·æµè§ˆå™¨å°±ä¸ç”¨å‘èµ·åç»­è¯·æ±‚ã€‚Server-Push ä¸»è¦æ˜¯é’ˆå¯¹èµ„æºå†…è”åšå‡ºçš„ä¼˜åŒ–ï¼Œç›¸è¾ƒäº http&#x2F;1.1 èµ„æºå†…è”çš„ä¼˜åŠ¿:\n\nå®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜æ¨é€çš„èµ„æº\nå®¢æˆ·ç«¯å¯ä»¥æ‹’æ”¶æ¨é€è¿‡æ¥çš„èµ„æº\næ¨é€èµ„æºå¯ä»¥ç”±ä¸åŒé¡µé¢å…±äº«\næœåŠ¡å™¨å¯ä»¥æŒ‰ç…§ä¼˜å…ˆçº§æ¨é€èµ„æº\n\nHeader å‹ç¼© (HPACK)ä½¿ç”¨ HPACK ç®—æ³•æ¥å‹ç¼©é¦–éƒ¨å†…å®¹ä¸Šå›¾æ¥è‡ª Ilya Grigorik çš„ PPT - HTTP&#x2F;2 is here, letâ€™s optimize!\nå¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ° HTTP2 å¤´éƒ¨ä½¿ç”¨çš„ä¹Ÿæ˜¯é”®å€¼å¯¹å½¢å¼çš„å€¼ï¼Œè€Œä¸” HTTP1 å½“ä¸­çš„è¯·æ±‚è¡Œä»¥åŠçŠ¶æ€è¡Œä¹Ÿè¢«åˆ†å‰²æˆé”®å€¼å¯¹ï¼Œè¿˜æœ‰æ‰€æœ‰é”®éƒ½æ˜¯å°å†™ï¼Œä¸åŒäº HTTP1ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªåŒ…å«é™æ€ç´¢å¼•è¡¨å’ŒåŠ¨æ€ç´¢å¼•è¡¨çš„ç´¢å¼•ç©ºé—´ï¼Œå®é™…ä¼ è¾“æ—¶ä¼šæŠŠå¤´éƒ¨é”®å€¼è¡¨å‹ç¼©ï¼Œä½¿ç”¨çš„ç®—æ³•å³ HPACKï¼Œå…¶åŸç†å°±æ˜¯åŒ¹é…å½“å‰è¿æ¥å­˜åœ¨çš„ç´¢å¼•ç©ºé—´ï¼Œè‹¥æŸä¸ªé”®å€¼å·²å­˜åœ¨ï¼Œåˆ™ç”¨ç›¸åº”çš„ç´¢å¼•ä»£æ›¿é¦–éƒ¨æ¡ç›®ï¼Œæ¯”å¦‚ â€œ:method: GETâ€ å¯ä»¥åŒ¹é…åˆ°é™æ€ç´¢å¼•ä¸­çš„ index 2ï¼Œä¼ è¾“æ—¶åªéœ€è¦ä¼ è¾“ä¸€ä¸ªåŒ…å« 2 çš„å­—èŠ‚å³å¯ï¼›è‹¥ç´¢å¼•ç©ºé—´ä¸­ä¸å­˜åœ¨ï¼Œåˆ™ç”¨å­—ç¬¦ç¼–ç ä¼ è¾“ï¼Œå­—ç¬¦ç¼–ç å¯ä»¥é€‰æ‹©å“ˆå¤«æ›¼ç¼–ç ï¼Œç„¶ååˆ†æƒ…å†µåˆ¤æ–­æ˜¯å¦éœ€è¦å­˜å…¥åŠ¨æ€ç´¢å¼•è¡¨ä¸­\n\né™æ€ç´¢å¼•é™æ€ç´¢å¼•è¡¨æ˜¯å›ºå®šçš„ï¼Œå¯¹äºå®¢æˆ·ç«¯æœåŠ¡ç«¯éƒ½ä¸€æ ·ï¼Œç›®å‰åè®®å•†å®šçš„é™æ€ç´¢å¼•åŒ…å« 61 ä¸ªé”®å€¼ï¼Œè¯¦è§ Static Table Definition - RFC 7541ï¼Œæ¯”å¦‚å‰å‡ ä¸ªå¦‚ä¸‹\n\n\nç´¢å¼•\nå­—æ®µå€¼\né”®å€¼\n\n\n\nindex\nHeader Name\nHeader Value\n\n\n1\n:authority\nå•å…ƒæ ¼\n\n\n2\n:method\nGET\n\n\n3\n:method\nPOST\n\n\n4\n:path\n&#x2F;\n\n\n5\n:path\n&#x2F;index.html\n\n\n6\n:scheme\nhttp\n\n\n7\n:scheme\nhttps\n\n\n8\n:status\n200\n\n\n\nåŠ¨æ€ç´¢å¼•åŠ¨æ€ç´¢å¼•è¡¨æ˜¯ä¸€ä¸ª FIFO é˜Ÿåˆ—ç»´æŠ¤çš„æœ‰ç©ºé—´é™åˆ¶çš„è¡¨ï¼Œé‡Œé¢å«æœ‰éé™æ€è¡¨çš„ç´¢å¼•ã€‚åŠ¨æ€ç´¢å¼•è¡¨æ˜¯éœ€è¦è¿æ¥åŒæ–¹ç»´æŠ¤çš„ï¼Œå…¶å†…å®¹åŸºäºè¿æ¥ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ª HTTP2 è¿æ¥æœ‰ä¸”ä»…æœ‰ä¸€ä»½åŠ¨æ€è¡¨ã€‚å½“ä¸€ä¸ªé¦–éƒ¨åŒ¹é…ä¸åˆ°ç´¢å¼•æ—¶ï¼Œå¯ä»¥é€‰æ‹©æŠŠå®ƒæ’å…¥åŠ¨æ€ç´¢å¼•è¡¨ä¸­ï¼Œä¸‹æ¬¡åŒåçš„å€¼å°±å¯èƒ½ä¼šåœ¨è¡¨ä¸­æŸ¥åˆ°ç´¢å¼•å¹¶æ›¿æ¢ã€‚ä½†æ˜¯å¹¶éæ‰€æœ‰é¦–éƒ¨é”®å€¼éƒ½ä¼šå­˜å…¥åŠ¨æ€ç´¢å¼•ï¼Œå› ä¸ºåŠ¨æ€ç´¢å¼•è¡¨æ˜¯æœ‰ç©ºé—´é™åˆ¶çš„ï¼Œæœ€å¤§å€¼ç”± SETTING å¸§ä¸­çš„ SETTINGS_HEADER_TABLE_SIZE (é»˜è®¤ 4096 å­—èŠ‚) è®¾ç½®\n\nåº”ç”¨å±‚çš„é‡ç½®è¿æ¥å¯¹äº HTTP&#x2F;1 æ¥è¯´ï¼Œæ˜¯é€šè¿‡è®¾ç½® tcp segment é‡Œçš„ reset flag æ¥é€šçŸ¥å¯¹ç«¯å…³é—­è¿æ¥çš„ã€‚è¿™ç§æ–¹å¼ä¼šç›´æ¥æ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡å†å‘è¯·æ±‚å°±å¿…é¡»é‡æ–°å»ºç«‹è¿æ¥ã€‚HTTP&#x2F;2 å¼•å…¥ RST_STREAM ç±»å‹çš„ frameï¼Œå¯ä»¥åœ¨ä¸æ–­å¼€è¿æ¥çš„å‰æä¸‹å–æ¶ˆæŸä¸ª request çš„ streamï¼Œè¡¨ç°æ›´å¥½ã€‚\nè¯·æ±‚ä¼˜å…ˆçº§è®¾ç½®HTTP&#x2F;2 é‡Œçš„æ¯ä¸ª stream éƒ½å¯ä»¥è®¾ç½®ä¾èµ– (Dependency) å’Œæƒé‡ï¼Œå¯ä»¥æŒ‰ä¾èµ–æ ‘åˆ†é…ä¼˜å…ˆçº§ï¼Œè§£å†³äº†å…³é”®è¯·æ±‚è¢«é˜»å¡çš„é—®é¢˜\nHTTP&#x2F;1 çš„å‡ ç§ä¼˜åŒ–å¯ä»¥å¼ƒç”¨åˆå¹¶æ–‡ä»¶ã€å†…è”èµ„æºã€é›ªç¢§å›¾ã€åŸŸååˆ†ç‰‡å¯¹äº HTTP&#x2F;2 æ¥è¯´æ˜¯ä¸å¿…è¦çš„ï¼Œä½¿ç”¨ h2 å°½å¯èƒ½å°†èµ„æºç»†ç²’åŒ–ï¼Œæ–‡ä»¶åˆ†è§£åœ°å°½å¯èƒ½æ•£ï¼Œä¸ç”¨æ‹…å¿ƒè¯·æ±‚æ•°å¤š\nå‚è€ƒHTTP2 è¯¦è§£HTTP1.0ã€HTTP1.1 å’Œ HTTP2.0 çš„åŒºåˆ«\n","slug":"http2","date":"2022-02-08T22:19:20.000Z","categories_index":"","tags_index":"Network","author_index":"Matrix"},{"id":"acb839066d366821abd556a15e4a7b04","title":"CDN","content":"ä»€ä¹ˆæ˜¯ CDNï¼ŸCDN çš„å…¨ç§°æ˜¯ Content Delivery Networkï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œã€‚æ˜¯æŒ‡ä¸€ç§é€šè¿‡äº’è”ç½‘äº’ç›¸è¿æ¥çš„ç”µè„‘ç½‘ç»œç³»ç»Ÿï¼Œåˆ©ç”¨æœ€é è¿‘æ¯ä½ç”¨æˆ·çš„æœåŠ¡å™¨ï¼Œæ›´å¿«ã€æ›´å¯é åœ°å°†éŸ³ä¹ã€å›¾ç‰‡ã€è§†é¢‘ã€åº”ç”¨ç¨‹åºåŠå…¶ä»–æ–‡ä»¶å‘é€ç»™ç”¨æˆ·ï¼Œæ¥æä¾›é«˜æ€§èƒ½ã€å¯æ‰©å±•æ€§åŠä½æˆæœ¬çš„ç½‘ç»œå†…å®¹ä¼ é€’ç»™ç”¨æˆ·ã€‚\nç°å®ä¸­æˆ‘ä»¬éƒ½ç”¨è¿‡å¤©çŒ«è¶…å¸‚ï¼Œåœ¨ä¸Šé¢ä¹°ä¸œè¥¿éå¸¸æ–¹ä¾¿ã€‚å¤©çŒ«è¶…å¸‚çš„æ¨¡å¼æ˜¯è´§å“å…ˆå…¥å¤©çŒ«è¶…å¸‚ï¼ˆåæ–‡ç®€ç§°ä¸ºâ€çŒ«è¶…â€ï¼‰çš„èœé¸Ÿä»“ï¼Œç„¶åç”±çŒ«è¶…ç»Ÿä¸€æ´¾é€çš„ã€‚\n\nCDN çš„åŸºæœ¬å·¥ä½œè¿‡ç¨‹ä¸€å›¾ç§’æ‡‚ CDN åŸç†ï¼ˆä»¥è®¿é—®ç½‘ç«™æŸç½‘é¡µèµ„æºè¯·æ±‚ä¸ºä¾‹ï¼‰\nå¼•å…¥ CDN ä¹‹å‰\nç”¨æˆ·åœ¨è‡ªå·±çš„æµè§ˆå™¨ä¸­è¾“å…¥è¦è®¿é—®çš„ç½‘ç«™åŸŸå\næµè§ˆå™¨å‘æœ¬åœ° DNS æœåŠ¡å™¨è¯·æ±‚å¯¹è¯¥åŸŸåçš„è§£æ\næœ¬åœ° DNS æœåŠ¡å™¨ä¸­å¦‚æœç¼“å­˜æœ‰è¿™ä¸ªåŸŸåçš„è§£æç»“æœï¼Œåˆ™ç›´æ¥å“åº”ç”¨æˆ·çš„è§£æè¯·æ±‚\næœ¬åœ° DNS æœåŠ¡å™¨ä¸­å¦‚æœæ²¡æœ‰å…³äºè¿™ä¸ªåŸŸåçš„è§£æç»“æœçš„ç¼“å­˜ï¼Œåˆ™ä»¥è¿­ä»£æ–¹å¼å‘æ•´ä¸ª DNS ç³»ç»Ÿè¯·æ±‚è§£æï¼Œè·å¾—åº”ç­”åå°†ç»“æœåé¦ˆç»™æµè§ˆå™¨\næµè§ˆå™¨å¾—åˆ°åŸŸåè§£æç»“æœï¼Œå°±æ˜¯è¯¥åŸŸåç›¸åº”çš„æœåŠ¡è®¾å¤‡çš„ IP åœ°å€\næµè§ˆå™¨è·å– IP åœ°å€ä¹‹åï¼Œç»è¿‡æ ‡å‡†çš„ TCP æ¡æ‰‹æµç¨‹ï¼Œå»ºç«‹ TCP è¿æ¥\næµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ· HTTP è¯·æ±‚\næœåŠ¡å™¨å°†ç”¨æˆ·è¯·æ±‚å†…å®¹ä¼ é€ç»™æµè§ˆå™¨\nç»è¿‡æ ‡å‡†çš„ TCP æŒ¥æ‰‹æµç¨‹ï¼Œæ–­å¼€ TCP è¿æ¥\n\nå¼•å…¥ CDN ä¹‹å\nå½“ç”¨æˆ·ç‚¹å‡»ç½‘ç«™é¡µé¢ä¸Šçš„å†…å®¹ URLï¼Œå…ˆç»è¿‡æœ¬åœ° DNS ç³»ç»Ÿè§£æï¼Œå¦‚æœæœ¬åœ° DNS æœåŠ¡å™¨æ²¡æœ‰ç›¸åº”åŸŸåçš„ç¼“å­˜ï¼Œåˆ™æœ¬åœ° DNS ç³»ç»Ÿä¼šå°†åŸŸåçš„è§£ææƒäº¤ç»™ CNAME æŒ‡å‘çš„ CDN ä¸“ç”¨ DNS æœåŠ¡å™¨\nCDN çš„ DNS æœåŠ¡å™¨å°† CDN çš„å…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡ IP åœ°å€è¿”å›ç»™ç”¨æˆ·\nç”¨æˆ·å‘ CDN çš„å…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡å‘èµ· URL è®¿é—®è¯·æ±‚\nCDN å…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡æ ¹æ®ç”¨æˆ· IP åœ°å€ï¼Œä»¥åŠç”¨æˆ·è¯·æ±‚çš„ URLï¼Œé€‰æ‹©ä¸€å°ç”¨æˆ·æ‰€å±åŒºåŸŸçš„åŒºåŸŸè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°æ­¤è®¾å¤‡ä¸Š\nåŸºäºä»¥ä¸‹è¿™äº›æ¡ä»¶çš„ç»¼åˆåˆ†æä¹‹åï¼ŒåŒºåŸŸè´Ÿè½½å‡è¡¡è®¾å¤‡ä¼šé€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå¹¶ä»ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹å¤„å¾—åˆ°ç¼“å­˜æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œæœ€ç»ˆå°†å¾—åˆ°çš„ IP åœ°å€è¿”å›ç»™å…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡\næ ¹æ®ç”¨æˆ· IP åœ°å€ï¼Œåˆ¤æ–­å“ªä¸€ä¸ªè¾¹ç¼˜èŠ‚ç‚¹è·ç”¨æˆ·æœ€è¿‘\næ ¹æ®ç”¨æˆ·æ‰€è¯·æ±‚çš„ URL ä¸­æºå¸¦çš„å†…å®¹åç§°ï¼Œåˆ¤æ–­å“ªä¸€ä¸ªè¾¹ç¼˜èŠ‚ç‚¹ä¸Šæœ‰ç”¨æˆ·æ‰€éœ€å†…å®¹\næŸ¥è¯¢å„ä¸ªè¾¹ç¼˜èŠ‚ç‚¹å½“å‰çš„è´Ÿè½½æƒ…å†µï¼Œåˆ¤æ–­å“ªä¸€ä¸ªè¾¹ç¼˜èŠ‚ç‚¹å°šæœ‰æœåŠ¡èƒ½åŠ›\n\n\nå…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡æŠŠæœåŠ¡å™¨çš„ IP åœ°å€è¿”å›ç»™ç”¨æˆ·\nç”¨æˆ·å‘ç¼“å­˜æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç¼“å­˜æœåŠ¡å™¨å“åº”ç”¨æˆ·è¯·æ±‚ï¼Œå°†ç”¨æˆ·æ‰€éœ€å†…å®¹ä¼ é€åˆ°ç”¨æˆ·ç»ˆç«¯ã€‚å¦‚æœè¿™å°ç¼“å­˜æœåŠ¡å™¨ä¸Šå¹¶æ²¡æœ‰ç”¨æˆ·æƒ³è¦çš„å†…å®¹ï¼Œè€ŒåŒºåŸŸå‡è¡¡è®¾å¤‡ä¾ç„¶å°†å®ƒåˆ†é…ç»™äº†ç”¨æˆ·ï¼Œé‚£ä¹ˆè¿™å°æœåŠ¡å™¨å°±è¦å‘å®ƒçš„ä¸Šä¸€çº§ç¼“å­˜æœåŠ¡å™¨è¯·æ±‚å†…å®¹ï¼Œç›´è‡³è¿½æº¯åˆ°ç½‘ç«™çš„æºæœåŠ¡å™¨å°†å†…å®¹æ‹‰åˆ°æœ¬åœ°\n\nCNAME è®°å½•æ˜¯ä»€ä¹ˆï¼Ÿä»–å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿè®°å½•å°±æ˜¯æŠŠä¸€ä¸ªåŸŸåè§£æåˆ°ä¸€ä¸ª IP åœ°å€ï¼ˆAddressï¼Œç‰¹åˆ¶æ•°å­— IP åœ°å€ï¼‰ï¼Œè€Œ CNAME è®°å½•å°±æ˜¯æŠŠåŸŸåè§£æåˆ°å¦å¤–ä¸€ä¸ªåŸŸåã€‚å…¶åŠŸèƒ½æ˜¯å·®ä¸å¤šï¼ŒCNAME å°†å‡ ä¸ªä¸»æœºåæŒ‡å‘ä¸€ä¸ªåˆ«åï¼Œå…¶å®è·ŸæŒ‡å‘ IP åœ°å€æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºè¿™ä¸ªåˆ«åä¹Ÿè¦åšä¸€ä¸ª A è®°å½•çš„ã€‚ä½†æ˜¯ä½¿ç”¨ CNAME è®°å½•å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å˜æ›´ IP åœ°å€ã€‚å¦‚æœä¸€å°æœåŠ¡å™¨æœ‰ 100 ä¸ªç½‘ç«™ï¼Œä»–ä»¬éƒ½åšäº†åˆ«åï¼Œè¯¥å°æœåŠ¡å™¨å˜æ›´ IP æ—¶ï¼Œåªéœ€è¦å˜æ›´åˆ«åçš„ A è®°å½•å°±å¯ä»¥äº†ã€‚\nå¦‚æœæœåŠ¡å•†ç»™ä½ ä¸€ä¸ª ipï¼Œå‡å¦‚å“ªå¤©æœåŠ¡å•†æƒ³æŠŠ ip åœ°å€æ¢ä¸€ä¸ªï¼Œå¾ˆå¤šäººåŸŸåä¸Šå¯¹åº”çš„ ip åœ°å€å°±è¦è·Ÿç€å˜åŒ–ï¼Œè¦è®©æ‰€æœ‰äººéƒ½ä¸€èµ·æ”¹å®Œï¼Œå®Œå…¨æ²¡æœ‰åŠæ³•åšåˆ°çš„äº‹æƒ…ï¼Œæ¢æˆ cname å°±æ²¡äº‹äº†ï¼Œä½ ç”¨ä½ çš„ cdnï¼Œä»–æ”¹ä»–çš„ ip åœ°å€ã€‚å”¯ä¸€çš„åå¤„å°±æ˜¯ï¼Œç¬¬ä¸€æ¬¡ DNS è§£æåŸŸåçš„æ—¶å€™ä¼šå¤šè§£æä¸€æ¬¡ã€‚æ€»ç»“æ¥çœ‹ï¼Œå¥½å¤„è¿œå¤§äºåå¤„ã€‚\nä»€ä¹ˆæ˜¯ CNAME è®°å½•ï¼ŸCName è®°å½•æ˜¯ Canonical Name çš„ç®€ç§°ï¼Œé€šå¸¸ç§°åˆ«åæŒ‡å‘ï¼ŒCNAME è®°å½•å¯ç”¨äºå°†ä¸€ä¸ªåŸŸååˆ«åä¸ºå¦ä¸€ä¸ªè§„èŒƒåç§°çš„åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰èµ„æºè®°å½•ã€‚ã€€ã€€ç½‘ç«™æ˜¯ç”±ä¸€ç»„ç”±ä¸€ç»„å”¯ä¸€æ ‡è¯†çš„ä½ç½®ï¼ˆç§°ä¸º IP åœ°å€ï¼‰æä¾›æœåŠ¡çš„ï¼›ä½†æ˜¯è¦è®¿é—®è¿™äº›ç«™ç‚¹ï¼ˆä¾‹å¦‚ï¼šæ™“å¾—åšå®¢ï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé”®å…¥å®ƒä»¬å¯¹åº”çš„åŸŸåï¼Œè¿™äº›åŸŸåæ›´å®¹æ˜“è®°ä½ã€‚è¦æ‰¾åˆ°æ­£ç¡®çš„ IP åœ°å€ï¼Œæ‚¨çš„æµè§ˆå™¨å°†è”ç³»åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰ï¼Œå¹¶åœ¨å…¶æ•°æ®åº“ä¸­æŸ¥è¯¢ IP åœ°å€ã€‚\nCNAME è®°å½•å¦‚ä½•ä½¿ç”¨ï¼Ÿä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰å‡ ä¸ªå­åŸŸï¼Œä¾‹å¦‚http://www.mydomain.comï¼Œhttp://ftp.mydomain.comï¼Œhttp://mail.mydomain.comç­‰ï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›è¿™äº›å­åŸŸæŒ‡å‘æ‚¨çš„ä¸»åŸŸåhttp://mydomain.comã€‚æ‚¨å¯ä»¥åˆ›å»ºCNAMEè®°å½•ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªå­åŸŸåˆ›å»ºAè®°å½•å¹¶å°†å…¶ç»‘å®šåˆ°æ‚¨åŸŸçš„IPåœ°å€ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œå¦‚æœæœåŠ¡å™¨çš„ IP åœ°å€å‘ç”Ÿæ›´æ”¹ï¼Œåˆ™åªéœ€æ›´æ–°ä¸€ä¸ª A è®°å½•ï¼Œå¹¶ä¸”æ‰€æœ‰å­åŸŸéƒ½ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œå› ä¸ºæ‰€æœ‰ CNAMES éƒ½æŒ‡å‘å¸¦æœ‰ A è®°å½•çš„ä¸»åŸŸï¼šhttp://mydomain.comæŒ‡å‘æœåŠ¡å™¨IPåœ°å€ï¼Œå¹¶é€šè¿‡http://www.mydomain.comæŒ‡å‘ç›¸åŒçš„åœ°å€http://mydomain.comã€‚å¦‚æœIPåœ°å€å‘ç”Ÿæ›´æ”¹ï¼Œåˆ™åªéœ€è¦åœ¨ä¸€ä¸ªåœ°æ–¹è¿›è¡Œæ›´æ–°å³å¯ï¼šåªéœ€ä¸ºä¿®æ”¹Aè®°å½•http://mydomain.comï¼Œé‚£ä¹ˆhttp://www.mydomain.comè‡ªåŠ¨ç»§æ‰¿æ›´æ”¹ã€‚ã€€ã€€ CNAME è®°å½•å¿…é¡»å§‹ç»ˆæŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼Œæ°¸è¿œä¸è¦ç›´æ¥æŒ‡å‘ IP åœ°å€ã€‚å¦‚æœæ‚¨å°è¯•å°† CNAME è®°å½•æŒ‡å‘ IP åœ°å€ï¼ŒDNSimple çš„è®°å½•ç¼–è¾‘å™¨ä¼šè­¦å‘Šæ‚¨ã€‚CNAME å¯¹å…¶ä»–è®°å½•å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚CNAME è®°å½•å±€é™æ€§ã€€ã€€ CNAME è®°å½•å¿…é¡»å§‹ç»ˆæŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼Œå¹¶ä¸”æ°¸è¿œä¸è¦ç›´æ¥æŒ‡å‘ IP åœ°å€ã€‚ã€€ã€€æ‚¨ä¸èƒ½ä¸ºä¸»åŸŸåï¼ˆhttp://mydomain.comï¼‰æœ¬èº«åˆ›å»ºCNAMEè®°å½•ï¼Œè¯¥è®°å½•å¿…é¡»æ˜¯Aè®°å½•ã€‚ã€€ã€€ä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½å°†http://mydomain.comæ˜ å°„åˆ°http://google.comï¼Œä½†æ˜¯å¯ä»¥å°†http://google.mydomain.comæ˜ å°„åˆ°http://google.comã€‚ã€€ã€€ä½¿ç”¨ CNAME è®°å½•æ„å‘³ç€æœ‰ä¸€ä¸ªé¢å¤–çš„è¯·æ±‚å‘é€åˆ° DNS æœåŠ¡å™¨ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å‡ æ¯«ç§’çš„å»¶è¿Ÿã€‚ã€€ã€€ä¸€ä¸ª CNAME è®°å½•ä¸èƒ½ä¸å¦ä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°çš„è®°å½•å…±å­˜ã€‚ä¸èƒ½åŒæ—¶æœ‰ CNAME å’Œ TXT è®°å½•http://www.example.comã€‚ã€€ã€€ä¸€ä¸ª CNAME å¯ä»¥æŒ‡å‘å¦ä¸€ä¸ª CNAMEï¼Œå°½ç®¡å‡ºäºæ€§èƒ½åŸå› é€šå¸¸ä¸å»ºè®®ä½¿ç”¨æ­¤é…ç½®ã€‚å¦‚æœé€‚ç”¨ï¼ŒCNAME åº”è¯¥å°½å¯èƒ½åœ°æŒ‡å‘ç›®æ ‡åç§°ï¼Œä»¥é¿å…ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚\nå¦‚ä½•è§£å†³ CDN ç¼“å­˜\nèµ„æº url å‚æ•°åŠ æ—¶é—´æˆ³url çš„å‚æ•°åŠ ä¸Šæ—¶é—´æˆ³ï¼Œæ¯æ¬¡æ›´æ–°æ—¶æ—¶é—´æˆ³ä¹Ÿè·Ÿéšæ›´æ–°ï¼Œé‡æ–°ä½¿ cdn è¾¹ç¼˜èŠ‚ç‚¹åŒæ­¥æºæœåŠ¡å™¨æœ€æ–°æ•°æ®ã€‚è°ƒç”¨ cdn æœåŠ¡å•†æä¾›çš„åˆ·æ–°ç¼“å­˜æ¥å£\n\nhttp://www.cdn.com/static/images/test.png # æ²¡åŠ æ—¶é—´æˆ³\nhttp://www.cdn.com/static/images/test.png?_t=202012290910 # åŠ äº†æ—¶é—´æˆ³\n\n\nè°ƒç”¨ cdn æœåŠ¡å•†æä¾›çš„åˆ·æ–°ç¼“å­˜æ¥å£CDN è¾¹ç¼˜èŠ‚ç‚¹å¯¹å¼€å‘è€…æ˜¯é€æ˜çš„ï¼Œç›¸æ¯”äºæµè§ˆå™¨ Ctrl+F5 çš„å¼ºåˆ¶åˆ·æ–°æ¥ä½¿æµè§ˆå™¨æœ¬åœ°ç¼“å­˜å¤±æ•ˆï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ CDN æœåŠ¡å•†æä¾›çš„â€œåˆ·æ–°ç¼“å­˜â€æ¥å£æ¥è¾¾åˆ°æ¸…ç† CDN è¾¹ç¼˜èŠ‚ç‚¹ç¼“å­˜çš„ç›®çš„ã€‚è¿™æ ·å¼€å‘è€…åœ¨æ›´æ–°æ•°æ®åï¼Œå¯ä»¥ä½¿ç”¨â€œåˆ·æ–°ç¼“å­˜â€åŠŸèƒ½æ¥å¼ºåˆ¶ CDN èŠ‚ç‚¹ä¸Šçš„æ•°æ®ç¼“å­˜è¿‡æœŸï¼Œä¿è¯å®¢æˆ·ç«¯åœ¨è®¿é—®æ—¶ï¼Œæ‹‰å–åˆ°æœ€æ–°çš„æ•°æ®ã€‚\n\nCDN çš„åº”ç”¨åœºæ™¯\nç½‘ç«™ç«™ç‚¹&#x2F;åº”ç”¨åŠ é€Ÿç«™ç‚¹æˆ–è€…åº”ç”¨ä¸­å¤§é‡é™æ€èµ„æºçš„åŠ é€Ÿåˆ†å‘ï¼Œå»ºè®®å°†ç«™ç‚¹å†…å®¹è¿›è¡ŒåŠ¨é™åˆ†ç¦»ï¼ŒåŠ¨æ€æ–‡ä»¶å¯ä»¥ç»“åˆäº‘æœåŠ¡å™¨ ECSï¼Œé™æ€èµ„æºå¦‚å„ç±»å‹å›¾ç‰‡ã€htmlã€cssã€js æ–‡ä»¶ç­‰ï¼Œå»ºè®®ç»“åˆ å¯¹è±¡å­˜å‚¨ OSS å­˜å‚¨æµ·é‡é™æ€èµ„æºï¼Œå¯ä»¥æœ‰æ•ˆåŠ é€Ÿå†…å®¹åŠ è½½é€Ÿåº¦ï¼Œè½»æ¾æå®šç½‘ç«™å›¾ç‰‡ã€çŸ­è§†é¢‘ç­‰å†…å®¹åˆ†å‘\nè§†éŸ³é¢‘ç‚¹æ’­&#x2F;å¤§æ–‡ä»¶ä¸‹è½½åˆ†å‘åŠ é€Ÿæ”¯æŒå„ç±»æ–‡ä»¶çš„ä¸‹è½½ã€åˆ†å‘ï¼Œæ”¯æŒåœ¨çº¿ç‚¹æ’­åŠ é€Ÿä¸šåŠ¡ï¼Œå¦‚ mp4ã€flv è§†é¢‘æ–‡ä»¶æˆ–è€…å¹³å‡å•ä¸ªæ–‡ä»¶å¤§å°åœ¨ 20M ä»¥ä¸Šï¼Œä¸»è¦çš„ä¸šåŠ¡åœºæ™¯æ˜¯è§†éŸ³é¢‘ç‚¹æ’­ã€å¤§æ–‡ä»¶ä¸‹è½½ï¼ˆå¦‚å®‰è£…åŒ…ä¸‹è½½ï¼‰ç­‰ï¼Œå»ºè®®æ­é…å¯¹è±¡å­˜å‚¨ OSS ä½¿ç”¨ï¼Œå¯æå‡å›æºé€Ÿåº¦ï¼ŒèŠ‚çº¦è¿‘ 2&#x2F;3 å›æºå¸¦å®½æˆæœ¬ã€‚\nè§†é¢‘ç›´æ’­åŠ é€Ÿï¼ˆå†…æµ‹ä¸­ï¼‰è§†é¢‘æµåª’ä½“ç›´æ’­æœåŠ¡ï¼Œæ”¯æŒåª’èµ„å­˜å‚¨ã€åˆ‡ç‰‡è½¬ç ã€è®¿é—®é‰´æƒã€å†…å®¹åˆ†å‘åŠ é€Ÿä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚ç»“åˆå¼¹æ€§ä¼¸ç¼©æœåŠ¡ï¼ŒåŠæ—¶è°ƒæ•´æœåŠ¡å™¨å¸¦å®½ï¼Œåº”å¯¹çªå‘è®¿é—®æµé‡ï¼›ç»“åˆåª’ä½“è½¬ç æœåŠ¡ï¼Œäº«å—é«˜é€Ÿç¨³å®šçš„å¹¶è¡Œè½¬ç ï¼Œä¸”ä»»åŠ¡è§„æ¨¡æ— ç¼æ‰©å±•ã€‚ç›®å‰ CDN ç›´æ’­åŠ é€Ÿå·²æœåŠ¡å†…éƒ¨ç”¨æˆ·æµ‹è¯•å¹¶ä¼˜åŒ–ï¼Œå³å°†ä¸Šçº¿\nç§»åŠ¨åº”ç”¨åŠ é€Ÿç§»åŠ¨ APP æ›´æ–°æ–‡ä»¶ï¼ˆapk æ–‡ä»¶ï¼‰åˆ†å‘ï¼Œç§»åŠ¨ APP å†…å›¾ç‰‡ã€é¡µé¢ã€çŸ­è§†é¢‘ã€UGC ç­‰å†…å®¹çš„ä¼˜åŒ–åŠ é€Ÿåˆ†å‘ã€‚æä¾› httpDNS æœåŠ¡ï¼Œé¿å… DNS åŠ«æŒå¹¶è·å¾—å®æ—¶ç²¾ç¡®çš„ DNS è§£æç»“æœï¼Œæœ‰æ•ˆç¼©çŸ­ç”¨æˆ·è®¿é—®æ—¶é—´ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚\n\nå‚è€ƒä¹Ÿè®¸æ˜¯å²ä¸Šæœ€å…¨çš„ä¸€æ¬¡ CDN è¯¦è§£ä¸€å›¾ç§’æ‡‚ CDN åŸç†\n","slug":"cdn","date":"2022-02-08T19:56:46.000Z","categories_index":"","tags_index":"Network","author_index":"Matrix"}]